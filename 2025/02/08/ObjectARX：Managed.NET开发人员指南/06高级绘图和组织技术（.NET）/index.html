<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>06高级绘图和组织技术（.NET） | funtim的博客</title><meta name="author" content="funtim41@gmail.com"><meta name="copyright" content="funtim41@gmail.com"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="高级绘图和组织技术（.NET）随着经验的积累，您可以利用许多高级功能来进一步增强应用程序。 可以参照其他图形，并在图形中包含光栅图像（如航拍、卫星和数字照片）以及计算机渲染图像。有关参照文件和光栅图像的信息，请参见AutoCAD产品文档。 除了增强图形的视觉图像外，AutoCAD还提供了多个功能来帮助您组织数据，从而使您可以进一步扩展图形中对象的智能。 本节中的主题  使用光栅图像（.NET） 使">
<meta property="og:type" content="article">
<meta property="og:title" content="06高级绘图和组织技术（.NET）">
<meta property="og:url" content="https://funtim41.github.io/2025/02/08/ObjectARX%EF%BC%9AManaged.NET%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E6%8C%87%E5%8D%97/06%E9%AB%98%E7%BA%A7%E7%BB%98%E5%9B%BE%E5%92%8C%E7%BB%84%E7%BB%87%E6%8A%80%E6%9C%AF%EF%BC%88.NET%EF%BC%89/">
<meta property="og:site_name" content="funtim的博客">
<meta property="og:description" content="高级绘图和组织技术（.NET）随着经验的积累，您可以利用许多高级功能来进一步增强应用程序。 可以参照其他图形，并在图形中包含光栅图像（如航拍、卫星和数字照片）以及计算机渲染图像。有关参照文件和光栅图像的信息，请参见AutoCAD产品文档。 除了增强图形的视觉图像外，AutoCAD还提供了多个功能来帮助您组织数据，从而使您可以进一步扩展图形中对象的智能。 本节中的主题  使用光栅图像（.NET） 使">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://funtim41.github.io/images/4stars.png">
<meta property="article:published_time" content="2025-02-08T10:15:29.000Z">
<meta property="article:modified_time" content="2025-02-08T15:26:23.205Z">
<meta property="article:author" content="funtim41@gmail.com">
<meta property="article:tag" content="CAD">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://funtim41.github.io/images/4stars.png"><link rel="shortcut icon" href="/images/OIP.jfif"><link rel="canonical" href="https://funtim41.github.io/2025/02/08/ObjectARX%EF%BC%9AManaged.NET%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E6%8C%87%E5%8D%97/06%E9%AB%98%E7%BA%A7%E7%BB%98%E5%9B%BE%E5%92%8C%E7%BB%84%E7%BB%87%E6%8A%80%E6%9C%AF%EF%BC%88.NET%EF%BC%89/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: funtim41@gmail.com","link":"链接: ","source":"来源: funtim的博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '06高级绘图和组织技术（.NET）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><link rel="stylesheet" href="/css/bar.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background: Color(#995a82);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/images/4stars.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">67</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Timeline</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/Links/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/images/topback.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/images/OIP.jfif" alt="Logo"><span class="site-name">funtim的博客</span></a><a class="nav-page-title" href="/"><span class="site-name">06高级绘图和组织技术（.NET）</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Timeline</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/Links/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">06高级绘图和组织技术（.NET）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-02-08T10:15:29.000Z" title="发表于 2025-02-08 18:15:29">2025-02-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-02-08T15:26:23.205Z" title="更新于 2025-02-08 23:26:23">2025-02-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ObjectARX%EF%BC%9AManaged-NET%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E6%8C%87%E5%8D%97/">ObjectARX：Managed.NET开发人员指南</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="高级绘图和组织技术（-NET）"><a href="#高级绘图和组织技术（-NET）" class="headerlink" title="高级绘图和组织技术（.NET）"></a>高级绘图和组织技术（.NET）</h1><p>随着经验的积累，您可以利用许多高级功能来进一步增强应用程序。</p>
<p>可以参照其他图形，并在图形中包含光栅图像（如航拍、卫星和数字照片）以及计算机渲染图像。有关参照文件和光栅图像的信息，请参见AutoCAD产品文档。</p>
<p>除了增强图形的视觉图像外，AutoCAD还提供了多个功能来帮助您组织数据，从而使您可以进一步扩展图形中对象的智能。</p>
<p>本节中的主题</p>
<ul>
<li>使用光栅图像（.NET）</li>
<li>使用块和属性（.NET）</li>
<li>使用外部引用（.NET）</li>
<li>分配和删除扩展数据（.NET）</li>
</ul>
<h2 id="使用光栅图像（-NET）"><a href="#使用光栅图像（-NET）" class="headerlink" title="使用光栅图像（.NET）"></a>使用光栅图像（.NET）</h2><p>使用AutoCAD®，可以将光栅图像附着到基于矢量的图形，然后查看和打印参照文件。</p>
<p>本节中的主题</p>
<ul>
<li>附加和缩放光栅图像（.NET）</li>
<li>管理光栅图像（.NET）</li>
<li>修改图像和图像边界（.NET）</li>
<li>更改图像的剪切边界（.NET）</li>
</ul>
<h3 id="附加和缩放光栅图像（-NET）"><a href="#附加和缩放光栅图像（-NET）" class="headerlink" title="附加和缩放光栅图像（.NET）"></a>附加和缩放光栅图像（.NET）</h3><p>图像可以附着并放置在图形文件中，但它们实际上不是文件的一部分。图像通过路径名或数据管理文档ID链接到图形文件。可以随时更改或删除链接的图像路径。要附加图像，首先创建一个RasterImageDef对象，该对象包含有关存储在磁盘上的被引用图像文件的定义信息，然后创建一个RasterImage对象。</p>
<p>创建RasterImageDef对象后，将其指定给RasterImage对象。RasterImage对象表示您在绘图窗口中与之交互的对象，并允许您控制图像的插入点、比例、方向和外观以及其他属性。单个RasterImageDef对象可用于多次附加图像。每个附件都有自己的剪辑边界以及自己的亮度、对比度、淡入度和透明度设置。</p>
<p>创建RasterImage对象后，可以使用Scale特性设置光栅图像的比例因子，以便图像的几何图形比例与AutoCAD图形中创建的几何图形比例相匹配。附着图像时，将以1个图像测量单位比1个AutoCAD测量单位的比例因子插入图像。要设置图像比例因子，需要知道图像上几何图形的比例，还需要知道要使用什么测量单位（英寸、英尺等）来定义1个AutoCAD单位。图像文件必须包含定义DPI（每英寸点数）和图像像素数的分辨率信息。</p>
<p>如果图像具有分辨率信息，AutoCAD会将其与您提供的比例因子和AutoCAD测量单位相结合，以缩放图形中的图像。例如，如果光栅图像是扫描的蓝图，其比例为1英寸等于50英尺（或1：600），并且AutoCAD图形设置为1单位表示1英寸，则将图像的比例因子设置为600。AutoCAD会缩放图像，以便图像中的几何图形与图形中的矢量几何图形对齐。</p>
<p><strong>注意：</strong>如果附着的图像文件未定义分辨率信息，AutoCAD将以一个单位计算图像的原始宽度。插入后，以AutoCAD单位表示的图像宽度等于比例因子。</p>
<p><strong>附加光栅图像</strong></p>
<p>此示例在模型空间中添加光栅图像。此示例使用在WEBSample目录中找到的WorldMap.tif文件。如果没有此图像，或者它位于其他目录中，请修改代码以使用有效的路径和文件名。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;AttachRasterImage&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AttachRasterImage</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database and start a transaction</span></span><br><span class="line">    Database acCurDb;</span><br><span class="line">    acCurDb = Application.DocumentManager.MdiActiveDocument.Database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Define the name and image to use</span></span><br><span class="line">        <span class="built_in">string</span> strImgName = <span class="string">&quot;WorldMap&quot;</span>;</span><br><span class="line">        <span class="built_in">string</span> strFileName = <span class="string">&quot;C:\\AutoCAD\\Sample\\VBA\\WorldMap.TIF&quot;</span>;</span><br><span class="line"></span><br><span class="line">        RasterImageDef acRasterDef;</span><br><span class="line">        <span class="built_in">bool</span> bRasterDefCreated = <span class="literal">false</span>;</span><br><span class="line">        ObjectId acImgDefId;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get the image dictionary</span></span><br><span class="line">        ObjectId acImgDctID = RasterImageDef.GetImageDictionary(acCurDb);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check to see if the dictionary does not exist, it not then create it</span></span><br><span class="line">        <span class="keyword">if</span> (acImgDctID.IsNull)</span><br><span class="line">        &#123;</span><br><span class="line">            acImgDctID = RasterImageDef.CreateImageDictionary(acCurDb);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the image dictionary</span></span><br><span class="line">        DBDictionary acImgDict = acTrans.GetObject(acImgDctID, OpenMode.ForRead) <span class="keyword">as</span> DBDictionary;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check to see if the image definition already exists</span></span><br><span class="line">        <span class="keyword">if</span> (acImgDict.Contains(strImgName))</span><br><span class="line">        &#123;</span><br><span class="line">            acImgDefId = acImgDict.GetAt(strImgName);</span><br><span class="line"></span><br><span class="line">            acRasterDef = acTrans.GetObject(acImgDefId, OpenMode.ForWrite) <span class="keyword">as</span> RasterImageDef;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Create a raster image definition</span></span><br><span class="line">            RasterImageDef acRasterDefNew = <span class="keyword">new</span> RasterImageDef();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Set the source for the image file</span></span><br><span class="line">            acRasterDefNew.SourceFileName = strFileName;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Load the image into memory</span></span><br><span class="line">            acRasterDefNew.Load();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Add the image definition to the dictionary</span></span><br><span class="line">            acTrans.GetObject(acImgDctID, OpenMode.ForWrite);</span><br><span class="line">            acImgDefId = acImgDict.SetAt(strImgName, acRasterDefNew);</span><br><span class="line"></span><br><span class="line">            acTrans.AddNewlyCreatedDBObject(acRasterDefNew, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">            acRasterDef = acRasterDefNew;</span><br><span class="line"></span><br><span class="line">            bRasterDefCreated = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId, OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Block table record Model space for write</span></span><br><span class="line">        BlockTableRecord acBlkTblRec;</span><br><span class="line">        acBlkTblRec = acTrans.GetObject(acBlkTbl[BlockTableRecord.ModelSpace],</span><br><span class="line">                                        OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create the new image and assign it the image definition</span></span><br><span class="line">        <span class="keyword">using</span> (RasterImage acRaster = <span class="keyword">new</span> RasterImage())</span><br><span class="line">        &#123;</span><br><span class="line">            acRaster.ImageDefId = acImgDefId;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Use ImageWidth and ImageHeight to get the size of the image in pixels (1024 x 768).</span></span><br><span class="line">            <span class="comment">// Use ResolutionMMPerPixel to determine the number of millimeters in a pixel so you </span></span><br><span class="line">            <span class="comment">// can convert the size of the drawing into other units or millimeters based on the </span></span><br><span class="line">            <span class="comment">// drawing units used in the current drawing.</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// Define the width and height of the image</span></span><br><span class="line">            Vector3d width;</span><br><span class="line">            Vector3d height;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Check to see if the measurement is set to English (Imperial) or Metric units</span></span><br><span class="line">            <span class="keyword">if</span> (acCurDb.Measurement == MeasurementValue.English)</span><br><span class="line">            &#123;</span><br><span class="line">                width = <span class="keyword">new</span> Vector3d((acRasterDef.ResolutionMMPerPixel.X * acRaster.ImageWidth) / <span class="number">25.4</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                height = <span class="keyword">new</span> Vector3d(<span class="number">0</span>, (acRasterDef.ResolutionMMPerPixel.Y * acRaster.ImageHeight) / <span class="number">25.4</span>, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                width = <span class="keyword">new</span> Vector3d(acRasterDef.ResolutionMMPerPixel.X * acRaster.ImageWidth, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                height = <span class="keyword">new</span> Vector3d(<span class="number">0</span>, acRasterDef.ResolutionMMPerPixel.Y * acRaster.ImageHeight, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Define the position for the image </span></span><br><span class="line">            Point3d insPt = <span class="keyword">new</span> Point3d(<span class="number">5.0</span>, <span class="number">5.0</span>, <span class="number">0.0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Define and assign a coordinate system for the image&#x27;s orientation</span></span><br><span class="line">            CoordinateSystem3d coordinateSystem = <span class="keyword">new</span> CoordinateSystem3d(insPt, width * <span class="number">2</span>, height * <span class="number">2</span>);</span><br><span class="line">            acRaster.Orientation = coordinateSystem;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Set the rotation angle for the image</span></span><br><span class="line">            acRaster.Rotation = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Add the new object to the block table record and the transaction</span></span><br><span class="line">            acBlkTblRec.AppendEntity(acRaster);</span><br><span class="line">            acTrans.AddNewlyCreatedDBObject(acRaster, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Connect the raster definition and image together so the definition</span></span><br><span class="line">            <span class="comment">// does not appear as &quot;unreferenced&quot; in the External References palette.</span></span><br><span class="line">            RasterImage.EnableReactors(<span class="literal">true</span>);</span><br><span class="line">            acRaster.AssociateRasterDef(acRasterDef);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (bRasterDefCreated)</span><br><span class="line">            &#123;</span><br><span class="line">                acRasterDef.Dispose();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new object to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dispose of the transaction</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="管理光栅图像（-NET）"><a href="#管理光栅图像（-NET）" class="headerlink" title="管理光栅图像（.NET）"></a>管理光栅图像（.NET）</h3><p>可以使用 RasterImage 对象的属性管理光栅图像名称、文件名和文件路径。</p>
<p>本节中的主题</p>
<ul>
<li>变更图像路径（.NET）</li>
<li>命名图像（.NET）</li>
</ul>
<h4 id="变更图像路径（-NET）"><a href="#变更图像路径（-NET）" class="headerlink" title="变更图像路径（.NET）"></a>变更图像路径（.NET）</h4><p>使用分配给 RasterImage 对象的 RasterImageDef 对象的 SourceFileName 属性查询或更改图像的路径和文件名。此特性设置的路径是AutoCAD查找图像的实际路径。</p>
<p>如果AutoCAD无法找到图形（例如，如果将文件移动到与 SourceFileName 特性保存的目录不同的目录），则它会从名称中删除相对或绝对路径信息（例如，<em>\images\tree.tga</em>或<em>c：\my project\images\tree.tga</em>变为<em>tree.tga</em>），并搜索使用Preferences对象上的 SetProjectFilePath 方法定义的路径。如果文件不在路径中，它将再次尝试第一个搜索路径。如果AutoCAD找到并加载图像文件，则会更新 ActiveFileName 特性以反映找到该文件的位置。</p>
<p>可以从文件名中删除路径，或通过重置 SourceFileName 属性指定相对路径。</p>
<p>更改 SourceFileName 属性中的路径不会影响项目文件的搜索路径设置。</p>
<h4 id="命名图像（-NET）"><a href="#命名图像（-NET）" class="headerlink" title="命名图像（.NET）"></a>命名图像（.NET）</h4><p>图像名称不一定与图像文件名称相同。将图像附着到图形时，将在“图像”字典中为图像文件参照指定一个名称。您可以更改图像名称而不影响文件的名称。</p>
<p>图像文件由 RasterImageDef 对象上的 SourceFileName 属性表示。更改 SourceFileName 特性将更改图形中的图像。图像名称由表示 RasterImageDef 对象的 DBDictionaryEntry 对象的 Key 属性表示，更改 Key 属性将仅更改图像的名称，而不会更改与之关联的文件。</p>
<h3 id="修改图像和图像边界（-NET）"><a href="#修改图像和图像边界（-NET）" class="headerlink" title="修改图像和图像边界（.NET）"></a>修改图像和图像边界（.NET）</h3><p>所有图像都有图像边界。将图像附着到图形时，图像边界将继承当前特性设置，包括颜色、图层、线型和线型比例。如果图像是黑白图像，则图像颜色和边界颜色相同。</p>
<p>与其他AutoCAD对象一样，可以修改图像及其边界特性。例如，您可以：</p>
<ul>
<li>显示或隐藏图像边界</li>
<li>修改图像图层、边界颜色和线型</li>
<li>更改图像位置</li>
<li>缩放、旋转和更改图像的宽度和高度</li>
<li>切换图像可见性</li>
<li>更改图像透明度</li>
<li>更改图像亮度、对比度和淡入度</li>
<li>更改图像显示的质量和速度</li>
</ul>
<h4 id="显示和隐藏图像边界（-NET）"><a href="#显示和隐藏图像边界（-NET）" class="headerlink" title="显示和隐藏图像边界（.NET）"></a>显示和隐藏图像边界（.NET）</h4><p>隐藏图像边界可确保图像不会意外移动或修改，并防止打印或显示边界。隐藏图像边界时，剪裁的图像仍显示为其指定的边界限制;只有边界受到影响。显示和隐藏图像边界会影响附着到图形的所有图像。</p>
<p>如果要显示或隐藏图像边界，请使用 IsClipped 属性。</p>
<p>注意：此属性仅影响图像边界。若要查看切换此属性时图像的变化，请仔细查看图像周围的小边界。</p>
<h4 id="更改图像和边界属性（-NET）"><a href="#更改图像和边界属性（-NET）" class="headerlink" title="更改图像和边界属性（.NET）"></a>更改图像和边界属性（.NET）</h4><p>可以使用以下特性更改图像边界和图像图层的颜色、线型、线宽和透明度：</p>
<ul>
<li><p>Layer </p>
<p>指定图像的图层</p>
</li>
<li><p>Color </p>
<p>指定图像边界的颜色</p>
</li>
<li><p>Linetype </p>
<p>指定图像边界的线型</p>
</li>
<li><p>Lineweight </p>
<p>指定图像边界的线宽</p>
</li>
<li><p>Transparency </p>
<p>指定图像边界的透明度</p>
</li>
</ul>
<h4 id="更改图像缩放、旋转、位置、宽度和高度（-NET）"><a href="#更改图像缩放、旋转、位置、宽度和高度（-NET）" class="headerlink" title="更改图像缩放、旋转、位置、宽度和高度（.NET）"></a>更改图像缩放、旋转、位置、宽度和高度（.NET）</h4><p>可以使用以下方法和属性更改图像的位置、缩放、旋转、位置、宽度和高度：</p>
<ul>
<li><p>Orientation </p>
<p>指定图像的位置和比例</p>
</li>
<li><p>Rotation </p>
<p>旋转图像</p>
</li>
<li><p>Width </p>
<p>以像素为单位指定图像的宽度</p>
</li>
<li><p>Height </p>
<p>以像素为单位指定图像的高度</p>
</li>
<li><p>ImageWidth </p>
<p>以数据库单位指定图像的宽度</p>
</li>
<li><p>ImageHeight </p>
<p>以数据库单位指定图像的高度</p>
</li>
</ul>
<h4 id="更改图像可见性（-NET）"><a href="#更改图像可见性（-NET）" class="headerlink" title="更改图像可见性（.NET）"></a>更改图像可见性（.NET）</h4><p>图像可见性通过隐藏当前绘图任务中的图像来影响重画速度。不显示或打印隐藏图像;仅显示图形边界。要隐藏图像，请将其 ShowImage 属性设置为 False 。若要重新显示图像，请将其 ShowImage 属性设置为 True 。</p>
<h4 id="修改黑白图像颜色和透明度（-NET）"><a href="#修改黑白图像颜色和透明度（-NET）" class="headerlink" title="修改黑白图像颜色和透明度（.NET）"></a>修改黑白图像颜色和透明度（.NET）</h4><p>双色光栅图像是仅由前景色和背景色组成的图像。附着黑白图像时，图像中的前景像素将继承当前图层的颜色设置。除了可以对任何附加图像进行修改之外，还可以通过更改前景色以及打开和关闭背景的透明度来修改黑白图像。</p>
<p><strong>注意：</strong>黑白图像和黑白图像边界的颜色始终相同。</p>
<p>若要更改黑白图像的前景色，请使用 Color 属性。要打开和关闭透明度，请使用 ImageTransparency 属性。</p>
<h4 id="调整图像亮度、对比度和淡入淡出（-NET）"><a href="#调整图像亮度、对比度和淡入淡出（-NET）" class="headerlink" title="调整图像亮度、对比度和淡入淡出（.NET）"></a>调整图像亮度、对比度和淡入淡出（.NET）</h4><p>可以在AutoCAD中调整图像亮度、对比度和淡入度，以控制图像的显示和打印输出方式，而不会影响原始光栅图像文件。</p>
<p>使用以下属性调整亮度、对比度和淡入度：</p>
<ul>
<li><p>Brightness </p>
<p>指定图像的亮度级别</p>
</li>
<li><p>Contrast </p>
<p>指定图像的对比度</p>
</li>
<li><p>Fade </p>
<p>指定图像的淡入度</p>
</li>
</ul>
<h3 id="更改图像的剪切边界（-NET）"><a href="#更改图像的剪切边界（-NET）" class="headerlink" title="更改图像的剪切边界（.NET）"></a>更改图像的剪切边界（.NET）</h3><p>可以通过剪裁图像来定义图像的显示和打印区域。剪裁边界必须是二维多边形或矩形，其顶点被约束为位于图像的边界内。同一图像的多个实例可以具有不同的边界。</p>
<p>如果要显示或隐藏图像边界，请使用IsClipped属性;如果要确定剪裁边界是定义为矩形还是多边形，请使用ClipBoundaryType属性。</p>
<p>使用以下方法获取或设置图像的剪裁边界：</p>
<ul>
<li><p>GetClipBoundary </p>
<p>返回以图像像素坐标表示的剪辑边界顶点的集合。反转PixelToModelTransform矩阵，将其转换为模型坐标。</p>
</li>
<li><p>SetClipBoundary </p>
<p>指定多边形剪裁边界。</p>
</li>
<li><p>SetClipBoundaryToWholeImage </p>
<p>将剪辑边界设置为与图像边界重合。将删除所有现有的剪裁边界。</p>
</li>
</ul>
<p><strong>裁剪光栅图像</strong></p>
<p>此示例在模型空间中添加光栅图像，然后基于剪裁边界剪裁该图像。此示例使用在VBA示例目录中找到的WorldMap.tif文件。如果没有此图像，或者它位于其他目录中，请修改代码以使用有效的路径和文件名。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;ClippingRasterBoundary&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ClippingRasterBoundary</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database and start a transaction</span></span><br><span class="line">    Database acCurDb;</span><br><span class="line">    acCurDb = Application.DocumentManager.MdiActiveDocument.Database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Define the name and image to use</span></span><br><span class="line">        <span class="built_in">string</span> strImgName = <span class="string">&quot;WorldMap&quot;</span>;</span><br><span class="line">        <span class="built_in">string</span> strFileName = <span class="string">&quot;C:\\AutoCAD\\Sample\\VBA\\WorldMap.TIF&quot;</span>;</span><br><span class="line"></span><br><span class="line">        RasterImageDef acRasterDef;</span><br><span class="line">        <span class="built_in">bool</span> bRasterDefCreated = <span class="literal">false</span>;</span><br><span class="line">        ObjectId acImgDefId;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get the image dictionary</span></span><br><span class="line">        ObjectId acImgDctID = RasterImageDef.GetImageDictionary(acCurDb);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check to see if the dictionary does not exist, it not then create it</span></span><br><span class="line">        <span class="keyword">if</span> (acImgDctID.IsNull)</span><br><span class="line">        &#123;</span><br><span class="line">            acImgDctID = RasterImageDef.CreateImageDictionary(acCurDb);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the image dictionary</span></span><br><span class="line">        DBDictionary acImgDict = acTrans.GetObject(acImgDctID, OpenMode.ForRead) <span class="keyword">as</span> DBDictionary;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check to see if the image definition already exists</span></span><br><span class="line">        <span class="keyword">if</span> (acImgDict.Contains(strImgName))</span><br><span class="line">        &#123;</span><br><span class="line">            acImgDefId = acImgDict.GetAt(strImgName);</span><br><span class="line"></span><br><span class="line">            acRasterDef = acTrans.GetObject(acImgDefId, OpenMode.ForWrite) <span class="keyword">as</span> RasterImageDef;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Create a raster image definition</span></span><br><span class="line">            RasterImageDef acRasterDefNew = <span class="keyword">new</span> RasterImageDef();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Set the source for the image file</span></span><br><span class="line">            acRasterDefNew.SourceFileName = strFileName;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Load the image into memory</span></span><br><span class="line">            acRasterDefNew.Load();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Add the image definition to the dictionary</span></span><br><span class="line">            acTrans.GetObject(acImgDctID, OpenMode.ForWrite);</span><br><span class="line">            acImgDefId = acImgDict.SetAt(strImgName, acRasterDefNew);</span><br><span class="line"></span><br><span class="line">            acTrans.AddNewlyCreatedDBObject(acRasterDefNew, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">            acRasterDef = acRasterDefNew;</span><br><span class="line"></span><br><span class="line">            bRasterDefCreated = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId, OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Block table record Model space for write</span></span><br><span class="line">        BlockTableRecord acBlkTblRec;</span><br><span class="line">        acBlkTblRec = acTrans.GetObject(acBlkTbl[BlockTableRecord.ModelSpace],</span><br><span class="line">                                        OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create the new image and assign it the image definition</span></span><br><span class="line">        <span class="keyword">using</span> (RasterImage acRaster = <span class="keyword">new</span> RasterImage())</span><br><span class="line">        &#123;</span><br><span class="line">            acRaster.ImageDefId = acImgDefId;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Use ImageWidth and ImageHeight to get the size of the image in pixels (1024 x 768).</span></span><br><span class="line">            <span class="comment">// Use ResolutionMMPerPixel to determine the number of millimeters in a pixel so you </span></span><br><span class="line">            <span class="comment">// can convert the size of the drawing into other units or millimeters based on the </span></span><br><span class="line">            <span class="comment">// drawing units used in the current drawing.</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// Define the width and height of the image</span></span><br><span class="line">            Vector3d width;</span><br><span class="line">            Vector3d height;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Check to see if the measurement is set to English (Imperial) or Metric units</span></span><br><span class="line">            <span class="keyword">if</span> (acCurDb.Measurement == MeasurementValue.English)</span><br><span class="line">            &#123;</span><br><span class="line">                width = <span class="keyword">new</span> Vector3d((acRasterDef.ResolutionMMPerPixel.X * acRaster.ImageWidth) / <span class="number">25.4</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                height = <span class="keyword">new</span> Vector3d(<span class="number">0</span>, (acRasterDef.ResolutionMMPerPixel.Y * acRaster.ImageHeight) / <span class="number">25.4</span>, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                width = <span class="keyword">new</span> Vector3d(acRasterDef.ResolutionMMPerPixel.X * acRaster.ImageWidth, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                height = <span class="keyword">new</span> Vector3d(<span class="number">0</span>, acRasterDef.ResolutionMMPerPixel.Y * acRaster.ImageHeight, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Define the position for the image </span></span><br><span class="line">            Point3d insPt = <span class="keyword">new</span> Point3d(<span class="number">5.0</span>, <span class="number">5.0</span>, <span class="number">0.0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Define and assign a coordinate system for the image&#x27;s orientation</span></span><br><span class="line">            CoordinateSystem3d coordinateSystem = <span class="keyword">new</span> CoordinateSystem3d(insPt, width * <span class="number">2</span>, height * <span class="number">2</span>);</span><br><span class="line">            acRaster.Orientation = coordinateSystem;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Set the rotation angle for the image</span></span><br><span class="line">            acRaster.Rotation = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Define the clipping boundary in drawing units</span></span><br><span class="line">            Point2dCollection acPt2dColl = <span class="keyword">new</span> Point2dCollection();</span><br><span class="line">            Matrix3d acMat3d = acRaster.PixelToModelTransform.Inverse();</span><br><span class="line">            acPt2dColl.Add(<span class="keyword">new</span> Point3d(<span class="number">5.5</span>, <span class="number">15</span>, <span class="number">0</span>).TransformBy(acMat3d).Convert2d(<span class="keyword">new</span> Plane()));</span><br><span class="line">            acPt2dColl.Add(<span class="keyword">new</span> Point3d(<span class="number">12.5</span>, <span class="number">15</span>, <span class="number">0</span>).TransformBy(acMat3d).Convert2d(<span class="keyword">new</span> Plane()));</span><br><span class="line">            acPt2dColl.Add(<span class="keyword">new</span> Point3d(<span class="number">12.5</span>, <span class="number">10.5</span>, <span class="number">0</span>).TransformBy(acMat3d).Convert2d(<span class="keyword">new</span> Plane()));</span><br><span class="line">            acPt2dColl.Add(<span class="keyword">new</span> Point3d(<span class="number">5.5</span>, <span class="number">10.5</span>, <span class="number">0</span>).TransformBy(acMat3d).Convert2d(<span class="keyword">new</span> Plane()));</span><br><span class="line">            acPt2dColl.Add(<span class="keyword">new</span> Point3d(<span class="number">5.5</span>, <span class="number">15</span>, <span class="number">0</span>).TransformBy(acMat3d).Convert2d(<span class="keyword">new</span> Plane()));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Clip the image</span></span><br><span class="line">            acRaster.SetClipBoundary(ClipBoundaryType.Rectangle, acPt2dColl);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Enable the display of the clip</span></span><br><span class="line">            acRaster.IsClipped = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Add the new object to the block table record and the transaction</span></span><br><span class="line">            acBlkTblRec.AppendEntity(acRaster);</span><br><span class="line">            acTrans.AddNewlyCreatedDBObject(acRaster, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Connect the raster definition and image together so the definition</span></span><br><span class="line">            <span class="comment">// does not appear as &quot;unreferenced&quot; in the External References palette.</span></span><br><span class="line">            RasterImage.EnableReactors(<span class="literal">true</span>);</span><br><span class="line">            acRaster.AssociateRasterDef(acRasterDef);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (bRasterDefCreated)</span><br><span class="line">            &#123;</span><br><span class="line">                acRasterDef.Dispose();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new object to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dispose of the transaction</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用块和特性（-NET）"><a href="#使用块和特性（-NET）" class="headerlink" title="使用块和特性（.NET）"></a>使用块和特性（.NET）</h2><p>AutoCAD提供了多种功能来帮助您管理图形中的对象。使用块，可以将许多对象作为一个组件进行组织和操作。特性将信息项与数据库中的块相关联，例如零件号和价格。</p>
<p>使用AutoCAD外部参照，可以将整个图形附着或覆盖到当前图形。打开当前图形时，在参照图形中所做的任何更改都会显示在当前图形中。</p>
<p>本节中的主题</p>
<ul>
<li>使用块（.NET）</li>
<li>使用特性（.NET）</li>
</ul>
<h3 id="使用块（-NET）"><a href="#使用块（-NET）" class="headerlink" title="使用块（.NET）"></a>使用块（.NET）</h3><p>块是可以关联在一起以形成单个对象或块参照的对象集合。可以在图形中插入、缩放和旋转块参照。可以将块参照分解为其组件对象、修改它们以及重定义块。AutoCAD将根据块的定义更新该块参照的所有将来实例。</p>
<p>可以从最初在不同图层上绘制的具有不同颜色和线型的对象定义块。可以保留块中对象的图层、颜色和线型信息。然后，每次插入块时，都将块中的每个对象以其原始颜色和线型绘制在其原始图层上。</p>
<p>有关使用块的详细信息，请参见产品帮助系统中的“关于插入块”和“关于定义块”。</p>
<p>本节中的主题</p>
<ul>
<li>定义块（.NET）</li>
<li>插入块（.NET）</li>
<li>分解块参照（.NET）</li>
<li>重新定义块（.NET）</li>
</ul>
<h4 id="定义块（-NET）"><a href="#定义块（-NET）" class="headerlink" title="定义块（.NET）"></a>定义块（.NET）</h4><p>若要创建新块，请创建一个新的BlockTableRecord对象，并使用Add方法将其追加到BlockTable对象。创建BlockTableRecord对象后，请使用Name特性为块指定名称，并在使用BulldEntity方法将块插入图形时显示对象。</p>
<p>然后将任何几何对象或另一个块添加到新创建的BlockTableRecord对象。对象是使用BulldEntity方法添加到BlockTableRecord对象的。然后，可以通过创建新的BlockReference对象并将其附加到模型空间或与Layout对象关联的BlockTableRecord对象，将块的实例插入到图形中。插入的块是称为块参照的对象。</p>
<p>也可以通过使用WBlock方法将对象写出到单独的图形文件来创建块。然后，图形文件可以用作其他图形的块定义。AutoCAD将插入到其他图形中的任何图形视为块。</p>
<p>有关定义块的详细信息，请参阅产品帮助系统中的“关于定义块”。</p>
<p><strong>定义块</strong><br>此示例定义了一个块并向块定义中添加了一个圆。然后将块作为块参照插入到图形中。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;CreatingABlock&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CreatingABlock</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database and start a transaction</span></span><br><span class="line">    Database acCurDb;</span><br><span class="line">    acCurDb = Application.DocumentManager.MdiActiveDocument.Database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId, OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!acBlkTbl.Has(<span class="string">&quot;CircleBlock&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (BlockTableRecord acBlkTblRec = <span class="keyword">new</span> BlockTableRecord())</span><br><span class="line">            &#123;</span><br><span class="line">                acBlkTblRec.Name = <span class="string">&quot;CircleBlock&quot;</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Set the insertion point for the block</span></span><br><span class="line">                acBlkTblRec.Origin = <span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Add a circle to the block</span></span><br><span class="line">                <span class="keyword">using</span> (Circle acCirc = <span class="keyword">new</span> Circle())</span><br><span class="line">                &#123;</span><br><span class="line">                    acCirc.Center = <span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                    acCirc.Radius = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">                    acBlkTblRec.AppendEntity(acCirc);</span><br><span class="line"></span><br><span class="line">                    acTrans.GetObject(acCurDb.BlockTableId, OpenMode.ForWrite);</span><br><span class="line">                    acBlkTbl.Add(acBlkTblRec);</span><br><span class="line">                    acTrans.AddNewlyCreatedDBObject(acBlkTblRec, <span class="literal">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new object to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dispose of the transaction</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="插入块（-NET）"><a href="#插入块（-NET）" class="headerlink" title="插入块（.NET）"></a>插入块（.NET）</h4><p>在创建BlockReference对象，然后使用BlockEntity方法将其附加到BlockTableRecord对象之后，可以插入在当前图形的块表中定义的块。创建新的BlockReference时，向构造函数传递要插入的块引用的原点以及几何体应从其继承的BlockTableRecord对象的ObjectID。</p>
<p>也可以将整个图形文件插入到当前图形中，方法是使用ReadDwgFile方法在内存中打开图形文件，然后使用Insert方法将内存中的图形插入到当前图形中。将整个图形插入到另一个图形中时，AutoCAD会将插入的图形视为任何其他块参照。后续插入将参照具有不同位置、比例和旋转设置的块定义（其中包含块的几何描述）。</p>
<p>如果在插入原始图形后对其进行更改，则这些更改对插入的块没有影响。如果希望插入的块反映对原始图形所做的更改，可以通过重新插入原始图形来重定义块。</p>
<p>默认情况下，AutoCAD在插入图形文件时使用坐标（0，0，0）作为基点。通过打开原始图形并使用SetSystemVariable方法为INSBASE系统变量指定不同的插入基点，可以修改图形的基点。下次插入图形时，AutoCAD将使用新基点。</p>
<p>如果插入的图形包含PaperSpace对象，则这些对象不包含在当前图形的块定义中。若要在其他图形中使用PaperSpace对象，请打开原始图形并将PaperSpace对象定义为块。可以将图形插入到图纸空间或模型空间中的其他图形中。</p>
<p>不能通过迭代块参照来查找组成它的原始对象。但是，可以重新定义原始块定义，或者将块参照分解为其原始组件。</p>
<p>也可以使用MInsertBlock对象插入块数组。此对象类型不会像使用BlockReference对象那样在图形中插入单个块，而是插入指定块的数组。</p>
<p>有关插入块的详细信息，请参见产品帮助系统中的“关于插入块”。</p>
<p><strong>定义和插入块</strong></p>
<p>此示例定义了一个块并向块定义中添加了一个圆。然后将块作为块参照插入到图形中。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;InsertingABlock&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">InsertingABlock</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database and start a transaction</span></span><br><span class="line">    Database acCurDb;</span><br><span class="line">    acCurDb = Application.DocumentManager.MdiActiveDocument.Database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId, OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        ObjectId blkRecId = ObjectId.Null;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!acBlkTbl.Has(<span class="string">&quot;CircleBlock&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (BlockTableRecord acBlkTblRec = <span class="keyword">new</span> BlockTableRecord())</span><br><span class="line">            &#123;</span><br><span class="line">                acBlkTblRec.Name = <span class="string">&quot;CircleBlock&quot;</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Set the insertion point for the block</span></span><br><span class="line">                acBlkTblRec.Origin = <span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Add a circle to the block</span></span><br><span class="line">                <span class="keyword">using</span> (Circle acCirc = <span class="keyword">new</span> Circle())</span><br><span class="line">                &#123;</span><br><span class="line">                    acCirc.Center = <span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                    acCirc.Radius = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">                    acBlkTblRec.AppendEntity(acCirc);</span><br><span class="line"></span><br><span class="line">                    acTrans.GetObject(acCurDb.BlockTableId, OpenMode.ForWrite);</span><br><span class="line">                    acBlkTbl.Add(acBlkTblRec);</span><br><span class="line">                    acTrans.AddNewlyCreatedDBObject(acBlkTblRec, <span class="literal">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                blkRecId = acBlkTblRec.Id;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            blkRecId = acBlkTbl[<span class="string">&quot;CircleBlock&quot;</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Insert the block into the current space</span></span><br><span class="line">        <span class="keyword">if</span> (blkRecId != ObjectId.Null)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (BlockReference acBlkRef = <span class="keyword">new</span> BlockReference(<span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), blkRecId))</span><br><span class="line">            &#123;</span><br><span class="line">                BlockTableRecord acCurSpaceBlkTblRec;</span><br><span class="line">                acCurSpaceBlkTblRec = acTrans.GetObject(acCurDb.CurrentSpaceId, OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">                acCurSpaceBlkTblRec.AppendEntity(acBlkRef);</span><br><span class="line">                acTrans.AddNewlyCreatedDBObject(acBlkRef, <span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new object to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dispose of the transaction</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="分解块参照（-NET）"><a href="#分解块参照（-NET）" class="headerlink" title="分解块参照（.NET）"></a>分解块参照（.NET）</h4><p>使用Explode方法打断块参照。通过分解块参照，可以修改块或添加或删除定义块的对象。</p>
<p><strong>显示分解块参照的结果</strong></p>
<p>此示例创建一个块并将圆添加到块的定义中。然后，块将作为块参照插入到图形中。然后分解块参照，并沿着显示分解过程生成的对象及其对象类型。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;ExplodingABlock&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ExplodingABlock</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database and start a transaction</span></span><br><span class="line">    Database acCurDb;</span><br><span class="line">    acCurDb = Application.DocumentManager.MdiActiveDocument.Database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId, OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        ObjectId blkRecId = ObjectId.Null;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!acBlkTbl.Has(<span class="string">&quot;CircleBlock&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (BlockTableRecord acBlkTblRec = <span class="keyword">new</span> BlockTableRecord())</span><br><span class="line">            &#123;</span><br><span class="line">                acBlkTblRec.Name = <span class="string">&quot;CircleBlock&quot;</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Set the insertion point for the block</span></span><br><span class="line">                acBlkTblRec.Origin = <span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Add a circle to the block</span></span><br><span class="line">                <span class="keyword">using</span> (Circle acCirc = <span class="keyword">new</span> Circle())</span><br><span class="line">                &#123;</span><br><span class="line">                    acCirc.Center = <span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                    acCirc.Radius = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">                    acBlkTblRec.AppendEntity(acCirc);</span><br><span class="line"></span><br><span class="line">                    acTrans.GetObject(acCurDb.BlockTableId, OpenMode.ForWrite);</span><br><span class="line">                    acBlkTbl.Add(acBlkTblRec);</span><br><span class="line">                    acTrans.AddNewlyCreatedDBObject(acBlkTblRec, <span class="literal">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                blkRecId = acBlkTblRec.Id;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            blkRecId = acBlkTbl[<span class="string">&quot;CircleBlock&quot;</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Insert the block into the current space</span></span><br><span class="line">        <span class="keyword">if</span> (blkRecId != ObjectId.Null)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (BlockReference acBlkRef = <span class="keyword">new</span> BlockReference(<span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), blkRecId))</span><br><span class="line">            &#123;</span><br><span class="line">                BlockTableRecord acCurSpaceBlkTblRec;</span><br><span class="line">                acCurSpaceBlkTblRec = acTrans.GetObject(acCurDb.CurrentSpaceId, OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">                acCurSpaceBlkTblRec.AppendEntity(acBlkRef);</span><br><span class="line">                acTrans.AddNewlyCreatedDBObject(acBlkRef, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">using</span> (DBObjectCollection dbObjCol = <span class="keyword">new</span> DBObjectCollection())</span><br><span class="line">                &#123;</span><br><span class="line">                    acBlkRef.Explode(dbObjCol);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">foreach</span> (DBObject dbObj <span class="keyword">in</span> dbObjCol)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Entity acEnt = dbObj <span class="keyword">as</span> Entity;</span><br><span class="line"></span><br><span class="line">                        acCurSpaceBlkTblRec.AppendEntity(acEnt);</span><br><span class="line">                        acTrans.AddNewlyCreatedDBObject(dbObj, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">                        acEnt = acTrans.GetObject(dbObj.ObjectId, OpenMode.ForWrite) <span class="keyword">as</span> Entity;</span><br><span class="line"></span><br><span class="line">                        acEnt.ColorIndex = <span class="number">1</span>;</span><br><span class="line">                        Application.ShowAlertDialog(<span class="string">&quot;Exploded Object: &quot;</span> + acEnt.GetRXClass().DxfName);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new object to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dispose of the transaction</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="重新定义块（-NET）"><a href="#重新定义块（-NET）" class="headerlink" title="重新定义块（.NET）"></a>重新定义块（.NET）</h4><p>使用任何Block对象方法和特性来重定义块。重定义块时，图形中对该块的所有参照将立即更新以反映新定义。</p>
<p>重定义会影响以前和将来插入的块。常量属性将丢失并被任何新的常量属性替换。变量属性保持不变，即使新块没有属性。</p>
<h4 id="在块定义中重定义对象"><a href="#在块定义中重定义对象" class="headerlink" title="在块定义中重定义对象"></a>在块定义中重定义对象</h4><p>此示例创建一个块并将圆添加到块的定义中。然后，块将作为块参照插入到图形中。块定义中的圆将更新，块参照也将自动更新。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;RedefiningABlock&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RedefiningABlock</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database and start a transaction</span></span><br><span class="line">    Database acCurDb;</span><br><span class="line">    acCurDb = Application.DocumentManager.MdiActiveDocument.Database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId, OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!acBlkTbl.Has(<span class="string">&quot;CircleBlock&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (BlockTableRecord acBlkTblRec = <span class="keyword">new</span> BlockTableRecord())</span><br><span class="line">            &#123;</span><br><span class="line">                acBlkTblRec.Name = <span class="string">&quot;CircleBlock&quot;</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Set the insertion point for the block</span></span><br><span class="line">                acBlkTblRec.Origin = <span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Add a circle to the block</span></span><br><span class="line">                <span class="keyword">using</span> (Circle acCirc = <span class="keyword">new</span> Circle())</span><br><span class="line">                &#123;</span><br><span class="line">                    acCirc.Center = <span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                    acCirc.Radius = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">                    acBlkTblRec.AppendEntity(acCirc);</span><br><span class="line"></span><br><span class="line">                    acTrans.GetObject(acCurDb.BlockTableId, OpenMode.ForWrite);</span><br><span class="line">                    acBlkTbl.Add(acBlkTblRec);</span><br><span class="line">                    acTrans.AddNewlyCreatedDBObject(acBlkTblRec, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Insert the block into the current space</span></span><br><span class="line">                    <span class="keyword">using</span> (BlockReference acBlkRef = <span class="keyword">new</span> BlockReference(<span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), acBlkTblRec.Id))</span><br><span class="line">                    &#123;</span><br><span class="line">                        BlockTableRecord acModelSpace;</span><br><span class="line">                        acModelSpace = acTrans.GetObject(acCurDb.CurrentSpaceId, OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">                        acModelSpace.AppendEntity(acBlkRef);</span><br><span class="line">                        acTrans.AddNewlyCreatedDBObject(acBlkRef, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">                        Application.ShowAlertDialog(<span class="string">&quot;CircleBlock has been created.&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Redefine the block if it exists</span></span><br><span class="line">            BlockTableRecord acBlkTblRec =</span><br><span class="line">                acTrans.GetObject(acBlkTbl[<span class="string">&quot;CircleBlock&quot;</span>], OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Step through each object in the block table record</span></span><br><span class="line">            <span class="keyword">foreach</span> (ObjectId objID <span class="keyword">in</span> acBlkTblRec)</span><br><span class="line">            &#123;</span><br><span class="line">                DBObject dbObj = acTrans.GetObject(objID, OpenMode.ForRead) <span class="keyword">as</span> DBObject;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Revise the circle in the block</span></span><br><span class="line">                <span class="keyword">if</span> (dbObj <span class="keyword">is</span> Circle)</span><br><span class="line">                &#123;</span><br><span class="line">                    Circle acCirc = dbObj <span class="keyword">as</span> Circle;</span><br><span class="line"></span><br><span class="line">                    acTrans.GetObject(objID, OpenMode.ForWrite);</span><br><span class="line">                    acCirc.Radius = acCirc.Radius * <span class="number">2</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Update existing block references</span></span><br><span class="line">            <span class="keyword">foreach</span> (ObjectId objID <span class="keyword">in</span> acBlkTblRec.GetBlockReferenceIds(<span class="literal">false</span>, <span class="literal">true</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                BlockReference acBlkRef = acTrans.GetObject(objID, OpenMode.ForWrite) <span class="keyword">as</span> BlockReference;</span><br><span class="line">                acBlkRef.RecordGraphicsModified(<span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Application.ShowAlertDialog(<span class="string">&quot;CircleBlock has been revised.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new object to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dispose of the transaction</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用特性（-NET）"><a href="#使用特性（-NET）" class="headerlink" title="使用特性（.NET）"></a>使用特性（.NET）</h3><p>特性参照提供交互式标签或标记，以便将文字附着到块。数据的示例包括部件号、价格、注释和所有者姓名。</p>
<p>可以从工程图中提取特性参照信息，并在电子表格或数据库中使用该信息来生成明细表或BOM表等条目。可以将多个特性参照与块关联，前提是每个特性参照具有不同的标记。还可以定义常量特性。由于它们在块的每个引用中具有相同的值，因此在插入块时AutoCAD不会提示输入值。</p>
<p>特性可以是不可见的，这意味着不显示或打印特性参照。但是，有关特性参照的信息存储在图形文件中。</p>
<p>有关使用特性的详细信息，请参见产品帮助系统中的“关于定义和附着块特性”。</p>
<p>本节中的主题</p>
<ul>
<li>创建特性定义和特性引用（.NET）</li>
<li>编辑特性定义（.NET）</li>
<li>提取特性信息（.NET）</li>
</ul>
<h4 id="创建特性定义和特性引用（-NET）"><a href="#创建特性定义和特性引用（-NET）" class="headerlink" title="创建特性定义和特性引用（.NET）"></a>创建特性定义和特性引用（.NET）</h4><p>若要创建特性定义，首先必须创建一个AttributeDefinition对象，然后使用ObjectEntity方法将其追加到BlockTableRecord对象。定义特性定义时，应指定特性文字的高度、特性模式、提示和标记字符串、插入点以及默认特性值。</p>
<p>特性定义的模式由以下属性控制：</p>
<ul>
<li><p>Constant </p>
<p>为块插入赋予特性一个固定值。</p>
</li>
<li><p>Invisible </p>
<p>指定插入块时不显示或打印特性值。ATTDISP命令将覆盖所有特性的不可见模式。</p>
</li>
<li><p>IsMTextAttributeDefinition</p>
<p>指定特性值可以包含多行文本。选择此选项后，可以指定特性的边界宽度。</p>
</li>
<li><p>LockPositionInBlock</p>
<p> 锁定块参照中特性的位置。解锁后，可以使用夹点编辑相对于块的其余部分移动特性，并且可以调整多行特性的大小。</p>
</li>
<li><p>Preset </p>
<p>插入包含预设特性的块时，将特性设置为其默认值。</p>
</li>
<li><p>Verifiable </p>
<p>允许您在插入块时验证特性值是否正确。</p>
</li>
</ul>
<p>当插入包含特性的块并使用Prompt属性进行设置时，将显示提示字符串。该特性的默认值使用TextString属性设置。如果“常量”属性设定为“真”，则在插入具有特性定义的块时，将禁用提示输入新值。</p>
<p>标记字符串标识特性的每次出现，并分配有Tag属性。您可以使用除空格或感叹号以外的任何字符。AutoCAD将小写字母更改为大写。</p>
<p>一旦在块中定义了特性定义，则无论何时使用NULL命令插入块，都可以为每个未定义为常量的特性参照指定不同的值。创建BlockReference对象时，该对象不包含在BlockTableRecord对象中定义的任何特性，直到这些特性使用BlockAttribute方法附加到BlockReference对象。</p>
<p>在将特性附加到BlockReference对象之前，请使用SetAttributeFromBlock方法将AttributeDefinition对象的特性复制到AttributeReference对象。HasAttributeDefinitions特性可用于块表记录，以查看它是否包含特性定义。</p>
<p>在模型空间或图纸空间中创建的特性定义不被视为附着到任何给定块。</p>
<p><strong>定义特性定义</strong><br>此示例创建一个块，然后向该块添加特性。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;AddingAttributeToABlock&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddingAttributeToABlock</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database and start a transaction</span></span><br><span class="line">    Database acCurDb;</span><br><span class="line">    acCurDb = Application.DocumentManager.MdiActiveDocument.Database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId, OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!acBlkTbl.Has(<span class="string">&quot;CircleBlockWithAttributes&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (BlockTableRecord acBlkTblRec = <span class="keyword">new</span> BlockTableRecord())</span><br><span class="line">            &#123;</span><br><span class="line">                acBlkTblRec.Name = <span class="string">&quot;CircleBlockWithAttributes&quot;</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Set the insertion point for the block</span></span><br><span class="line">                acBlkTblRec.Origin = <span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Add a circle to the block</span></span><br><span class="line">                <span class="keyword">using</span> (Circle acCirc = <span class="keyword">new</span> Circle())</span><br><span class="line">                &#123;</span><br><span class="line">                    acCirc.Center = <span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                    acCirc.Radius = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">                    acBlkTblRec.AppendEntity(acCirc);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Add an attribute definition to the block</span></span><br><span class="line">                    <span class="keyword">using</span> (AttributeDefinition acAttDef = <span class="keyword">new</span> AttributeDefinition())</span><br><span class="line">                    &#123;</span><br><span class="line">                        acAttDef.Position = <span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                        acAttDef.Verifiable = <span class="literal">true</span>;</span><br><span class="line">                        acAttDef.Prompt = <span class="string">&quot;Door #: &quot;</span>;</span><br><span class="line">                        acAttDef.Tag = <span class="string">&quot;Door#&quot;</span>;</span><br><span class="line">                        acAttDef.TextString = <span class="string">&quot;DXX&quot;</span>;</span><br><span class="line">                        acAttDef.Height = <span class="number">1</span>;</span><br><span class="line">                        acAttDef.Justify = AttachmentPoint.MiddleCenter;</span><br><span class="line"></span><br><span class="line">                        acBlkTblRec.AppendEntity(acAttDef);</span><br><span class="line"></span><br><span class="line">                        acTrans.GetObject(acCurDb.BlockTableId, OpenMode.ForWrite);</span><br><span class="line">                        acBlkTbl.Add(acBlkTblRec);</span><br><span class="line">                        acTrans.AddNewlyCreatedDBObject(acBlkTblRec, <span class="literal">true</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new object to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dispose of the transaction</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>插入具有特性的块</strong><br>此示例创建一个具有属性的块，然后将该块插入当前空间。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;InsertingBlockWithAnAttribute&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">InsertingBlockWithAnAttribute</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database and start a transaction</span></span><br><span class="line">    Database acCurDb;</span><br><span class="line">    acCurDb = Application.DocumentManager.MdiActiveDocument.Database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId, OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        ObjectId blkRecId = ObjectId.Null;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!acBlkTbl.Has(<span class="string">&quot;CircleBlockWithAttributes&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (BlockTableRecord acBlkTblRec = <span class="keyword">new</span> BlockTableRecord())</span><br><span class="line">            &#123;</span><br><span class="line">                acBlkTblRec.Name = <span class="string">&quot;CircleBlockWithAttributes&quot;</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Set the insertion point for the block</span></span><br><span class="line">                acBlkTblRec.Origin = <span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Add a circle to the block</span></span><br><span class="line">                <span class="keyword">using</span> (Circle acCirc = <span class="keyword">new</span> Circle())</span><br><span class="line">                &#123;</span><br><span class="line">                    acCirc.Center = <span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                    acCirc.Radius = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">                    acBlkTblRec.AppendEntity(acCirc);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Add an attribute definition to the block</span></span><br><span class="line">                    <span class="keyword">using</span> (AttributeDefinition acAttDef = <span class="keyword">new</span> AttributeDefinition())</span><br><span class="line">                    &#123;</span><br><span class="line">                        acAttDef.Position = <span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                        acAttDef.Prompt = <span class="string">&quot;Door #: &quot;</span>;</span><br><span class="line">                        acAttDef.Tag = <span class="string">&quot;Door#&quot;</span>;</span><br><span class="line">                        acAttDef.TextString = <span class="string">&quot;DXX&quot;</span>;</span><br><span class="line">                        acAttDef.Height = <span class="number">1</span>;</span><br><span class="line">                        acAttDef.Justify = AttachmentPoint.MiddleCenter;</span><br><span class="line">                        acBlkTblRec.AppendEntity(acAttDef);</span><br><span class="line"></span><br><span class="line">                        acTrans.GetObject(acCurDb.BlockTableId, OpenMode.ForWrite);</span><br><span class="line">                        acBlkTbl.Add(acBlkTblRec);</span><br><span class="line">                        acTrans.AddNewlyCreatedDBObject(acBlkTblRec, <span class="literal">true</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                blkRecId = acBlkTblRec.Id;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            blkRecId = acBlkTbl[<span class="string">&quot;CircleBlockWithAttributes&quot;</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Insert the block into the current space</span></span><br><span class="line">        <span class="keyword">if</span> (blkRecId != ObjectId.Null)</span><br><span class="line">        &#123;</span><br><span class="line">            BlockTableRecord acBlkTblRec;</span><br><span class="line">            acBlkTblRec = acTrans.GetObject(blkRecId, OpenMode.ForRead) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Create and insert the new block reference</span></span><br><span class="line">            <span class="keyword">using</span> (BlockReference acBlkRef = <span class="keyword">new</span> BlockReference(<span class="keyword">new</span> Point3d(<span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>), blkRecId))</span><br><span class="line">            &#123;</span><br><span class="line">                BlockTableRecord acCurSpaceBlkTblRec;</span><br><span class="line">                acCurSpaceBlkTblRec = acTrans.GetObject(acCurDb.CurrentSpaceId, OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">                acCurSpaceBlkTblRec.AppendEntity(acBlkRef);</span><br><span class="line">                acTrans.AddNewlyCreatedDBObject(acBlkRef, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Verify block table record has attribute definitions associated with it</span></span><br><span class="line">                <span class="keyword">if</span> (acBlkTblRec.HasAttributeDefinitions)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// Add attributes from the block table record</span></span><br><span class="line">                    <span class="keyword">foreach</span> (ObjectId objID <span class="keyword">in</span> acBlkTblRec)</span><br><span class="line">                    &#123;</span><br><span class="line">                        DBObject dbObj = acTrans.GetObject(objID, OpenMode.ForRead) <span class="keyword">as</span> DBObject;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (dbObj <span class="keyword">is</span> AttributeDefinition)</span><br><span class="line">                        &#123;</span><br><span class="line">                            AttributeDefinition acAtt = dbObj <span class="keyword">as</span> AttributeDefinition;</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">if</span> (!acAtt.Constant)</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="keyword">using</span> (AttributeReference acAttRef = <span class="keyword">new</span> AttributeReference())</span><br><span class="line">                                &#123;</span><br><span class="line">                                    acAttRef.SetAttributeFromBlock(acAtt, acBlkRef.BlockTransform);</span><br><span class="line">                                    acAttRef.Position = acAtt.Position.TransformBy(acBlkRef.BlockTransform);</span><br><span class="line"></span><br><span class="line">                                    acAttRef.TextString = acAtt.TextString;</span><br><span class="line"></span><br><span class="line">                                    acBlkRef.AttributeCollection.AppendAttribute(acAttRef);</span><br><span class="line"></span><br><span class="line">                                    acTrans.AddNewlyCreatedDBObject(acAttRef, <span class="literal">true</span>);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new object to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dispose of the transaction</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编辑特性定义（-NET）"><a href="#编辑特性定义（-NET）" class="headerlink" title="编辑特性定义（.NET）"></a>编辑特性定义（.NET）</h4><p>可以使用Attribute对象属性和方法来编辑特性。特性上的某些属性包括：</p>
<ul>
<li><p>FieldLength </p>
<p>指定特性的字段长度</p>
</li>
<li><p>Height </p>
<p>指定特性的高度</p>
</li>
<li><p>HorizontalMode </p>
<p>指定特性的水平对齐方式</p>
</li>
<li><p>IsMirroredInX</p>
<p>指定特性的文本向后显示</p>
</li>
<li><p>IsMirroredInY</p>
<p>指定特性的文本上下颠倒显示</p>
</li>
<li><p>Position</p>
<p>指定特性的插入点</p>
</li>
<li><p>Prompt </p>
<p>指定特性的提示字符串</p>
</li>
<li><p>Rotation </p>
<p>指定特性的旋转</p>
</li>
<li><p>Tag </p>
<p>指定特性的标记字符串</p>
</li>
<li><p>TextString</p>
<p>指定特性的默认值</p>
</li>
<li><p>VerticalMode</p>
<p>指定特性的垂直对齐方式</p>
</li>
</ul>
<p>重定义特性定义<br>此示例创建一个块，然后向该块添加特性。然后将块插入到图形中。然后，特性文字将更新为向后显示。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;RedefiningAnAttribute&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RedefiningAnAttribute</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database and start a transaction</span></span><br><span class="line">    Database acCurDb;</span><br><span class="line">    acCurDb = Application.DocumentManager.MdiActiveDocument.Database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId, OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        ObjectId blkRecId = ObjectId.Null;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!acBlkTbl.Has(<span class="string">&quot;CircleBlockWithAttributes&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (BlockTableRecord acBlkTblRec = <span class="keyword">new</span> BlockTableRecord())</span><br><span class="line">            &#123;</span><br><span class="line">                acBlkTblRec.Name = <span class="string">&quot;CircleBlockWithAttributes&quot;</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Set the insertion point for the block</span></span><br><span class="line">                acBlkTblRec.Origin = <span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Add a circle to the block</span></span><br><span class="line">                <span class="keyword">using</span> (Circle acCirc = <span class="keyword">new</span> Circle())</span><br><span class="line">                &#123;</span><br><span class="line">                    acCirc.Center = <span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                    acCirc.Radius = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">                    acBlkTblRec.AppendEntity(acCirc);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Add an attribute definition to the block</span></span><br><span class="line">                    <span class="keyword">using</span> (AttributeDefinition acAttDef = <span class="keyword">new</span> AttributeDefinition())</span><br><span class="line">                    &#123;</span><br><span class="line">                        acAttDef.Position = <span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                        acAttDef.Prompt = <span class="string">&quot;Door #: &quot;</span>;</span><br><span class="line">                        acAttDef.Tag = <span class="string">&quot;Door#&quot;</span>;</span><br><span class="line">                        acAttDef.TextString = <span class="string">&quot;DXX&quot;</span>;</span><br><span class="line">                        acAttDef.Height = <span class="number">1</span>;</span><br><span class="line">                        acAttDef.Justify = AttachmentPoint.MiddleCenter;</span><br><span class="line">                        acBlkTblRec.AppendEntity(acAttDef);</span><br><span class="line"></span><br><span class="line">                        acTrans.GetObject(acCurDb.BlockTableId, OpenMode.ForWrite);</span><br><span class="line">                        acBlkTbl.Add(acBlkTblRec);</span><br><span class="line">                        acTrans.AddNewlyCreatedDBObject(acBlkTblRec, <span class="literal">true</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                blkRecId = acBlkTblRec.Id;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            blkRecId = acBlkTbl[<span class="string">&quot;CircleBlockWithAttributes&quot;</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create and insert the new block reference</span></span><br><span class="line">        <span class="keyword">if</span> (blkRecId != ObjectId.Null)</span><br><span class="line">        &#123;</span><br><span class="line">            BlockTableRecord acBlkTblRec;</span><br><span class="line">            acBlkTblRec = acTrans.GetObject(blkRecId, OpenMode.ForRead) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">using</span> (BlockReference acBlkRef = <span class="keyword">new</span> BlockReference(<span class="keyword">new</span> Point3d(<span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>), blkRecId))</span><br><span class="line">            &#123;</span><br><span class="line">                BlockTableRecord acCurSpaceBlkTblRec;</span><br><span class="line">                acCurSpaceBlkTblRec = acTrans.GetObject(acCurDb.CurrentSpaceId, OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">                acCurSpaceBlkTblRec.AppendEntity(acBlkRef);</span><br><span class="line">                acTrans.AddNewlyCreatedDBObject(acBlkRef, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Verify block table record has attribute definitions associated with it</span></span><br><span class="line">                <span class="keyword">if</span> (acBlkTblRec.HasAttributeDefinitions)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// Add attributes from the block table record</span></span><br><span class="line">                    <span class="keyword">foreach</span> (ObjectId objID <span class="keyword">in</span> acBlkTblRec)</span><br><span class="line">                    &#123;</span><br><span class="line">                        DBObject dbObj = acTrans.GetObject(objID, OpenMode.ForRead) <span class="keyword">as</span> DBObject;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (dbObj <span class="keyword">is</span> AttributeDefinition)</span><br><span class="line">                        &#123;</span><br><span class="line">                            AttributeDefinition acAtt = dbObj <span class="keyword">as</span> AttributeDefinition;</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">if</span> (!acAtt.Constant)</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="keyword">using</span> (AttributeReference acAttRef = <span class="keyword">new</span> AttributeReference())</span><br><span class="line">                                &#123;</span><br><span class="line">                                    acAttRef.SetAttributeFromBlock(acAtt, acBlkRef.BlockTransform);</span><br><span class="line">                                    acAttRef.Position = acAtt.Position.TransformBy(acBlkRef.BlockTransform);</span><br><span class="line"></span><br><span class="line">                                    acAttRef.TextString = acAtt.TextString;</span><br><span class="line"></span><br><span class="line">                                    acBlkRef.AttributeCollection.AppendAttribute(acAttRef);</span><br><span class="line">                                    acTrans.AddNewlyCreatedDBObject(acAttRef, <span class="literal">true</span>);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            <span class="comment">// Change the attribute definition to be displayed as backwards</span></span><br><span class="line">                            acTrans.GetObject(objID, OpenMode.ForWrite);</span><br><span class="line">                            acAtt.IsMirroredInX = <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new object to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dispose of the transaction</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="提取特性信息（-NET）"><a href="#提取特性信息（-NET）" class="headerlink" title="提取特性信息（.NET）"></a>提取特性信息（.NET）</h4><p>可以使用AttributeCollection属性从块参照中提取特性信息。AttributeCollection属性返回附加到块的特性引用的集合。单步执行集合时，可以使用IsConstant属性查看是否可以更改某个特性值。</p>
<p>不需要模板文件来提取特性信息，并且不创建特性信息文件。只需使用特性引用的Tag和TextString属性检查属性引用集合的特性信息。您还需要检查IsMTextAttribute是否为True或False，如果为True，则需要使用MTextAttribute属性获取多行特性的文本值。</p>
<p>有关提取特性信息的详细信息，请参见产品帮助系统中的“关于从块特性提取数据”。</p>
<p><strong>获取特性引用信息</strong></p>
<p>此示例创建一个块，然后向该块添加特性。然后将块插入到图形中。然后返回特性数据并使用消息框显示。然后将更新块参照的特性数据，并再次返回和显示特性数据。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;GettingAttributes&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GettingAttributes</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database and start a transaction</span></span><br><span class="line">    Database acCurDb;</span><br><span class="line">    acCurDb = Application.DocumentManager.MdiActiveDocument.Database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId, OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        ObjectId blkRecId = ObjectId.Null;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!acBlkTbl.Has(<span class="string">&quot;TESTBLOCK&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (BlockTableRecord acBlkTblRec = <span class="keyword">new</span> BlockTableRecord())</span><br><span class="line">            &#123;</span><br><span class="line">                acBlkTblRec.Name = <span class="string">&quot;TESTBLOCK&quot;</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Set the insertion point for the block</span></span><br><span class="line">                acBlkTblRec.Origin = <span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Add an attribute definition to the block</span></span><br><span class="line">                <span class="keyword">using</span> (AttributeDefinition acAttDef = <span class="keyword">new</span> AttributeDefinition())</span><br><span class="line">                &#123;</span><br><span class="line">                    acAttDef.Position = <span class="keyword">new</span> Point3d(<span class="number">5</span>, <span class="number">5</span>, <span class="number">0</span>);</span><br><span class="line">                    acAttDef.Prompt = <span class="string">&quot;Attribute Prompt&quot;</span>;</span><br><span class="line">                    acAttDef.Tag = <span class="string">&quot;AttributeTag&quot;</span>;</span><br><span class="line">                    acAttDef.TextString = <span class="string">&quot;Attribute Value&quot;</span>;</span><br><span class="line">                    acAttDef.Height = <span class="number">1</span>;</span><br><span class="line">                    acAttDef.Justify = AttachmentPoint.MiddleCenter;</span><br><span class="line">                    acBlkTblRec.AppendEntity(acAttDef);</span><br><span class="line"></span><br><span class="line">                    acTrans.GetObject(acCurDb.BlockTableId, OpenMode.ForWrite);</span><br><span class="line">                    acBlkTbl.Add(acBlkTblRec);</span><br><span class="line">                    acTrans.AddNewlyCreatedDBObject(acBlkTblRec, <span class="literal">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                blkRecId = acBlkTblRec.Id;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            blkRecId = acBlkTbl[<span class="string">&quot;CircleBlockWithAttributes&quot;</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create and insert the new block reference</span></span><br><span class="line">        <span class="keyword">if</span> (blkRecId != ObjectId.Null)</span><br><span class="line">        &#123;</span><br><span class="line">            BlockTableRecord acBlkTblRec;</span><br><span class="line">            acBlkTblRec = acTrans.GetObject(blkRecId, OpenMode.ForRead) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">using</span> (BlockReference acBlkRef = <span class="keyword">new</span> BlockReference(<span class="keyword">new</span> Point3d(<span class="number">5</span>, <span class="number">5</span>, <span class="number">0</span>), acBlkTblRec.Id))</span><br><span class="line">            &#123;</span><br><span class="line">                BlockTableRecord acCurSpaceBlkTblRec;</span><br><span class="line">                acCurSpaceBlkTblRec = acTrans.GetObject(acCurDb.CurrentSpaceId, OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">                acCurSpaceBlkTblRec.AppendEntity(acBlkRef);</span><br><span class="line">                acTrans.AddNewlyCreatedDBObject(acBlkRef, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Verify block table record has attribute definitions associated with it</span></span><br><span class="line">                <span class="keyword">if</span> (acBlkTblRec.HasAttributeDefinitions)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// Add attributes from the block table record</span></span><br><span class="line">                    <span class="keyword">foreach</span> (ObjectId objID <span class="keyword">in</span> acBlkTblRec)</span><br><span class="line">                    &#123;</span><br><span class="line">                        DBObject dbObj = acTrans.GetObject(objID, OpenMode.ForRead) <span class="keyword">as</span> DBObject;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (dbObj <span class="keyword">is</span> AttributeDefinition)</span><br><span class="line">                        &#123;</span><br><span class="line">                            AttributeDefinition acAtt = dbObj <span class="keyword">as</span> AttributeDefinition;</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">if</span> (!acAtt.Constant)</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="keyword">using</span> (AttributeReference acAttRef = <span class="keyword">new</span> AttributeReference())</span><br><span class="line">                                &#123;</span><br><span class="line">                                    acAttRef.SetAttributeFromBlock(acAtt, acBlkRef.BlockTransform);</span><br><span class="line">                                    acAttRef.Position = acAtt.Position.TransformBy(acBlkRef.BlockTransform);</span><br><span class="line"></span><br><span class="line">                                    acAttRef.TextString = acAtt.TextString;</span><br><span class="line"></span><br><span class="line">                                    acBlkRef.AttributeCollection.AppendAttribute(acAttRef);</span><br><span class="line">                                    acTrans.AddNewlyCreatedDBObject(acAttRef, <span class="literal">true</span>);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Display the tags and values of the attached attributes</span></span><br><span class="line">                    <span class="built_in">string</span> strMessage = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                    AttributeCollection attCol = acBlkRef.AttributeCollection;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">foreach</span> (ObjectId objID <span class="keyword">in</span> attCol)</span><br><span class="line">                    &#123;</span><br><span class="line">                        DBObject dbObj = acTrans.GetObject(objID, OpenMode.ForRead) <span class="keyword">as</span> DBObject;</span><br><span class="line"></span><br><span class="line">                        AttributeReference acAttRef = dbObj <span class="keyword">as</span> AttributeReference;</span><br><span class="line"></span><br><span class="line">                        strMessage = strMessage + <span class="string">&quot;Tag: &quot;</span> + acAttRef.Tag + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                                        <span class="string">&quot;Value: &quot;</span> + acAttRef.TextString + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// Change the value of the attribute</span></span><br><span class="line">                        acAttRef.TextString = <span class="string">&quot;NEW VALUE!&quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    Application.ShowAlertDialog(<span class="string">&quot;The attributes for blockReference &quot;</span> + acBlkRef.Name + <span class="string">&quot; are:\n&quot;</span> + strMessage);</span><br><span class="line"></span><br><span class="line">                    strMessage = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                    <span class="keyword">foreach</span> (ObjectId objID <span class="keyword">in</span> attCol)</span><br><span class="line">                    &#123;</span><br><span class="line">                        DBObject dbObj = acTrans.GetObject(objID, OpenMode.ForRead) <span class="keyword">as</span> DBObject;</span><br><span class="line"></span><br><span class="line">                        AttributeReference acAttRef = dbObj <span class="keyword">as</span> AttributeReference;</span><br><span class="line"></span><br><span class="line">                        strMessage = strMessage + <span class="string">&quot;Tag: &quot;</span> + acAttRef.Tag + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                                        <span class="string">&quot;Value: &quot;</span> + acAttRef.TextString + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    Application.ShowAlertDialog(<span class="string">&quot;The attributes for blockReference &quot;</span> + acBlkRef.Name + <span class="string">&quot; are:\n&quot;</span> + strMessage);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new object to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dispose of the transaction</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用外部引用（-NET）"><a href="#使用外部引用（-NET）" class="headerlink" title="使用外部引用（.NET）"></a>使用外部引用（.NET）</h2><p>外部参照将另一个图形链接到当前图形。将图形作为块插入时，块和所有关联的几何图形都存储在当前图形数据库中。如果原始图形发生更改，则不会更新该文件。但是，当您将图形作为外部参照插入时，外部参照将在原始图形更改时更新。因此，包含外部参照的图形始终反映每个外部参照文件的最新编辑。</p>
<p>与块参照一样，外部参照在当前图形中显示为单个对象。但是，外部参照不会显著增加当前图形的文件大小，因此不能分解。与块一样，可以嵌套附着到图形的外部参照。</p>
<p>有关外部参照的详细信息，请参见产品帮助系统中的“关于附着和拆离参照图形（外部参照）”。</p>
<p>本节中的主题</p>
<ul>
<li>更新外部参照（.NET）</li>
<li>附着外部参照（.NET）</li>
<li>分离外部参照（.NET）</li>
<li>重新加载外部参照（.NET）</li>
<li>卸载外部参照（.NET）</li>
<li>绑定外部参照（.NET）</li>
<li>剪裁块和外部参照（.NET）</li>
<li>加载和外部参照性能（.NET）</li>
</ul>
<h3 id="更新外部参照（-NET）"><a href="#更新外部参照（-NET）" class="headerlink" title="更新外部参照（.NET）"></a>更新外部参照（.NET）</h3><p>打开或打印图形时，AutoCAD会重新加载每个外部参照以反映参照图形的最新状态。对外部参照图形进行修改并保存文件后，其他用户可以通过重新加载外部参照立即访问您所做的修改。</p>
<h3 id="附着外部参照（-NET）"><a href="#附着外部参照（-NET）" class="headerlink" title="附着外部参照（.NET）"></a>附着外部参照（.NET）</h3><p>附着外部参照将一个图形（参照文件或外部参照）链接到当前图形。当图形参照外部参照时，AutoCAD仅将外部参照定义附着到图形，这与常规块不同，常规块的块定义和块的内容与当前图形一起存储。AutoCAD将读取参照图形以确定要在当前图形中显示的内容。如果参照文件丢失或损坏，则其数据不会显示在当前图形中。每次打开图形时，AutoCAD都会加载参照文件中的所有图形和非图形（例如图层、线型和文字样式）对象。如果VISRETAIN系统变量处于启用状态，AutoCAD将在当前图形中存储任何更新的外部参照相关图层信息。</p>
<p>可以附着任意数量的外部参照副本，每个副本都可以具有不同的位置、比例和旋转。还可以控制在外部参照中定义的从属图层和线型特性。</p>
<p>要附着外部参照，请使用 AttachXref 方法。此方法要求输入要参照的图形的路径和文件名，以及当前图形中使用的外部参照的名称。 AttachXref 方法返回新创建对象的 ObjectId 。返回的 ObjectId 用于创建新的 BlockReference 对象并定义其在图形中的位置。创建 BlockReference 对象后，可以调整其旋转和缩放。</p>
<p>有关附着外部参照的详细信息，请参见产品帮助系统中的“关于附着和拆离参照图形（外部参照）”。</p>
<p><strong>将外部参照附着到图形</strong></p>
<p>此示例显示添加外部参照前后当前图形中的所有块。本示例使用Sample目录中的Exterior Elevations.dwg文件。如果没有此文件，或者它位于其他目录中，请插入有效的路径和文件名。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;AttachingExternalReference&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AttachingExternalReference</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database and start a transaction</span></span><br><span class="line">    Database acCurDb;</span><br><span class="line">    acCurDb = Application.DocumentManager.MdiActiveDocument.Database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Create a reference to a DWG file</span></span><br><span class="line">        <span class="built_in">string</span> PathName = <span class="string">&quot;C:\\AutoCAD\\Sample\\Sheet Sets\\Architectural\\Res\\Exterior Elevations.dwg&quot;</span>;</span><br><span class="line">        ObjectId acXrefId = acCurDb.AttachXref(PathName, <span class="string">&quot;Exterior Elevations&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If a valid reference is created then continue</span></span><br><span class="line">        <span class="keyword">if</span> (!acXrefId.IsNull)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Attach the DWG reference to the current space</span></span><br><span class="line">            Point3d insPt = <span class="keyword">new</span> Point3d(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">using</span> (BlockReference acBlkRef = <span class="keyword">new</span> BlockReference(insPt, acXrefId))</span><br><span class="line">            &#123;</span><br><span class="line">                BlockTableRecord acBlkTblRec;</span><br><span class="line">                acBlkTblRec = acTrans.GetObject(acCurDb.CurrentSpaceId, OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">                acBlkTblRec.AppendEntity(acBlkRef);</span><br><span class="line">                acTrans.AddNewlyCreatedDBObject(acBlkRef, <span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new objects to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dispose of the transaction</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="分离外部参照（-NET）"><a href="#分离外部参照（-NET）" class="headerlink" title="分离外部参照（.NET）"></a>分离外部参照（.NET）</h3><p>可以拆离外部参照定义，以便从图形中完全删除外部参照。也可以删除各个外部参照实例。拆离外部参照定义将删除与该外部参照关联的所有从属符号。如果从图形中删除了外部参照的所有实例，则AutoCAD将在下次打开图形时删除外部参照定义。</p>
<p>要拆离外部参照，请使用 DetachXref 方法。不能拆离嵌套的外部参照。</p>
<p><strong>分离外部参照定义</strong></p>
<p>此示例附着外部参照，然后分离外部参照。本示例使用Sample目录中的Exterior Elevations.dwg文件。如果您没有此图像，或者它位于其他目录中，请插入有效的路径和文件名。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;DetachingExternalReference&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DetachingExternalReference</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database and start a transaction</span></span><br><span class="line">    Database acCurDb;</span><br><span class="line">    acCurDb = Application.DocumentManager.MdiActiveDocument.Database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Create a reference to a DWG file</span></span><br><span class="line">        <span class="built_in">string</span> PathName = <span class="string">&quot;C:\\AutoCAD\\Sample\\Sheet Sets\\Architectural\\Res\\Exterior Elevations.dwg&quot;</span>;</span><br><span class="line">        ObjectId acXrefId = acCurDb.AttachXref(PathName, <span class="string">&quot;Exterior Elevations&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If a valid reference is created then continue</span></span><br><span class="line">        <span class="keyword">if</span> (!acXrefId.IsNull)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Attach the DWG reference to the current space</span></span><br><span class="line">            Point3d insPt = <span class="keyword">new</span> Point3d(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">using</span> (BlockReference acBlkRef = <span class="keyword">new</span> BlockReference(insPt, acXrefId))</span><br><span class="line">            &#123;</span><br><span class="line">                BlockTableRecord acBlkTblRec;</span><br><span class="line">                acBlkTblRec = acTrans.GetObject(acCurDb.CurrentSpaceId, OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">                acBlkTblRec.AppendEntity(acBlkRef);</span><br><span class="line">                acTrans.AddNewlyCreatedDBObject(acBlkRef, <span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Application.ShowAlertDialog(<span class="string">&quot;The external reference is attached.&quot;</span>);</span><br><span class="line"></span><br><span class="line">            acCurDb.DetachXref(acXrefId);</span><br><span class="line"></span><br><span class="line">            Application.ShowAlertDialog(<span class="string">&quot;The external reference is detached.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new objects to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dispose of the transaction</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="重新加载外部参照（-NET）"><a href="#重新加载外部参照（-NET）" class="headerlink" title="重新加载外部参照（.NET）"></a>重新加载外部参照（.NET）</h3><p>如果在您处理外部参照附着到的宿主图形时，有人修改了该外部参照图形，则可以使用 Reload 方法更新该外部参照图形。重新加载时，选定的外部参照图形将在宿主图形中更新。此外，如果已卸载外部参照，则可以随时选择重新载入该外部参照图形。</p>
<p><strong>添加外部参照定义</strong></p>
<p>此示例附着外部参照，然后重新加载该外部参照。本示例使用<em>Sample</em>目录中的<em>Exterior Elevations.dwg</em>文件。如果您没有此图像，或者它位于其他目录中，请插入有效的路径和文件名。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;ReloadingExternalReference&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ReloadingExternalReference</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database and start a transaction</span></span><br><span class="line">    Database acCurDb;</span><br><span class="line">    acCurDb = Application.DocumentManager.MdiActiveDocument.Database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Create a reference to a DWG file</span></span><br><span class="line">        <span class="built_in">string</span> PathName = <span class="string">&quot;C:\\AutoCAD\\Sample\\Sheet Sets\\Architectural\\Res\\Exterior Elevations.dwg&quot;</span>;</span><br><span class="line">        ObjectId acXrefId = acCurDb.AttachXref(PathName, <span class="string">&quot;Exterior Elevations&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If a valid reference is created then continue</span></span><br><span class="line">        <span class="keyword">if</span> (!acXrefId.IsNull)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Attach the DWG reference to the current space</span></span><br><span class="line">            Point3d insPt = <span class="keyword">new</span> Point3d(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">using</span> (BlockReference acBlkRef = <span class="keyword">new</span> BlockReference(insPt, acXrefId))</span><br><span class="line">            &#123;</span><br><span class="line">                BlockTableRecord acBlkTblRec;</span><br><span class="line">                acBlkTblRec = acTrans.GetObject(acCurDb.CurrentSpaceId, OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">                acBlkTblRec.AppendEntity(acBlkRef);</span><br><span class="line">                acTrans.AddNewlyCreatedDBObject(acBlkRef, <span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Application.ShowAlertDialog(<span class="string">&quot;The external reference is attached.&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">using</span> (ObjectIdCollection acXrefIdCol = <span class="keyword">new</span> ObjectIdCollection())</span><br><span class="line">            &#123;</span><br><span class="line">                acXrefIdCol.Add(acXrefId);</span><br><span class="line"></span><br><span class="line">                acCurDb.ReloadXrefs(acXrefIdCol);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Application.ShowAlertDialog(<span class="string">&quot;The external reference is reloaded.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new objects to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dispose of the transaction</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="卸载外部参照（-NET）"><a href="#卸载外部参照（-NET）" class="headerlink" title="卸载外部参照（.NET）"></a>卸载外部参照（.NET）</h3><p>要卸载外部参照，请使用 Unload 方法。卸载当前图形中未使用的参照文件时，AutoCAD性能将得到增强，因为不必读取和显示不必要的图形几何图形或符号表信息。在重新加载外部参照之前，外部参照几何图形和任何嵌套外部参照的几何图形都不会显示在当前图形中。</p>
<p><strong>卸载外部参照定义</strong></p>
<p>此示例附着外部参照，然后卸载外部参照。本示例使用<em>Sample</em>目录中的<em>Exterior Elevations.dwg</em>文件。如果您没有此图像，或者它位于其他目录中，请插入有效的路径和文件名。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;UnloadingExternalReference&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UnloadingExternalReference</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database and start a transaction</span></span><br><span class="line">    Database acCurDb;</span><br><span class="line">    acCurDb = Application.DocumentManager.MdiActiveDocument.Database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Create a reference to a DWG file</span></span><br><span class="line">        <span class="built_in">string</span> PathName = <span class="string">&quot;C:\\AutoCAD\\Sample\\Sheet Sets\\Architectural\\Res\\Exterior Elevations.dwg&quot;</span>;</span><br><span class="line">        ObjectId acXrefId = acCurDb.AttachXref(PathName, <span class="string">&quot;Exterior Elevations&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If a valid reference is created then continue</span></span><br><span class="line">        <span class="keyword">if</span> (!acXrefId.IsNull)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Attach the DWG reference to the current space</span></span><br><span class="line">            Point3d insPt = <span class="keyword">new</span> Point3d(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">using</span> (BlockReference acBlkRef = <span class="keyword">new</span> BlockReference(insPt, acXrefId))</span><br><span class="line">            &#123;</span><br><span class="line">                BlockTableRecord acBlkTblRec;</span><br><span class="line">                acBlkTblRec = acTrans.GetObject(acCurDb.CurrentSpaceId, OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">                acBlkTblRec.AppendEntity(acBlkRef);</span><br><span class="line">                acTrans.AddNewlyCreatedDBObject(acBlkRef, <span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Application.ShowAlertDialog(<span class="string">&quot;The external reference is attached.&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">using</span> (ObjectIdCollection acXrefIdCol = <span class="keyword">new</span> ObjectIdCollection())</span><br><span class="line">            &#123;</span><br><span class="line">                acXrefIdCol.Add(acXrefId);</span><br><span class="line"></span><br><span class="line">                acCurDb.UnloadXrefs(acXrefIdCol);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Application.ShowAlertDialog(<span class="string">&quot;The external reference is unloaded.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new objects to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dispose of the transaction</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="绑定外部参照（-NET）"><a href="#绑定外部参照（-NET）" class="headerlink" title="绑定外部参照（.NET）"></a>绑定外部参照（.NET）</h3><p>使用Bind方法将外部参照绑定到图形使外部参照成为图形的永久部分，而不再是外部参照文件。外部引用的信息成为一个块。更新外部参照图形时，不会更新绑定的外部参照。此过程将绑定整个图形的数据库，包括其所有从属符号。</p>
<p>从属符号是命名对象，例如块、标注样式、图层、线型和文字样式。绑定外部参照允许在当前图形中使用外部参照中的命名对象。</p>
<p>BindXref 方法需要两个参数： xrefIds （ObjectID的集合）和 insertBind （布尔值）。如果将 insertBind 参数设置为True，则外部参照图形的符号名称在当前图形中将以*<blockname >$x $作为<em>前缀，其中</em>x*是一个整数，它将自动递增以避免替代现有的块定义。如果将 insertBind 参数设置为 False ，则外部参照图形的符号名称将合并到当前图形中，而不带前缀。如果存在重复的名称，AutoCAD将使用已在本地图形中定义的符号。如果不确定图形是否包含重复的符号名称，建议将 insertBind 设置为 True 。</p>
<p>有关绑定外部参照的详细信息，请参见产品帮助系统中的“关于使用外部参照绘制图形（绑定）”。</p>
<p><strong>绑定外部参照定义</strong><br>此示例附着外部参照，然后将外部参照绑定到图形。本示例使用Sample目录中的Exterior Elevations.dwg文件。如果您没有此图像，或者它位于其他目录中，请插入有效的路径和文件名。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;BindingExternalReference&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">BindingExternalReference</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database and start a transaction</span></span><br><span class="line">    Database acCurDb;</span><br><span class="line">    acCurDb = Application.DocumentManager.MdiActiveDocument.Database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Create a reference to a DWG file</span></span><br><span class="line">        <span class="built_in">string</span> PathName = <span class="string">&quot;C:\\AutoCAD\\Sample\\Sheet Sets\\Architectural\\Res\\Exterior Elevations.dwg&quot;</span>;</span><br><span class="line">        ObjectId acXrefId = acCurDb.AttachXref(PathName, <span class="string">&quot;Exterior Elevations&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If a valid reference is created then continue</span></span><br><span class="line">        <span class="keyword">if</span> (!acXrefId.IsNull)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Attach the DWG reference to the current space</span></span><br><span class="line">            Point3d insPt = <span class="keyword">new</span> Point3d(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">using</span> (BlockReference acBlkRef = <span class="keyword">new</span> BlockReference(insPt, acXrefId))</span><br><span class="line">            &#123;</span><br><span class="line">                BlockTableRecord acBlkTblRec;</span><br><span class="line">                acBlkTblRec = acTrans.GetObject(acCurDb.CurrentSpaceId, OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">                acBlkTblRec.AppendEntity(acBlkRef);</span><br><span class="line">                acTrans.AddNewlyCreatedDBObject(acBlkRef, <span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Application.ShowAlertDialog(<span class="string">&quot;The external reference is attached.&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">using</span> (ObjectIdCollection acXrefIdCol = <span class="keyword">new</span> ObjectIdCollection())</span><br><span class="line">            &#123;</span><br><span class="line">                acXrefIdCol.Add(acXrefId);</span><br><span class="line"></span><br><span class="line">                acCurDb.BindXrefs(acXrefIdCol, <span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Application.ShowAlertDialog(<span class="string">&quot;The external reference is bound.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new objects to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dispose of the transaction</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="剪裁块和外部参照（-NET）"><a href="#剪裁块和外部参照（-NET）" class="headerlink" title="剪裁块和外部参照（.NET）"></a>剪裁块和外部参照（.NET）</h3><p>通过剪裁外部参照，可以定义外部参照的区域以进行显示和打印。剪裁边界必须是二维多边形或矩形，其顶点被约束为位于外部参照的边界内。同一外部参照的多个实例可以具有不同的边界。</p>
<p>SpatialFilter和SpatialFilterDefinition对象用于定义外部参照的剪裁边界的属性。使用SpatialFilterDefinition对象的Enabled属性显示或隐藏剪裁边界。</p>
<p><strong>剪裁外部参照定义</strong><br>此示例附着外部参照，然后剪裁外部参照，使其仅显示一部分。本示例使用Sample目录中的Exterior Elevations.dwg文件。如果您没有此图像，或者它位于其他目录中，请插入有效的路径和文件名。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;ClippingExternalReference&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ClippingExternalReference</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database and start a transaction</span></span><br><span class="line">    Database acCurDb;</span><br><span class="line">    acCurDb = Application.DocumentManager.MdiActiveDocument.Database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Create a reference to a DWG file</span></span><br><span class="line">        <span class="built_in">string</span> PathName = <span class="string">&quot;C:\\AutoCAD\\Sample\\Sheet Sets\\Architectural\\Res\\Exterior Elevations.dwg&quot;</span>;</span><br><span class="line">        ObjectId acXrefId = acCurDb.AttachXref(PathName, <span class="string">&quot;Exterior Elevations&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If a valid reference is created then continue</span></span><br><span class="line">        <span class="keyword">if</span> (!acXrefId.IsNull)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Attach the DWG reference to the current space</span></span><br><span class="line">            Point3d insPt = <span class="keyword">new</span> Point3d(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">using</span> (BlockReference acBlkRef = <span class="keyword">new</span> BlockReference(insPt, acXrefId))</span><br><span class="line">            &#123;</span><br><span class="line">                BlockTableRecord acBlkTblRec;</span><br><span class="line">                acBlkTblRec = acTrans.GetObject(acCurDb.CurrentSpaceId, OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">                acBlkTblRec.AppendEntity(acBlkRef);</span><br><span class="line">                acTrans.AddNewlyCreatedDBObject(acBlkRef, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">                Application.ShowAlertDialog(<span class="string">&quot;The external reference is attached.&quot;</span>);</span><br><span class="line"></span><br><span class="line">                Matrix3d mat = acBlkRef.BlockTransform;</span><br><span class="line">                mat.Inverse();</span><br><span class="line"></span><br><span class="line">                Point2dCollection ptCol = <span class="keyword">new</span> Point2dCollection();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Define the first corner of the clipping boundary</span></span><br><span class="line">                Point3d pt3d = <span class="keyword">new</span> Point3d(<span class="number">-330</span>, <span class="number">400</span>, <span class="number">0</span>);</span><br><span class="line">                pt3d.TransformBy(mat);</span><br><span class="line">                ptCol.Add(<span class="keyword">new</span> Point2d(pt3d.X, pt3d.Y));</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Define the second corner of the clipping boundary</span></span><br><span class="line">                pt3d = <span class="keyword">new</span> Point3d(<span class="number">1320</span>, <span class="number">1120</span>, <span class="number">0</span>);</span><br><span class="line">                pt3d.TransformBy(mat);</span><br><span class="line">                ptCol.Add(<span class="keyword">new</span> Point2d(pt3d.X, pt3d.Y));</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Define the normal and elevation for the clipping boundary </span></span><br><span class="line">                Vector3d normal;</span><br><span class="line">                <span class="built_in">double</span> elev = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (acCurDb.TileMode == <span class="literal">true</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    normal = acCurDb.Ucsxdir.CrossProduct(acCurDb.Ucsydir);</span><br><span class="line">                    elev = acCurDb.Elevation;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    normal = acCurDb.Pucsxdir.CrossProduct(acCurDb.Pucsydir);</span><br><span class="line">                    elev = acCurDb.Pelevation;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Set the clipping boundary and enable it</span></span><br><span class="line">                <span class="keyword">using</span> (Autodesk.AutoCAD.DatabaseServices.Filters.SpatialFilter filter = </span><br><span class="line">                    <span class="keyword">new</span> Autodesk.AutoCAD.DatabaseServices.Filters.SpatialFilter())</span><br><span class="line">                &#123;</span><br><span class="line">                    Autodesk.AutoCAD.DatabaseServices.Filters.SpatialFilterDefinition filterDef = </span><br><span class="line">                        <span class="keyword">new</span> Autodesk.AutoCAD.DatabaseServices.Filters.SpatialFilterDefinition(ptCol, normal, elev, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">true</span>);</span><br><span class="line">                    filter.Definition = filterDef;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Define the name of the extension dictionary and entry name</span></span><br><span class="line">                    <span class="built_in">string</span> dictName = <span class="string">&quot;ACAD_FILTER&quot;</span>;</span><br><span class="line">                    <span class="built_in">string</span> spName = <span class="string">&quot;SPATIAL&quot;</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Check to see if the Extension Dictionary exists, if not create it</span></span><br><span class="line">                    <span class="keyword">if</span> (acBlkRef.ExtensionDictionary.IsNull)</span><br><span class="line">                    &#123;</span><br><span class="line">                        acBlkRef.CreateExtensionDictionary();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Open the Extension Dictionary for write</span></span><br><span class="line">                    DBDictionary extDict = acTrans.GetObject(acBlkRef.ExtensionDictionary, OpenMode.ForWrite) <span class="keyword">as</span> DBDictionary;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Check to see if the dictionary for clipped boundaries exists, </span></span><br><span class="line">                    <span class="comment">// and add the spatial filter to the dictionary</span></span><br><span class="line">                    <span class="keyword">if</span> (extDict.Contains(dictName))</span><br><span class="line">                    &#123;</span><br><span class="line">                        DBDictionary filterDict = acTrans.GetObject(extDict.GetAt(dictName), OpenMode.ForWrite) <span class="keyword">as</span> DBDictionary;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (filterDict.Contains(spName))</span><br><span class="line">                        &#123;</span><br><span class="line">                            filterDict.Remove(spName);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        filterDict.SetAt(spName, filter);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">using</span> (DBDictionary filterDict = <span class="keyword">new</span> DBDictionary())</span><br><span class="line">                        &#123;</span><br><span class="line">                            extDict.SetAt(dictName, filterDict);</span><br><span class="line"></span><br><span class="line">                            acTrans.AddNewlyCreatedDBObject(filterDict, <span class="literal">true</span>);</span><br><span class="line">                            filterDict.SetAt(spName, filter);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Append the spatial filter to the drawing</span></span><br><span class="line">                    acTrans.AddNewlyCreatedDBObject(filter, <span class="literal">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Application.ShowAlertDialog(<span class="string">&quot;The external reference is clipped.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new objects to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dispose of the transaction</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="加载和外部参照性能（-NET）"><a href="#加载和外部参照性能（-NET）" class="headerlink" title="加载和外部参照性能（.NET）"></a>加载和外部参照性能（.NET）</h3><p>通过将按需加载和保存带有索引的图形相结合，可以提高带有外部参照的图形的性能。按需加载与XLOADCTL和INDEXCTL系统变量一起使用。打开按需加载时，如果索引已保存在参照图形中，AutoCAD将仅将参照图形中重生成当前图形所需的数据加载到内存中。换句话说，引用的材料是“按需”阅读的。</p>
<p>要打开按需加载，请使用 SetSystemVariable 方法设置XLOADCTL系统变量。以下设置适用于XLOADCTL系统变量：</p>
<ul>
<li>0 &#x3D;关闭按需加载。将加载整个图形</li>
<li>1 &#x3D;打开按需加载。参照图形保持打开和锁定状态</li>
<li>2 &#x3D;打开按需加载。参照图形的副本将打开并锁定;参照图形不会锁定</li>
</ul>
<p>默认情况下，XLOADCTL设置为2，并与AutoCAD用户配置一起存储。</p>
<p>要实现按需加载的最大好处，需要使用图层和空间索引保存参照图形。当剪裁外部参照以显示其一小部分，并且空间索引保存在外部参照图形中时，按需加载的性能优势最为明显。</p>
<p>冻结外部参照的多个图层，外部参照图形将与图层索引一起保存。</p>
<p>要启用图层和空间索引，请使用 SetSystemVariable 方法设置INDEXCTL系统变量。以下设置适用于INDEXCTL系统变量：</p>
<ul>
<li>0 &#x3D;未创建索引</li>
<li>1 &#x3D;已创建图层索引</li>
<li>2 &#x3D;已创建空间索引</li>
<li>3 &#x3D;同时创建空间索引和图层索引</li>
</ul>
<p>默认情况下，创建新AutoCAD图形时，INDEXCTL设置为0。</p>
<p>有关按需加载和外部参照的详细信息，请参见产品帮助系统中的“关于在使用外部参照时提高性能”。</p>
<h2 id="分配和删除扩展数据（-NET）"><a href="#分配和删除扩展数据（-NET）" class="headerlink" title="分配和删除扩展数据（.NET）"></a>分配和删除扩展数据（.NET）</h2><p>可以使用扩展数据作为将信息与图形中的对象链接的方法。</p>
<p><strong>将扩展数据指定给选择集中的所有对象</strong></p>
<p>此示例提示用户从图形中选择对象。选定的对象将放置到选择集中，指定的扩展数据将附着到该选择集中的所有对象。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;AttachXDataToSelectionSetObjects&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AttachXDataToSelectionSetObjects</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database and start a transaction</span></span><br><span class="line">    Database acCurDb;</span><br><span class="line">    acCurDb = Application.DocumentManager.MdiActiveDocument.Database;</span><br><span class="line"></span><br><span class="line">    Document acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span> appName = <span class="string">&quot;MY_APP&quot;</span>;</span><br><span class="line">    <span class="built_in">string</span> xdataStr = <span class="string">&quot;This is some xdata&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Request objects to be selected in the drawing area</span></span><br><span class="line">        PromptSelectionResult acSSPrompt = acDoc.Editor.GetSelection();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If the prompt status is OK, objects were selected</span></span><br><span class="line">        <span class="keyword">if</span> (acSSPrompt.Status == PromptStatus.OK)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Open the Registered Applications table for read</span></span><br><span class="line">            RegAppTable acRegAppTbl;</span><br><span class="line">            acRegAppTbl = acTrans.GetObject(acCurDb.RegAppTableId, OpenMode.ForRead) <span class="keyword">as</span> RegAppTable;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Check to see if the Registered Applications table record for the custom app exists</span></span><br><span class="line">            <span class="keyword">if</span> (acRegAppTbl.Has(appName) == <span class="literal">false</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">using</span> (RegAppTableRecord acRegAppTblRec = <span class="keyword">new</span> RegAppTableRecord())</span><br><span class="line">                &#123;</span><br><span class="line">                    acRegAppTblRec.Name = appName;</span><br><span class="line"></span><br><span class="line">                    acTrans.GetObject(acCurDb.RegAppTableId, OpenMode.ForWrite);</span><br><span class="line">                    acRegAppTbl.Add(acRegAppTblRec);</span><br><span class="line">                    acTrans.AddNewlyCreatedDBObject(acRegAppTblRec, <span class="literal">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Define the Xdata to add to each selected object</span></span><br><span class="line">            <span class="keyword">using</span> (ResultBuffer rb = <span class="keyword">new</span> ResultBuffer())</span><br><span class="line">            &#123;</span><br><span class="line">                rb.Add(<span class="keyword">new</span> TypedValue((<span class="built_in">int</span>)DxfCode.ExtendedDataRegAppName, appName));</span><br><span class="line">                rb.Add(<span class="keyword">new</span> TypedValue((<span class="built_in">int</span>)DxfCode.ExtendedDataAsciiString, xdataStr));</span><br><span class="line"></span><br><span class="line">                SelectionSet acSSet = acSSPrompt.Value;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Step through the objects in the selection set</span></span><br><span class="line">                <span class="keyword">foreach</span> (SelectedObject acSSObj <span class="keyword">in</span> acSSet)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// Open the selected object for write</span></span><br><span class="line">                    Entity acEnt = acTrans.GetObject(acSSObj.ObjectId,</span><br><span class="line">                                                        OpenMode.ForWrite) <span class="keyword">as</span> Entity;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Append the extended data to each object</span></span><br><span class="line">                    acEnt.XData = rb;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new object to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dispose of the transaction</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>查看选择集中所有对象的扩展数据</strong><br>此示例显示与上一示例附着的扩展数据。如果附加的扩展数据不是字符串（类型1000），则需要修改此代码。</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CAD/">CAD</a></div><div class="post-share"><div class="social-share" data-image="/images/4stars.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/02/16/RevitApi%E5%90%88%E9%9B%86/Autodesk.Revit.ApplicationServices%20Application/" title="Autodesk.Revit.ApplicationServices Application"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Autodesk.Revit.ApplicationServices Application</div></div><div class="info-2"><div class="info-item-1">Autodesk.Revit.ApplicationServices Application代表Autodesk Revit应用程序，提供对文档、选项和其他应用程序范围数据和设置的访问。 语法1public class Application : IDisposable    示例123string versionInfo = application.VersionBuild + &quot;\n&quot;					+ application.VersionName + &quot;\n&quot;					+ application.VersionNumber;  继承层次结构System Object Autodesk.Revit.ApplicationServices Application Autodesk.Revit.DB.Macros ApplicationEntryPoint 方法CopyModel将现有模型复制到新文件。允许覆盖同名文件。 ExtractPartAtomFromFamilyFile从族文件的内容写入PartAtom...</div></div></div></a><a class="pagination-related" href="/2025/02/08/ObjectARX%EF%BC%9AManaged.NET%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E6%8C%87%E5%8D%97/05%E5%9C%A8%E4%B8%89%E7%BB%B4%E7%A9%BA%E9%97%B4%E4%B8%AD%E5%B7%A5%E4%BD%9C%EF%BC%88.NET%EF%BC%89/" title="05在三维空间中工作（.NET）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">05在三维空间中工作（.NET）</div></div><div class="info-2"><div class="info-item-1">在三维空间中工作（.NET）大多数图形由三维（3D）对象的二维（2D）视图组成。虽然这种绘图方法在建筑和工程界广泛使用，但它是有限的：图纸是3D对象的2D表示，必须进行视觉解释。此外，由于视图是独立创建的，因此出现错误和歧义的可能性更大。因此，您可能希望创建真正的3D模型，而不是2D表示。您可以使用AutoCAD绘图工具创建详细、逼真的三维对象，并以各种方式对其进行操作。 本节中的主题  指定三维坐标（.NET） 定义用户坐标系（.NET） 转换坐标（.NET） 创建3D对象（.NET） 在3D中编辑（.NET） 编辑三维实体（.NET）  指定三维坐标（.NET）输入三维世界坐标系（WCS）坐标与输入二维WCS坐标类似。除了指定X和Y值外，还可以指定Z值。2D坐标由 Point2d 对象表示，而您使用 Point3d 对象表示3D坐标。AutoCAD .NET...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/01/08/CAD%E4%BA%8C%E5%BC%80/AddInManager/" title="AddInManager"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-08</div><div class="info-item-2">AddInManager</div></div><div class="info-2"><div class="info-item-1">AddInManager每次调试cad插件，老是会有占用的问题。网上找到方法就是通过反射解决，但是只找到那个要自己手动配置的，嫌麻烦。GitHub上有个CADAddInManager，用了一下，好像没什么反应，不知道是不是使用方式不对，文档也不详细。索性自己整一个。 参照Revit SDK 里的那个AddinManager及网上给出的方法。通过反射。把dll复制到临时文件夹，然后委托调用。现在只做了CommandMethod部分的。VS2022+CAD2024。  使用方式： 1、直接安装，不要改安装路径。 2、通过附加模块下插件管理中ribbon进入或用命令”AddInManager” GitHub链接：https://github.com/FunTim41/CADAddInLoder </div></div></div></a><a class="pagination-related" href="/2025/01/12/ObjectARX%EF%BC%9AManaged.NET%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E6%8C%87%E5%8D%97/01AutoCAD.NET%20API%EF%BC%88.NET%EF%BC%89%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="01AutoCAD .NET API（.NET）的基础知识"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-12</div><div class="info-item-2">01AutoCAD .NET API（.NET）的基础知识</div></div><div class="info-2"><div class="info-item-1">AutoCAD .NET API（.NET）的基础知识要有效地使用AutoCAD®.NET API，您应该熟悉与要自动执行的任务相关的AutoCAD图元、对象和功能。对对象的图形和非图形特性了解得越多，就越容易通过AutoCAD .NET API对其进行操作。 本节中的主题  了解AutoCAD对象层次（.NET） 访问对象层次结构（.NET） 集合对象（.NET） 了解属性和方法（.NET） 进程外与进程内（.NET） 定义命令和AutoLISP函数（.NET）  了解AutoCAD对象层次（.NET）对象是AutoCAD .NET API的主要构造块。每个暴露的对象都代表AutoCAD的一个精确部分。AutoCAD .NET API中有许多不同类型的对象。AutoCAD .NET API中表示的某些对象包括：  图形对象，如直线、圆弧、文本和尺寸 样式设置，如图层、线型和标注样式 组织结构，如层、组和块 图形显示，如视图和视口 甚至绘图和AutoCAD应用程序  这些对象以分层方式进行结构化，AutoCAD应用程序对象位于根。这种层次结构通常被称为对象模型。下图显示了...</div></div></div></a><a class="pagination-related" href="/2025/01/13/ObjectARX%EF%BC%9AManaged.NET%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E6%8C%87%E5%8D%97/02%E6%8E%A7%E5%88%B6AutoCAD%E7%8E%AF%E5%A2%83%EF%BC%88.NET%EF%BC%89/" title="02控制AutoCAD环境（.NET）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-13</div><div class="info-item-2">02控制AutoCAD环境（.NET）</div></div><div class="info-2"><div class="info-item-1">控制AutoCAD环境（.NET）本章介绍开发与AutoCAD一起运行的进程内应用程序的基础知识。它解释了许多概念，以控制和有效地使用AutoCAD环境。 本节中的主题  控制应用程序窗口（.NET） 控制绘图窗口（.NET） 创建、打开、保存和关闭图形（.NET） 锁定和删除文档（.NET） AutoCAD的首选项（.NET） 设置和返回系统变量（.NET） 精确绘图（.NET） 提示用户输入（.NET） 访问命令行（.NET） 扩展AutoCAD用户界面（.NET） 自定义对话框可用于获取用户输入并扩展AutoCAD用户界面的功能。  控制应用程序窗口（.NET）控制应用程序窗口的能力使开发人员能够灵活地创建有效和智能的应用程序。有时，您的应用程序最小化AutoCAD窗口是合适的，可能是在您的代码在另一个应用程序（如Microsoft® Excel®）中执行工作时。此外，在执行提示用户输入等任务之前，通常需要验证AutoCAD窗口的状态。 使用Application对象上的方法和属性，可以更改Application窗口的位置、大小和可见性。您还可以使用...</div></div></div></a><a class="pagination-related" href="/2025/02/08/ObjectARX%EF%BC%9AManaged.NET%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E6%8C%87%E5%8D%97/05%E5%9C%A8%E4%B8%89%E7%BB%B4%E7%A9%BA%E9%97%B4%E4%B8%AD%E5%B7%A5%E4%BD%9C%EF%BC%88.NET%EF%BC%89/" title="05在三维空间中工作（.NET）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-08</div><div class="info-item-2">05在三维空间中工作（.NET）</div></div><div class="info-2"><div class="info-item-1">在三维空间中工作（.NET）大多数图形由三维（3D）对象的二维（2D）视图组成。虽然这种绘图方法在建筑和工程界广泛使用，但它是有限的：图纸是3D对象的2D表示，必须进行视觉解释。此外，由于视图是独立创建的，因此出现错误和歧义的可能性更大。因此，您可能希望创建真正的3D模型，而不是2D表示。您可以使用AutoCAD绘图工具创建详细、逼真的三维对象，并以各种方式对其进行操作。 本节中的主题  指定三维坐标（.NET） 定义用户坐标系（.NET） 转换坐标（.NET） 创建3D对象（.NET） 在3D中编辑（.NET） 编辑三维实体（.NET）  指定三维坐标（.NET）输入三维世界坐标系（WCS）坐标与输入二维WCS坐标类似。除了指定X和Y值外，还可以指定Z值。2D坐标由 Point2d 对象表示，而您使用 Point3d 对象表示3D坐标。AutoCAD .NET...</div></div></div></a><a class="pagination-related" href="/2025/02/07/ObjectARX%EF%BC%9AManaged.NET%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E6%8C%87%E5%8D%97/04%E5%B0%BA%E5%AF%B8%E6%A0%87%E6%B3%A8%E5%92%8C%E5%85%AC%E5%B7%AE%EF%BC%88.NET%EF%BC%89/" title="04 尺寸标注和公差（.NET）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-07</div><div class="info-item-2">04 尺寸标注和公差（.NET）</div></div><div class="info-2"><div class="info-item-1">尺寸标注和公差（.NET）标注将测量值添加到图形中。公差指定尺寸可以变化的程度。使用AutoCAD .NET...</div></div></div></a><a class="pagination-related" href="/2025/01/14/ObjectARX%EF%BC%9AManaged.NET%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E6%8C%87%E5%8D%97/03%E5%88%9B%E5%BB%BA%E5%92%8C%E7%BC%96%E8%BE%91AutoCAD%E5%9B%BE%E5%85%83%EF%BC%88.NET%EF%BC%89/" title="03创建和编辑AutoCAD图元（.NET）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-14</div><div class="info-item-2">03创建和编辑AutoCAD图元（.NET）</div></div><div class="info-2"><div class="info-item-1">创建和编辑AutoCAD图元（.NET）可以创建一系列对象，从简单的直线和圆到样条曲线、椭圆和关联填充区域。一般来说，您可以使用 AppendEntity 函数将对象添加到 BlockTableRecord 对象。创建对象后，可以更改其特性，例如图层、颜色和线型。 图形数据库与其他数据库程序类似，可以将模型空间中的Line对象视为表记录，将模型空间视为其数据库表。使用数据库时，必须先打开和关闭记录，然后才能使用它们。存储在 Database 对象中的对象没有什么不同，您可以使用 GetObject...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/4stars.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">funtim41@gmail.com</div><div class="author-info-description">实践-认识-再实践-再认识</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">67</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/FunTim41"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/FunTim41" target="_blank" title="Github"><i class="fab fa-github" style="color: #FFFFFF;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E7%BB%98%E5%9B%BE%E5%92%8C%E7%BB%84%E7%BB%87%E6%8A%80%E6%9C%AF%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">高级绘图和组织技术（.NET）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%85%89%E6%A0%85%E5%9B%BE%E5%83%8F%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.</span> <span class="toc-text">使用光栅图像（.NET）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%84%E5%8A%A0%E5%92%8C%E7%BC%A9%E6%94%BE%E5%85%89%E6%A0%85%E5%9B%BE%E5%83%8F%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.1.</span> <span class="toc-text">附加和缩放光栅图像（.NET）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E5%85%89%E6%A0%85%E5%9B%BE%E5%83%8F%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.2.</span> <span class="toc-text">管理光栅图像（.NET）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E6%9B%B4%E5%9B%BE%E5%83%8F%E8%B7%AF%E5%BE%84%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">变更图像路径（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E5%9B%BE%E5%83%8F%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">命名图像（.NET）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%9B%BE%E5%83%8F%E5%92%8C%E5%9B%BE%E5%83%8F%E8%BE%B9%E7%95%8C%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.3.</span> <span class="toc-text">修改图像和图像边界（.NET）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E5%92%8C%E9%9A%90%E8%97%8F%E5%9B%BE%E5%83%8F%E8%BE%B9%E7%95%8C%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">显示和隐藏图像边界（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E5%9B%BE%E5%83%8F%E5%92%8C%E8%BE%B9%E7%95%8C%E5%B1%9E%E6%80%A7%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">更改图像和边界属性（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E5%9B%BE%E5%83%8F%E7%BC%A9%E6%94%BE%E3%80%81%E6%97%8B%E8%BD%AC%E3%80%81%E4%BD%8D%E7%BD%AE%E3%80%81%E5%AE%BD%E5%BA%A6%E5%92%8C%E9%AB%98%E5%BA%A6%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">更改图像缩放、旋转、位置、宽度和高度（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E5%9B%BE%E5%83%8F%E5%8F%AF%E8%A7%81%E6%80%A7%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.3.4.</span> <span class="toc-text">更改图像可见性（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%BB%91%E7%99%BD%E5%9B%BE%E5%83%8F%E9%A2%9C%E8%89%B2%E5%92%8C%E9%80%8F%E6%98%8E%E5%BA%A6%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.3.5.</span> <span class="toc-text">修改黑白图像颜色和透明度（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E6%95%B4%E5%9B%BE%E5%83%8F%E4%BA%AE%E5%BA%A6%E3%80%81%E5%AF%B9%E6%AF%94%E5%BA%A6%E5%92%8C%E6%B7%A1%E5%85%A5%E6%B7%A1%E5%87%BA%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.3.6.</span> <span class="toc-text">调整图像亮度、对比度和淡入淡出（.NET）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E5%9B%BE%E5%83%8F%E7%9A%84%E5%89%AA%E5%88%87%E8%BE%B9%E7%95%8C%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.4.</span> <span class="toc-text">更改图像的剪切边界（.NET）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9D%97%E5%92%8C%E7%89%B9%E6%80%A7%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.</span> <span class="toc-text">使用块和特性（.NET）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9D%97%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.1.</span> <span class="toc-text">使用块（.NET）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%9D%97%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">定义块（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E5%9D%97%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">插入块（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E8%A7%A3%E5%9D%97%E5%8F%82%E7%85%A7%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">分解块参照（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%96%B0%E5%AE%9A%E4%B9%89%E5%9D%97%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">重新定义块（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E5%9D%97%E5%AE%9A%E4%B9%89%E4%B8%AD%E9%87%8D%E5%AE%9A%E4%B9%89%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.2.1.5.</span> <span class="toc-text">在块定义中重定义对象</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%89%B9%E6%80%A7%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.2.</span> <span class="toc-text">使用特性（.NET）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%89%B9%E6%80%A7%E5%AE%9A%E4%B9%89%E5%92%8C%E7%89%B9%E6%80%A7%E5%BC%95%E7%94%A8%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">创建特性定义和特性引用（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E7%89%B9%E6%80%A7%E5%AE%9A%E4%B9%89%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">编辑特性定义（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%90%E5%8F%96%E7%89%B9%E6%80%A7%E4%BF%A1%E6%81%AF%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">提取特性信息（.NET）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%A4%96%E9%83%A8%E5%BC%95%E7%94%A8%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.3.</span> <span class="toc-text">使用外部引用（.NET）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%A4%96%E9%83%A8%E5%8F%82%E7%85%A7%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.3.1.</span> <span class="toc-text">更新外部参照（.NET）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%84%E7%9D%80%E5%A4%96%E9%83%A8%E5%8F%82%E7%85%A7%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.3.2.</span> <span class="toc-text">附着外部参照（.NET）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%A6%BB%E5%A4%96%E9%83%A8%E5%8F%82%E7%85%A7%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.3.3.</span> <span class="toc-text">分离外部参照（.NET）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BD%E5%A4%96%E9%83%A8%E5%8F%82%E7%85%A7%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.3.4.</span> <span class="toc-text">重新加载外部参照（.NET）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD%E5%A4%96%E9%83%A8%E5%8F%82%E7%85%A7%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.3.5.</span> <span class="toc-text">卸载外部参照（.NET）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E5%A4%96%E9%83%A8%E5%8F%82%E7%85%A7%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.3.6.</span> <span class="toc-text">绑定外部参照（.NET）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%AA%E8%A3%81%E5%9D%97%E5%92%8C%E5%A4%96%E9%83%A8%E5%8F%82%E7%85%A7%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.3.7.</span> <span class="toc-text">剪裁块和外部参照（.NET）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E5%92%8C%E5%A4%96%E9%83%A8%E5%8F%82%E7%85%A7%E6%80%A7%E8%83%BD%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.3.8.</span> <span class="toc-text">加载和外部参照性能（.NET）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E9%85%8D%E5%92%8C%E5%88%A0%E9%99%A4%E6%89%A9%E5%B1%95%E6%95%B0%E6%8D%AE%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">分配和删除扩展数据（.NET）</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/08/CAD%E4%BA%8C%E5%BC%80/AddInManager/" title="AddInManager">AddInManager</a><time datetime="2025-03-30T03:24:33.124Z" title="更新于 2025-03-30 11:24:33">2025-03-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/29/Revit%E4%BA%8C%E5%BC%80%E7%A4%BA%E4%BE%8B/%E5%9C%A8Revit%E4%B8%AD%E6%B1%82%E5%86%85%E8%BD%AE%E5%BB%93%E5%8F%8A%E5%A4%96%E8%BD%AE%E5%BB%93/" title="在Revit中求内轮廓及外轮廓">在Revit中求内轮廓及外轮廓</a><time datetime="2025-03-29T06:04:26.007Z" title="更新于 2025-03-29 14:04:26">2025-03-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/27/RevitApi%E5%90%88%E9%9B%86/Autodesk.Revit.DB%20XYZ%20/" title="Autodesk.Revit.DB XYZ">Autodesk.Revit.DB XYZ</a><time datetime="2025-02-27T12:48:50.709Z" title="更新于 2025-02-27 20:48:50">2025-02-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/20/RevitApi%E5%90%88%E9%9B%86/Autodesk.Revit.DB%20Curve/" title="Autodesk.Revit.DB Curve">Autodesk.Revit.DB Curve</a><time datetime="2025-02-27T12:28:18.794Z" title="更新于 2025-02-27 20:28:18">2025-02-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/20/RevitApi%E5%90%88%E9%9B%86/Autodesk.Revit.DB%20Line/" title="Autodesk.Revit.DB Line">Autodesk.Revit.DB Line</a><time datetime="2025-02-27T12:28:08.332Z" title="更新于 2025-02-27 20:28:08">2025-02-27</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/images/topback.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By funtim41@gmail.com</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">学而不思则罔，思而不学则殆。</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>(() => {
  const panguFn = () => {
    if (typeof pangu === 'object') pangu.autoSpacingPage()
    else {
      btf.getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
        .then(() => {
          pangu.autoSpacingPage()
        })
    }
  }

  const panguInit = () => {
    if (false){
      GLOBAL_CONFIG_SITE.isPost && panguFn()
    } else {
      panguFn()
    }
  }

  btf.addGlobalFn('pjaxComplete', panguInit, 'pangu')
  document.addEventListener('DOMContentLoaded', panguInit)
})()</script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'FunTim41/funtim41.github.io',
      'data-repo-id': 'R_kgDONjG8ww',
      'data-category-id': 'DIC_kwDONjG8w84Cllg2',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>