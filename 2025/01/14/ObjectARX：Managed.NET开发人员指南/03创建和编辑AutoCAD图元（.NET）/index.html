<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>03创建和编辑AutoCAD图元（.NET） | funtim的博客</title><meta name="author" content="funtim41@gmail.com"><meta name="copyright" content="funtim41@gmail.com"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="创建和编辑AutoCAD图元（.NET）可以创建一系列对象，从简单的直线和圆到样条曲线、椭圆和关联填充区域。一般来说，您可以使用 AppendEntity 函数将对象添加到 BlockTableRecord 对象。创建对象后，可以更改其特性，例如图层、颜色和线型。 图形数据库与其他数据库程序类似，可以将模型空间中的Line对象视为表记录，将模型空间视为其数据库表。使用数据库时，必须先打开和关闭记录">
<meta property="og:type" content="article">
<meta property="og:title" content="03创建和编辑AutoCAD图元（.NET）">
<meta property="og:url" content="https://funtim41.github.io/2025/01/14/ObjectARX%EF%BC%9AManaged.NET%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E6%8C%87%E5%8D%97/03%E5%88%9B%E5%BB%BA%E5%92%8C%E7%BC%96%E8%BE%91AutoCAD%E5%9B%BE%E5%85%83%EF%BC%88.NET%EF%BC%89/">
<meta property="og:site_name" content="funtim的博客">
<meta property="og:description" content="创建和编辑AutoCAD图元（.NET）可以创建一系列对象，从简单的直线和圆到样条曲线、椭圆和关联填充区域。一般来说，您可以使用 AppendEntity 函数将对象添加到 BlockTableRecord 对象。创建对象后，可以更改其特性，例如图层、颜色和线型。 图形数据库与其他数据库程序类似，可以将模型空间中的Line对象视为表记录，将模型空间视为其数据库表。使用数据库时，必须先打开和关闭记录">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://funtim41.github.io/images/4stars.png">
<meta property="article:published_time" content="2025-01-14T04:27:29.000Z">
<meta property="article:modified_time" content="2025-01-14T04:28:05.785Z">
<meta property="article:author" content="funtim41@gmail.com">
<meta property="article:tag" content="CAD">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://funtim41.github.io/images/4stars.png"><link rel="shortcut icon" href="/images/OIP.jfif"><link rel="canonical" href="https://funtim41.github.io/2025/01/14/ObjectARX%EF%BC%9AManaged.NET%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E6%8C%87%E5%8D%97/03%E5%88%9B%E5%BB%BA%E5%92%8C%E7%BC%96%E8%BE%91AutoCAD%E5%9B%BE%E5%85%83%EF%BC%88.NET%EF%BC%89/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: funtim41@gmail.com","link":"链接: ","source":"来源: funtim的博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '03创建和编辑AutoCAD图元（.NET）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><link rel="stylesheet" href="/css/bar.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background: Color(#995a82);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/images/4stars.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">58</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Timeline</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/Links/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/images/topback.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/images/OIP.jfif" alt="Logo"><span class="site-name">funtim的博客</span></a><a class="nav-page-title" href="/"><span class="site-name">03创建和编辑AutoCAD图元（.NET）</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Timeline</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/Links/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">03创建和编辑AutoCAD图元（.NET）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-01-14T04:27:29.000Z" title="发表于 2025-01-14 12:27:29">2025-01-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-01-14T04:28:05.785Z" title="更新于 2025-01-14 12:28:05">2025-01-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ObjectARX%EF%BC%9AManaged-NET%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E6%8C%87%E5%8D%97/">ObjectARX：Managed.NET开发人员指南</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="创建和编辑AutoCAD图元（-NET）"><a href="#创建和编辑AutoCAD图元（-NET）" class="headerlink" title="创建和编辑AutoCAD图元（.NET）"></a>创建和编辑AutoCAD图元（.NET）</h1><p>可以创建一系列对象，从简单的直线和圆到样条曲线、椭圆和关联填充区域。一般来说，您可以使用 AppendEntity 函数将对象添加到 BlockTableRecord 对象。创建对象后，可以更改其特性，例如图层、颜色和线型。</p>
<p>图形数据库与其他数据库程序类似，可以将模型空间中的Line对象视为表记录，将模型空间视为其数据库表。使用数据库时，必须先打开和关闭记录，然后才能使用它们。存储在 Database 对象中的对象没有什么不同，您可以使用 GetObject 函数从数据库中检索对象并定义如何使用该对象。</p>
<p>本节中的主题</p>
<ul>
<li><p>打开和关闭对象（.NET）</p>
</li>
<li><p>创建对象（.NET）</p>
</li>
<li><p>使用选择集（.NET）</p>
<p>选择集可以由单个对象组成，也可以是更复杂的分组：例如，某个图层上的对象集。</p>
</li>
<li><p>编辑命名对象和2D对象（.NET）</p>
</li>
<li><p>使用图层、颜色和线型（.NET）</p>
</li>
<li><p>保存和恢复图层状态（.NET）</p>
</li>
<li><p>将文本添加到图形（.NET）</p>
</li>
</ul>
<h2 id="打开和关闭对象（-NET）"><a href="#打开和关闭对象（-NET）" class="headerlink" title="打开和关闭对象（.NET）"></a>打开和关闭对象（.NET）</h2><p>无论您是在处理对象（如直线、圆和线）还是符号表及其记录，都需要打开对象进行读取或写入。当查询一个对象时，你想打开这个对象进行读取，但是如果你要对这个对象进行修改，你想打开它进行写入。</p>
<p>本节中的主题</p>
<ul>
<li><p>使用ObjectIds（.NET）</p>
</li>
<li><p>将事务与事务管理器（.NET）一起使用</p>
</li>
<li><p>不使用事务管理器打开和关闭对象（.NET）</p>
</li>
<li><p>升级和降级Open Objects（.NET）</p>
<p>通过升级或降级对象，可以将对象的当前打开模式从读更改为写或从写更改为读。</p>
</li>
<li><p>关于使用动态语言（.NET）</p>
<p>AutoCAD托管.NET API允许您利用.NET 4.0中引入的动态语言编译器（DLR）。</p>
</li>
</ul>
<h3 id="使用ObjectIds（-NET）"><a href="#使用ObjectIds（-NET）" class="headerlink" title="使用ObjectIds（.NET）"></a>使用ObjectIds（.NET）</h3><p>数据库中包含的每个对象都被分配了几个唯一的id。访问对象的独特方式包括：</p>
<ul>
<li>Entity handle  </li>
<li>ObjectId</li>
<li>Instance pointer</li>
</ul>
<p>访问对象的最常见方式是通过其ObjectId。如果您的项目同时使用COM互操作和托管AutoCAD .NET API，则ObjectId非常有效。如果创建自定义AutoLISP函数，则可能需要使用实体句柄。</p>
<p>句柄在AutoCAD会话之间是永久性的，因此，如果需要将图形信息导出到外部文件（稍后可能需要使用该文件来更新图形），则句柄是访问对象的最佳方式。数据库中对象的ObjectId仅在数据库加载到内存中时才存在。一旦数据库关闭，分配给对象的ObjectId就不再存在，并且在下次打开数据库时可能会有所不同。</p>
<p><strong>获取ObjectId</strong></p>
<p>使用对象时，在打开对象进行查询或编辑之前，需要先获取ObjectId。当打开图形文件时，ObjectId将被分配给数据库中的现有对象，而新对象在首次创建时将被分配ObjectId。通常通过以下方式获取数据库中现有对象的ObjectId：</p>
<ul>
<li>使用 Database 对象的成员属性，例如 Clayer ，它检索当前图层的对象ID</li>
<li>迭代符号表，如图层符号表</li>
</ul>
<p><strong>打开对象</strong></p>
<p>获取Object Id后，使用 GetObject 函数打开指定Object Id的对象。可以通过以下方式打开对象：</p>
<ul>
<li>Read.打开一个对象进行读取。</li>
<li>Write. 如果对象尚未打开，则打开该对象进行写入。</li>
<li>Notify.通知。当对象处于关闭状态、打开进行读取或打开进行写入时，打开对象进行通知，但当对象已打开进行通知时，不打开对象进行通知。此模式适用于对象可能从其自身代码中修改自身的情况，例如定义AutoCAD Managed .NET API不支持的自定义对象时。</li>
</ul>
<p>您应该以最适合访问对象的情况的模式打开对象。由于创建撤消记录，打开对象进行写操作会引入额外的开销。如果不确定要打开的对象是否是要使用的对象，则应将其打开以进行读取，然后将对象从读取模式升级到写入模式。有关升级对象的更多信息，请参阅“升级和降级开放对象（.NET）”。</p>
<p>GetObject 和 Open 函数都返回一个对象。在使用某些编程语言时，您需要根据值被赋给的变量强制转换返回值。如果您使用的是VB.NET，则无需担心转换返回值，因为它已为您完成。</p>
<p>当使用动态编译语言（DLR）时，您不需要担心打开对象进行读取或写入。对象的打开对您来说是透明的，提交对对象所做的更改的过程也是透明的，而不使用事务。</p>
<p>以下示例说明如何获取当前数据库的零层的 LayerTableRecord 。</p>
<p>下面的示例在不再需要事务后手动处置该事务。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Document acCurDb = Application.DocumentManager.MdiActiveDocument.Database;</span><br><span class="line">Transaction acTrans = acCurDb.TransactionManager.StartTransaction();</span><br><span class="line"> </span><br><span class="line">LayerTableRecord acLyrTblRec;</span><br><span class="line">acLyrTblRec = acTrans.GetObject(acCurDb.LayerZero,</span><br><span class="line">                                OpenMode.ForRead) <span class="keyword">as</span> LayerTableRecord;</span><br><span class="line"> </span><br><span class="line">acTrans.Dispose();</span><br></pre></td></tr></table></figure>

<p>下面的示例使用 Using 语句在不再需要事务后释放该事务。 Using 语句是首选的编码风格。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Document acCurDb = Application.DocumentManager.MdiActiveDocument.Database;</span><br><span class="line"><span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">&#123;</span><br><span class="line">    LayerTableRecord acLyrTblRec;</span><br><span class="line">    acLyrTblRec = acTrans.GetObject(acCurDb.LayerZero,</span><br><span class="line">                                    OpenMode.ForRead) <span class="keyword">as</span> LayerTableRecord;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="将事务与事务管理器（-NET）一起使用"><a href="#将事务与事务管理器（-NET）一起使用" class="headerlink" title="将事务与事务管理器（.NET）一起使用"></a>将事务与事务管理器（.NET）一起使用</h3><p>事务用于将多个对象上的多个操作组合在一起作为单个操作。事务通过事务管理器启动和管理。一旦一个事务开始，你就可以使用 GetObject 函数打开一个对象。</p>
<p>当您使用使用 GetObject 打开的对象时，事务管理器会跟踪对对象所做的更改。您创建并添加到数据库中的任何新对象都应该使用 AddNewlyCreatedDBObject 函数添加到事务中。对象被编辑或添加到数据库后，您可以保存对数据库所做的更改，并使用使用事务管理器创建的事务对象上的 Commit 函数关闭所有打开的对象。一旦你完成了一个事务，调用 Dispose 函数关闭这个事务。</p>
<p>本节中的主题</p>
<ul>
<li>使用事务访问和创建对象（.NET）</li>
<li>提交和回滚更改（.NET）</li>
<li>释放对象（.NET）</li>
<li>嵌套事务（.NET）</li>
</ul>
<h4 id="使用事务访问和创建对象（-NET）"><a href="#使用事务访问和创建对象（-NET）" class="headerlink" title="使用事务访问和创建对象（.NET）"></a>使用事务访问和创建对象（.NET）</h4><p>从当前数据库的 TransactionManager 属性访问事务管理器。引用事务管理器后，可以使用以下方法之一来启动或获取事务：</p>
<ul>
<li>StartTransaction-通过创建 Transaction 对象的新实例来启动新事务。当需要多次写入对象并通过使用不同的嵌套级别控制如何回滚更改时，请使用此方法。</li>
<li>StartOpenCloseTransation-创建一个 OpenCloseTransaction 对象，它的行为类似于 Transaction 对象，它包装了对象的 Open 和 Close 方法，使其更容易关闭所有打开的对象，而不必显式关闭每个打开的对象。建议在可能被调用未知次数的支持或实用程序函数中使用，并在处理大多数事件处理程序时使用。</li>
</ul>
<p>一旦有了 Transaction 或 OpenCloseTransaction 对象，就可以使用 GetObject 方法打开存储在数据库中的对象进行读或写。 GetObject 方法返回一个 DBObject ，它可以转换为它所代表的实际对象类型。</p>
<p>在事务处理期间打开的所有打开对象在事务处理结束时关闭。要结束事务，请调用事务对象的 Dispose 方法。如果使用 Using 和 End Using 关键字来指示事务的开始和结束，则不需要调用 Dispose 方法。</p>
<p>在释放事务之前，您应该提交使用 Commit 方法所做的任何更改。如果在处置事务之前没有提交更改，则所做的任何更改都将回滚到事务开始之前的状态。</p>
<p>可以启动多个事务。可以使用 TransactionManager 对象的 NumberOfActiveTransactions 属性检索活动事务的数量，而可以使用 TopTransaction 属性检索最顶部或最新的事务。</p>
<p>事务可以一个嵌套在另一个内部，以便回滚在例程执行期间所做的某些更改。</p>
<p><strong>查询对象</strong></p>
<p>下面的示例演示如何使用事务打开和读取中的对象。使用 GetObject 方法首先打开 BlockTable ，然后打开Model空间记录。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Runtime;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.ApplicationServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.DatabaseServices;</span><br><span class="line"> </span><br><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;StartTransactionManager&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">StartTransactionManager</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current document and database</span></span><br><span class="line">    Document acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line">    Database acCurDb = acDoc.Database;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Start a transaction</span></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId,</span><br><span class="line">                                     OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Open the Block table record Model space for read</span></span><br><span class="line">        BlockTableRecord acBlkTblRec;</span><br><span class="line">        acBlkTblRec = acTrans.GetObject(acBlkTbl[BlockTableRecord.ModelSpace],</span><br><span class="line">                                        OpenMode.ForRead) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Step through the Block table record</span></span><br><span class="line">        <span class="keyword">foreach</span> (ObjectId asObjId <span class="keyword">in</span> acBlkTblRec)</span><br><span class="line">        &#123;</span><br><span class="line">            acDoc.Editor.WriteMessage(<span class="string">&quot;\nDXF name: &quot;</span> + asObjId.ObjectClass.DxfName);</span><br><span class="line">            acDoc.Editor.WriteMessage(<span class="string">&quot;\nObjectID: &quot;</span> + asObjId.ToString());</span><br><span class="line">            acDoc.Editor.WriteMessage(<span class="string">&quot;\nHandle: &quot;</span> + asObjId.Handle.ToString());</span><br><span class="line">            acDoc.Editor.WriteMessage(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Dispose of the transaction</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>向数据库添加新对象</strong></p>
<p>下面的示例演示如何在事务中向数据库中添加一个圆对象。使用 GetObject 方法首先打开BlockTable进行读取，然后打开Model空间记录进行写入。打开Model空间进行写操作后，使用 AppendEntity 和 AddNewlyCreatedDBObject 函数将新的Circle对象附加到Model空间以及事务。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Runtime;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.ApplicationServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.DatabaseServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Geometry;</span><br><span class="line"> </span><br><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;AddNewCircleTransaction&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddNewCircleTransaction</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current document and database</span></span><br><span class="line">    Document acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line">    Database acCurDb = acDoc.Database;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start a transaction</span></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartOpenCloseTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId,</span><br><span class="line">                                        OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Block table record Model space for write</span></span><br><span class="line">        BlockTableRecord acBlkTblRec;</span><br><span class="line">        acBlkTblRec = acTrans.GetObject(acBlkTbl[BlockTableRecord.ModelSpace],</span><br><span class="line">                                        OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create a circle with a radius of 3 at 5,5</span></span><br><span class="line">        <span class="keyword">using</span> (Circle acCirc = <span class="keyword">new</span> Circle())</span><br><span class="line">        &#123;</span><br><span class="line">            acCirc.Center = <span class="keyword">new</span> Point3d(<span class="number">5</span>, <span class="number">5</span>, <span class="number">0</span>);</span><br><span class="line">            acCirc.Radius = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Add the new object to Model space and the transaction</span></span><br><span class="line">            acBlkTblRec.AppendEntity(acCirc);</span><br><span class="line">            acTrans.AddNewlyCreatedDBObject(acCirc, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Commit the changes and dispose of the transaction</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="提交和回滚更改（-NET）"><a href="#提交和回滚更改（-NET）" class="headerlink" title="提交和回滚更改（.NET）"></a>提交和回滚更改（.NET）</h4><p>使用事务时，可以决定何时将对对象的更改保存到图形数据库中。您可以使用 Commit 方法保存对事务中打开的对象所做的更改。如果你的程序遇到错误，你可以使用 Abort 方法回滚在事务中所做的任何更改。</p>
<p>如果在调用 Dispose 之前没有调用 Commit ，则回滚事务中所做的所有更改。无论调用 Commit 还是 Abort ，都需要调用 Dispose 来表示事务结束。如果transaction对象是用 Using 语句启动的，则不必调用 Dispose 。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Commit the changes made within the transaction</span></span><br><span class="line">&lt;transaction&gt;.Commit();</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Abort the transaction and rollback to the previous state</span></span><br><span class="line">&lt;transaction&gt;.Abort();</span><br></pre></td></tr></table></figure>

<h4 id="Dispose-对象（-NET）"><a href="#Dispose-对象（-NET）" class="headerlink" title="Dispose 对象（.NET）"></a>Dispose 对象（.NET）</h4><p>在.NET中创建新对象时，必须通过处理过程和垃圾收集从内存中正确释放对象。你可以使用 Dispose 方法或 Using 语句来通知一个对象何时可以进行垃圾回收。在大多数情况下， Using 语句是首选方法，因为它在不再需要对象时进行适当的调用来关闭和释放对象。</p>
<p>您需要在以下条件下释放对象：</p>
<ul>
<li>总是使用 Transaction 或 DocumentLock 对象</li>
<li>总是使用新创建的数据库对象，从 DBObject 派生的对象，这些对象正在添加到事务中</li>
<li>始终使用新创建的数据库对象，即从 DBObject 派生的对象，这些对象未添加到数据库中</li>
<li>不必与现有的数据库对象，从 DBObject 派生的对象，用transaction对象和 GetObject 方法打开</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Dispose an object with the using statement</span></span><br><span class="line"><span class="keyword">using</span> (&lt;dataType&gt; &lt;<span class="built_in">object</span>&gt;  = &lt;<span class="keyword">value</span>&gt;)</span><br><span class="line">    <span class="comment">// Do something here</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Manually dispose of an object with the Dispose method</span></span><br><span class="line">&lt;<span class="built_in">object</span>&gt;. Dispose ();</span><br></pre></td></tr></table></figure>

<h4 id="嵌套事务（-NET）"><a href="#嵌套事务（-NET）" class="headerlink" title="嵌套事务（.NET）"></a>嵌套事务（.NET）</h4><p>事务可以一个嵌套在另一个内部。您可能有一个外部事务来撤消例程所做的所有更改，而内部事务只撤消所做更改的一部分。当你处理嵌套事务时，你从一个顶层事务开始，它也是最外层的事务。</p>
<p>当您开始新的事务时，它们将被添加到前一个事务中。嵌套事务必须按照与创建它们相反的顺序提交或中止。所以如果你有三个事务，你必须在第二个之前关闭第三个或最里面的一个，最后关闭第一个。如果中止第一个事务，则将撤消所有三个事务所做的更改。</p>
<p>下图显示事务在嵌套时的显示方式。</p>
<p><img src="https://help.autodesk.com/cloudhelp/2024/ENU/OARX-DevGuide-Managed/images/GUID-ECA5C137-B00E-4686-8086-86EB4DC55F6E.png"></p>
<p><strong>使用嵌套事务创建和修改对象</strong></p>
<p>下面的示例演示如何使用三个事务创建 Circle 和 Line 对象，然后更改它们的颜色。圆的颜色在第二和第三个事务中改变，但是由于第三个事务被中止，所以只有在第一和第二个事务中所做的改变被保存到数据库中。此外，在创建和关闭活动事务时，会在“命令行”窗口中打印活动事务的数量。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Runtime;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.ApplicationServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.DatabaseServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Geometry;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.EditorInput;</span><br><span class="line"> </span><br><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;NestedTransactions&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">NestedTransactions</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current document and database</span></span><br><span class="line">    Document acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line">    Database acCurDb = acDoc.Database;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create a reference to the Transaction Manager</span></span><br><span class="line">    Autodesk.AutoCAD.DatabaseServices.TransactionManager acTransMgr;</span><br><span class="line">    acTransMgr = acCurDb.TransactionManager;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create a new transaction</span></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans1 = acTransMgr.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Print the current number of active transactions</span></span><br><span class="line">        acDoc.Editor.WriteMessage(<span class="string">&quot;\nNumber of transactions active: &quot;</span> +</span><br><span class="line">                                    acTransMgr.NumberOfActiveTransactions.ToString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans1.GetObject(acCurDb.BlockTableId,</span><br><span class="line">                                        OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Block table record Model space for write</span></span><br><span class="line">        BlockTableRecord acBlkTblRec;</span><br><span class="line">        acBlkTblRec = acTrans1.GetObject(acBlkTbl[BlockTableRecord.ModelSpace],</span><br><span class="line">                                            OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create a circle with a radius of 3 at 5,5</span></span><br><span class="line">        <span class="keyword">using</span> (Circle acCirc = <span class="keyword">new</span> Circle())</span><br><span class="line">        &#123;</span><br><span class="line">            acCirc.Center = <span class="keyword">new</span> Point3d(<span class="number">5</span>, <span class="number">5</span>, <span class="number">0</span>);</span><br><span class="line">            acCirc.Radius = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Add the new object to Model space and the transaction</span></span><br><span class="line">            acBlkTblRec.AppendEntity(acCirc);</span><br><span class="line">            acTrans1.AddNewlyCreatedDBObject(acCirc, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Create the second transaction</span></span><br><span class="line">            <span class="keyword">using</span> (Transaction acTrans2 = acTransMgr.StartTransaction())</span><br><span class="line">            &#123;</span><br><span class="line">                acDoc.Editor.WriteMessage(<span class="string">&quot;\nNumber of transactions active: &quot;</span> +</span><br><span class="line">                                            acTransMgr.NumberOfActiveTransactions.ToString());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Change the circle&#x27;s color</span></span><br><span class="line">                acCirc.ColorIndex = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Get the object that was added to Transaction 1 and set it to the color 5</span></span><br><span class="line">                <span class="keyword">using</span> (Line acLine = <span class="keyword">new</span> Line(<span class="keyword">new</span> Point3d(<span class="number">2</span>, <span class="number">5</span>, <span class="number">0</span>), <span class="keyword">new</span> Point3d(<span class="number">10</span>, <span class="number">7</span>, <span class="number">0</span>)))</span><br><span class="line">                &#123;</span><br><span class="line">                    acLine.ColorIndex = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Add the new object to Model space and the transaction</span></span><br><span class="line">                    acBlkTblRec.AppendEntity(acLine);</span><br><span class="line">                    acTrans2.AddNewlyCreatedDBObject(acLine, <span class="literal">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Create the third transaction</span></span><br><span class="line">                <span class="keyword">using</span> (Transaction acTrans3 = acTransMgr.StartTransaction())</span><br><span class="line">                &#123;</span><br><span class="line">                    acDoc.Editor.WriteMessage(<span class="string">&quot;\nNumber of transactions active: &quot;</span> +</span><br><span class="line">                                                acTransMgr.NumberOfActiveTransactions.ToString());</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Change the circle&#x27;s color</span></span><br><span class="line">                    acCirc.ColorIndex = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Update the display of the drawing</span></span><br><span class="line">                    acDoc.Editor.WriteMessage(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                    acDoc.Editor.Regen();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Request to keep or discard the changes in the third transaction</span></span><br><span class="line">                    PromptKeywordOptions pKeyOpts = <span class="keyword">new</span> PromptKeywordOptions(<span class="string">&quot;&quot;</span>);</span><br><span class="line">                    pKeyOpts.Message = <span class="string">&quot;\nKeep color change &quot;</span>;</span><br><span class="line">                    pKeyOpts.Keywords.Add(<span class="string">&quot;Yes&quot;</span>);</span><br><span class="line">                    pKeyOpts.Keywords.Add(<span class="string">&quot;No&quot;</span>);</span><br><span class="line">                    pKeyOpts.Keywords.Default = <span class="string">&quot;No&quot;</span>;</span><br><span class="line">                    pKeyOpts.AllowNone = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">                    PromptResult pKeyRes = acDoc.Editor.GetKeywords(pKeyOpts);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (pKeyRes.StringResult == <span class="string">&quot;No&quot;</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// Discard the changes in transaction 3</span></span><br><span class="line">                        acTrans3.Abort();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// Save the changes in transaction 3</span></span><br><span class="line">                        acTrans3.Commit();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Dispose the transaction</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                acDoc.Editor.WriteMessage(<span class="string">&quot;\nNumber of transactions active: &quot;</span> +</span><br><span class="line">                                            acTransMgr.NumberOfActiveTransactions.ToString());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Keep the changes to transaction 2</span></span><br><span class="line">                acTrans2.Commit();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        acDoc.Editor.WriteMessage(<span class="string">&quot;\nNumber of transactions active: &quot;</span> +</span><br><span class="line">                                    acTransMgr.NumberOfActiveTransactions.ToString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Keep the changes to transaction 1</span></span><br><span class="line">        acTrans1.Commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="不使用事务管理器打开和关闭对象（-NET）"><a href="#不使用事务管理器打开和关闭对象（-NET）" class="headerlink" title="不使用事务管理器打开和关闭对象（.NET）"></a>不使用事务管理器打开和关闭对象（.NET）</h3><p>事务使打开和处理多个对象变得更容易，但它们不是打开和编辑对象的唯一方法。除了使用事务之外，您还可以使用 Open 和 Close 方法打开和关闭对象。您仍然需要获得对象ID才能使用 Open 方法。与transactions中使用的 GetObject 方法一样，您需要指定一个开放模式，并且返回值是一个对象。</p>
<p>如果您在使用 Open 方法打开对象后对其进行了更改，则可以使用 Cancel 方法回滚自打开对象以来所做的所有更改。 Cancel 必须在每个要回滚的对象上调用。在关闭对象后，还必须使用 Dispose 方法正确地释放对象，或者可以使用 Using 语句关闭和释放对象。</p>
<p>注意：对象必须与打开和关闭操作配对。如果你使用了没有 Using 语句的 Open 方法，你必须在一个打开的对象上调用 Close 或 Cancel 方法。如果无法关闭对象，将导致读取访问冲突，并导致AutoCAD变得不稳定。</p>
<p>如果您需要处理单个对象，与使用事务管理器相比，使用 Open 和 Close 方法可以减少您可能必须编写的代码行数。但是，建议使用事务来打开和关闭对象。</p>
<p>注意：使用事务时，不应直接使用 Open 和 Close 方法，因为事务管理器可能无法正确打开或关闭对象，这可能会导致AutoCAD变得不稳定。相反，使用 StartOpenCloseTransation 方法创建一个 OpenCloseTransaction 对象，它包装了 Open 和 Close 方法。</p>
<p><strong>查询对象（手动打开和关闭对象）</strong></p>
<p>这个例子演示了如何手动打开和关闭对象，而不使用transaction和 GetObject 方法。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Runtime;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.ApplicationServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.DatabaseServices;</span><br><span class="line"> </span><br><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;OpenCloseObjectId&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OpenCloseObjectId</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current document and database</span></span><br><span class="line">    Document acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line">    Database acCurDb = acDoc.Database;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Open the Block table for read</span></span><br><span class="line">    BlockTable acBlkTbl = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        acBlkTbl = acCurDb.BlockTableId.Open(OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Block table record Model space for read</span></span><br><span class="line">        BlockTableRecord acBlkTblRec = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            acBlkTblRec = acBlkTbl[BlockTableRecord.ModelSpace].Open(OpenMode.ForRead) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Step through the Block table record</span></span><br><span class="line">            <span class="keyword">foreach</span> (ObjectId acObjId <span class="keyword">in</span> acBlkTblRec)</span><br><span class="line">            &#123;</span><br><span class="line">                acDoc.Editor.WriteMessage(<span class="string">&quot;\nDXF name: &quot;</span> + acObjId.ObjectClass.DxfName);</span><br><span class="line">                acDoc.Editor.WriteMessage(<span class="string">&quot;\nObjectID: &quot;</span> + acObjId.ToString());</span><br><span class="line">                acDoc.Editor.WriteMessage(<span class="string">&quot;\nHandle: &quot;</span> + acObjId.Handle.ToString());</span><br><span class="line">                acDoc.Editor.WriteMessage(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Autodesk.AutoCAD.Runtime.Exception es)</span><br><span class="line">        &#123;</span><br><span class="line">            System.Windows.Forms.MessageBox.Show(es.Message);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Close the Block table</span></span><br><span class="line">            <span class="keyword">if</span> (!acBlkTblRec.ObjectId.IsNull)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Close the Block table record</span></span><br><span class="line">                acBlkTblRec.Close();</span><br><span class="line">                acBlkTblRec.Dispose();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Autodesk.AutoCAD.Runtime.Exception es)</span><br><span class="line">    &#123;</span><br><span class="line">        System.Windows.Forms.MessageBox.Show(es.Message);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Close the Block table</span></span><br><span class="line">        <span class="keyword">if</span> (!acBlkTbl.ObjectId.IsNull)</span><br><span class="line">        &#123;</span><br><span class="line">            acBlkTbl.Close();</span><br><span class="line">            acBlkTbl.Dispose();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>查询对象（使用语句）</strong></p>
<p>下面的示例演示如何使用Using语句打开和关闭对象，而不是手动关闭和释放对象。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Runtime;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.ApplicationServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.DatabaseServices;</span><br><span class="line"> </span><br><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;OpenCloseObjectIdWithUsing&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OpenCloseObjectIdWithUsing</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current document and database</span></span><br><span class="line">    Document acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line">    Database acCurDb = acDoc.Database;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Open the Block table for read</span></span><br><span class="line">    <span class="keyword">using</span> (BlockTable acBlkTbl = acCurDb.BlockTableId.Open(OpenMode.ForRead) <span class="keyword">as</span> BlockTable)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table record Model space for read</span></span><br><span class="line">        <span class="keyword">using</span> (BlockTableRecord acBlkTblRec = acBlkTbl[BlockTableRecord.ModelSpace].Open(OpenMode.ForRead)</span><br><span class="line">                                                <span class="keyword">as</span> BlockTableRecord)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Step through the Block table record</span></span><br><span class="line">            <span class="keyword">foreach</span> (ObjectId acObjId <span class="keyword">in</span> acBlkTblRec)</span><br><span class="line">            &#123;</span><br><span class="line">                acDoc.Editor.WriteMessage(<span class="string">&quot;\nDXF name: &quot;</span> + acObjId.ObjectClass.DxfName);</span><br><span class="line">                acDoc.Editor.WriteMessage(<span class="string">&quot;\nObjectID: &quot;</span> + acObjId.ToString());</span><br><span class="line">                acDoc.Editor.WriteMessage(<span class="string">&quot;\nHandle: &quot;</span> + acObjId.Handle.ToString());</span><br><span class="line">                acDoc.Editor.WriteMessage(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Close the Block table record</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Close the Block table</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>向数据库添加新对象</strong></p>
<p>这个例子演示了如何创建一个新的对象，并将其追加到模型空间，而不使用事务管理器。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Runtime;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.ApplicationServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.DatabaseServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Geometry;</span><br><span class="line"> </span><br><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;AddNewCircleOpenClose&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddNewCircleOpenClose</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current document and database</span></span><br><span class="line">    Document acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line">    Database acCurDb = acDoc.Database;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Open the Block table for read</span></span><br><span class="line">    <span class="keyword">using</span> (BlockTable acBlkTbl = acCurDb.BlockTableId.Open(OpenMode.ForRead) <span class="keyword">as</span> BlockTable)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table record Model space for write</span></span><br><span class="line">        <span class="keyword">using</span> (BlockTableRecord acBlkTblRec = acBlkTbl[BlockTableRecord.ModelSpace].Open(OpenMode.ForWrite)</span><br><span class="line">                                                <span class="keyword">as</span> BlockTableRecord)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Create a circle with a radius of 3 at 5,5</span></span><br><span class="line">            <span class="keyword">using</span> (Circle acCirc = <span class="keyword">new</span> Circle())</span><br><span class="line">            &#123;</span><br><span class="line">                acCirc.Center = <span class="keyword">new</span> Point3d(<span class="number">5</span>, <span class="number">5</span>, <span class="number">0</span>);</span><br><span class="line">                acCirc.Radius = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Add the new object to Model space and the transaction</span></span><br><span class="line">                acBlkTblRec.AppendEntity(acCirc);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Close and dispose the circle object</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Close the Block table record</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Close the Block table</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="升级和降级Open-Objects（-NET）"><a href="#升级和降级Open-Objects（-NET）" class="headerlink" title="升级和降级Open Objects（.NET）"></a>升级和降级Open Objects（.NET）</h3><p>通过升级或降级对象，可以将对象的当前打开模式从读更改为写或从写更改为读。</p>
<p>这些方法可用于升级或降级以前打开的对象：</p>
<ul>
<li>Transaction.GetObject method – 如果对象是用 Transaction.GetObject 方法打开的，则使用该方法以所需的新打开模式重新打开对象。</li>
<li>UpgradeOpen and DowngradeOpen methods –如果对象是用 Open 方法或 OpenCloseTransaction.GetObject 打开的，则使用 UpgradeOpen 方法将对象的打开模式从读更改为写，或使用 DowngradeOpen 方法将对象的打开模式从写更改为读。您不需要将对 DowngradeOpen 的调用与每个 UpgradeOpen 配对，因为关闭对象或处置事务将足以清理对象的打开状态。</li>
</ul>
<p>建议使用与对象的使用方式最匹配的模式打开对象，因为打开对象以读取并查询对象的属性比打开对象以写入并查询对象的属性更有效。如果你不确定一个对象是否需要修改，最好打开对象进行读操作，然后升级它进行写操作，因为这有助于减少程序的开销。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Runtime;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.ApplicationServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.DatabaseServices;</span><br><span class="line"> </span><br><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;FreezeDoorLayer&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">FreezeDoorLayer</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current document and database</span></span><br><span class="line">    Document acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line">    Database acCurDb = acDoc.Database;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start a transaction</span></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Layer table for read</span></span><br><span class="line">        LayerTable acLyrTbl;</span><br><span class="line">        acLyrTbl = acTrans.GetObject(acCurDb.LayerTableId,</span><br><span class="line">                                        OpenMode.ForRead) <span class="keyword">as</span> LayerTable;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Step through each layer and update those that start with &#x27;Door&#x27;</span></span><br><span class="line">        <span class="keyword">foreach</span> (ObjectId acObjId <span class="keyword">in</span> acLyrTbl)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Open the Layer table record for read</span></span><br><span class="line">            LayerTableRecord acLyrTblRec;</span><br><span class="line">            acLyrTblRec = acTrans.GetObject(acObjId,</span><br><span class="line">                                            OpenMode.ForRead) <span class="keyword">as</span> LayerTableRecord;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Check to see if the layer&#x27;s name starts with &#x27;Door&#x27; </span></span><br><span class="line">            <span class="keyword">if</span> (acLyrTblRec.Name.StartsWith(<span class="string">&quot;Door&quot;</span>,</span><br><span class="line">                                            StringComparison.OrdinalIgnoreCase) == <span class="literal">true</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Check to see if the layer is current, if so then do not freeze it</span></span><br><span class="line">                <span class="keyword">if</span> (acLyrTblRec.ObjectId != acCurDb.Clayer)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// Change from read to write mode</span></span><br><span class="line">                    acTrans.GetObject(acObjId, OpenMode.ForWrite);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Freeze the layer</span></span><br><span class="line">                    acLyrTblRec.IsFrozen = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Commit the changes and dispose of the transaction</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="关于使用动态语言（-NET）"><a href="#关于使用动态语言（-NET）" class="headerlink" title="关于使用动态语言（.NET）"></a>关于使用动态语言（.NET）</h3><p>AutoCAD托管.NET API允许您利用.NET 4.0中引入的动态语言编译器（DLR）。</p>
<p>使用DLR可以直接访问对象，而无需：</p>
<ul>
<li>打开一个对象进行读或写，然后在完成后关闭该对象。</li>
<li>利用事务来提交所做的更改。</li>
</ul>
<p>在使用DLR时，一旦获得对象的ObjectId，就可以直接访问对象的属性和方法。获得ObjectId后，可以将ObjectId赋给数据类型的变量：</p>
<ul>
<li>Object in VB.NET  </li>
<li>dynamic in C#</li>
</ul>
<p>获取ObjectId的方式因对象保存到数据库的方式而异。对于存储在表或字典中的对象，您可以通过以下方式访问其ObjectId：</p>
<ul>
<li>使用ObjectId的Item方法访问集合中的元素。</li>
<li>创建对表或字典的ObjectId的引用，并将其赋值给变量，然后访问数组的元素。</li>
</ul>
<p>以下示例代码显示了使用DLR访问存储在表或字典中的对象的两个选项：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">C<span class="meta">#</span></span><br><span class="line"><span class="comment">// Item method</span></span><br><span class="line"><span class="built_in">dynamic</span> acCurDb = HostApplicationServices.WorkingDatabase;</span><br><span class="line"><span class="built_in">dynamic</span> acMSpace = acCurDb.BlockTableId.Item(BlockTableRecord.ModelSpace);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Reference an element directly from a collection</span></span><br><span class="line"><span class="built_in">dynamic</span> acCurDb = HostApplicationServices.WorkingDatabase;</span><br><span class="line"><span class="built_in">dynamic</span> acBlkTbl = acCurDb.BlockTableId;</span><br><span class="line"><span class="built_in">dynamic</span> acMSpace = acBlkTbl[BlockTableRecord.ModelSpace];</span><br></pre></td></tr></table></figure>

<p>重要：使用DLR和C#时，您需要引用Microsoft.CSharp库。</p>
<p><strong>使用GetEnumerator方法</strong></p>
<p>在使用DLR的 GetEnumerator 方法时，需要在使用完枚举器对象后显式释放枚举器对象。下面的示例演示了如何在使用完枚举器对象后释放枚举器。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C<span class="meta">#</span></span><br><span class="line"><span class="built_in">dynamic</span> acCurDb = HostApplicationServices.WorkingDatabase;</span><br><span class="line"><span class="keyword">var</span> acLtypeTbl = acCurDb.LinetypeTableId;</span><br><span class="line"><span class="keyword">var</span> acTblEnum = acLtypeTbl.GetEnumerator();</span><br><span class="line">...</span><br><span class="line">acTblEnum.Dispose();</span><br></pre></td></tr></table></figure>

<p><strong>使用LINQ脚本</strong></p>
<p>可以使用LINQ查询来查询带有DLR的图形中的表或字典的内容。下面的示例演示如何使用LINQ查询来查询当前图形中为哪些图层指定了某些状态。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;LINQ&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">LINQExample</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">dynamic</span> db = HostApplicationServices.WorkingDatabase;</span><br><span class="line">    <span class="built_in">dynamic</span> doc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> layers = db.LayerTableId;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> newrec = layers.Add(<span class="keyword">new</span> LayerTableRecord());</span><br><span class="line">        newrec.Name = <span class="string">&quot;Layer&quot;</span> + i.ToString();</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>)</span><br><span class="line">            newrec.IsFrozen = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">1</span>)</span><br><span class="line">            newrec.IsOff = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> OffLayers = <span class="function"><span class="keyword">from</span> l <span class="title">in</span> (<span class="params">IEnumerable&lt;<span class="built_in">dynamic</span>&gt;</span>)layers</span></span><br><span class="line"><span class="function">                    <span class="keyword">where</span> l.IsOff</span></span><br><span class="line"><span class="function">                    <span class="keyword">select</span> l</span>;</span><br><span class="line"></span><br><span class="line">    doc.Editor.WriteMessage(<span class="string">&quot;\nLayers Turned Off:&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="built_in">dynamic</span> rec <span class="keyword">in</span> OffLayers)</span><br><span class="line">        doc.Editor.WriteMessage(<span class="string">&quot;\n - &quot;</span> + rec.Name);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> frozenOrOffNames = <span class="function"><span class="keyword">from</span> l <span class="title">in</span> (<span class="params">IEnumerable&lt;<span class="built_in">dynamic</span>&gt;</span>)layers</span></span><br><span class="line"><span class="function">                            <span class="keyword">where</span> l.IsFrozen</span> == <span class="literal">true</span> || l.IsOff == <span class="literal">true</span></span><br><span class="line">                            <span class="keyword">select</span> l;</span><br><span class="line"></span><br><span class="line">    doc.Editor.WriteMessage(<span class="string">&quot;\nLayers Frozen or Turned Off:&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="built_in">dynamic</span> rec <span class="keyword">in</span> frozenOrOffNames)</span><br><span class="line">        doc.Editor.WriteMessage(<span class="string">&quot;\n - &quot;</span> + rec.Name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>示例代码</strong></p>
<p>此页面上的示例代码使用以下名称空间：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Autodesk.AutoCAD.Runtime</span><br><span class="line">Autodesk.AutoCAD.ApplicationServices</span><br><span class="line">Autodesk.AutoCAD.DatabaseServices</span><br><span class="line">Autodesk.AutoCAD.Colors</span><br><span class="line">Autodesk.AutoCAD.Geometry</span><br></pre></td></tr></table></figure>

<p>下面的示例代码演示了如何将Line添加到当前空间;使用和不使用DLR。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;ADDLINE&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddLine</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database</span></span><br><span class="line">    Database acCurDb = HostApplicationServices.WorkingDatabase;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start a transaction</span></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId,</span><br><span class="line">                                     OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Block table record Model space for write</span></span><br><span class="line">        BlockTableRecord acBlkTblRec;</span><br><span class="line">        acBlkTblRec = acTrans.GetObject(acBlkTbl[BlockTableRecord.ModelSpace],</span><br><span class="line">                                        OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create a line that starts at 5,5 and ends at 12,3</span></span><br><span class="line">        <span class="keyword">using</span> (Line acLine = <span class="keyword">new</span> Line(<span class="keyword">new</span> Point3d(<span class="number">5</span>, <span class="number">5</span>, <span class="number">0</span>),</span><br><span class="line">                                      <span class="keyword">new</span> Point3d(<span class="number">12</span>, <span class="number">3</span>, <span class="number">0</span>)))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Add the new object to the block table record and the transaction</span></span><br><span class="line">            acBlkTblRec.AppendEntity(acLine);</span><br><span class="line">            acTrans.AddNewlyCreatedDBObject(acLine, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new object to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>C#动态语言（DLR）</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;ADDLINE&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddLine</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database</span></span><br><span class="line">    <span class="built_in">dynamic</span> acCurDb = HostApplicationServices.WorkingDatabase;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create a dynamic reference to model or paper space</span></span><br><span class="line">    <span class="built_in">dynamic</span> acSpace = acCurDb.CurrentSpaceId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create a line that starts at 5,5 and ends at 12,3</span></span><br><span class="line">    <span class="built_in">dynamic</span> acLine = <span class="keyword">new</span> Line(<span class="keyword">new</span> Point3d(<span class="number">5</span>, <span class="number">5</span>, <span class="number">0</span>),</span><br><span class="line">                              <span class="keyword">new</span> Point3d(<span class="number">12</span>, <span class="number">3</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add the new object to the current space</span></span><br><span class="line">    acSpace.AppendEntity(acLine);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面的示例代码演示了如何将层添加到当前数据库;使用和不使用DLR。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;ADDLAYER&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddLayer</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database</span></span><br><span class="line">    Database acCurDb = HostApplicationServices.WorkingDatabase;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Returns the layer table for the current database</span></span><br><span class="line">        LayerTable acLyrTbl;</span><br><span class="line">        acLyrTbl = acTrans.GetObject(acCurDb.LayerTableId,</span><br><span class="line">                                     OpenMode.ForRead) <span class="keyword">as</span> LayerTable;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check to see if MyLayer exists in the Layer table</span></span><br><span class="line">        <span class="keyword">if</span> (acLyrTbl.Has(<span class="string">&quot;MyLayer&quot;</span>) != <span class="literal">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Open the Layer Table for write</span></span><br><span class="line">            acTrans.GetObject(acCurDb.LayerTableId, OpenMode.ForWrite);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Create a new layer named &quot;MyLayer&quot;</span></span><br><span class="line">            <span class="keyword">using</span> (LayerTableRecord acLyrTblRec = <span class="keyword">new</span> LayerTableRecord())</span><br><span class="line">            &#123;</span><br><span class="line">                acLyrTblRec.Name = <span class="string">&quot;MyLayer&quot;</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Assign the ACI color 3 to the new layer</span></span><br><span class="line">                Color acClr = Color.FromColorIndex(ColorMethod.ByAci, <span class="number">3</span>);</span><br><span class="line">                acLyrTblRec.Color = acClr;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Add the new layer table record to the layer table and the transaction</span></span><br><span class="line">                acLyrTbl.Add(acLyrTblRec);</span><br><span class="line">                acTrans.AddNewlyCreatedDBObject(acLyrTblRec, <span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Commit the changes</span></span><br><span class="line">            acTrans.Commit();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dispose of the transaction</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>C#动态语言（DLR）</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;ADDLAYER&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddLayer</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current database</span></span><br><span class="line">    <span class="built_in">dynamic</span> acCurDb = HostApplicationServices.WorkingDatabase;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">dynamic</span> acLyrTbl = acCurDb.LayerTableId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check to see if MyLayer exists in the Layer table</span></span><br><span class="line">    <span class="keyword">if</span> (acLyrTbl.Has(<span class="string">&quot;MyLayer&quot;</span>) != <span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Create a new layer named &quot;MyLayer&quot;</span></span><br><span class="line">        <span class="built_in">dynamic</span> acLyrTblRec = <span class="keyword">new</span> LayerTableRecord();</span><br><span class="line">        acLyrTblRec.Name = <span class="string">&quot;MyLayer&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Assign the ACI color 3 to the new layer</span></span><br><span class="line">        <span class="built_in">dynamic</span> acClr = Color.FromColorIndex(ColorMethod.ByAci, <span class="number">3</span>);</span><br><span class="line">        acLyrTblRec.Color = acClr;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Add the new layer table record to the layer table</span></span><br><span class="line">        acLyrTbl.Add(acLyrTblRec);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面演示了如何逐步遍历并列出当前空间中的所有对象（使用和不使用DLR）。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;LISTOBJECTS&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ListObjects</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current document and database</span></span><br><span class="line">    Document acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line">    Database acCurDb = HostApplicationServices.WorkingDatabase;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table record Model space for write</span></span><br><span class="line">        BlockTableRecord acSpace;</span><br><span class="line">        acSpace = acTrans.GetObject(acCurDb.CurrentSpaceId,</span><br><span class="line">                                    OpenMode.ForRead) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Step through the current space</span></span><br><span class="line">        <span class="keyword">foreach</span> (ObjectId objId <span class="keyword">in</span> acSpace)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Display the class and current layer of the object</span></span><br><span class="line">            Entity acEnt = (Entity)acTrans.GetObject(objId, OpenMode.ForRead);</span><br><span class="line">            acDoc.Editor.WriteMessage(<span class="string">&quot;\nObject Class: &quot;</span> + acEnt.GetRXClass().Name +</span><br><span class="line">                                      <span class="string">&quot;\nCurrent Layer: &quot;</span> + acEnt.Layer + </span><br><span class="line">                                       <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        acTrans.Commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>C#动态语言（DLR）</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;LISTOBJECTS&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ListObjects</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current document and database</span></span><br><span class="line">    <span class="built_in">dynamic</span> acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line">    <span class="built_in">dynamic</span> acCurDb = HostApplicationServices.WorkingDatabase;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create a dynamic reference to model or paper space</span></span><br><span class="line">    <span class="built_in">dynamic</span> acSpace = acCurDb.CurrentSpaceId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Step through the current space</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="built_in">dynamic</span> acEnt <span class="keyword">in</span> acSpace)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Display the class and current layer of the object</span></span><br><span class="line">        acDoc.Editor.WriteMessage(<span class="string">&quot;\nObject Class: &quot;</span> + acEnt.GetRXClass().Name +</span><br><span class="line">                                  <span class="string">&quot;\nCurrent Layer: &quot;</span> + acEnt.Layer +</span><br><span class="line">                                  <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建对象（-NET）"><a href="#创建对象（-NET）" class="headerlink" title="创建对象（.NET）"></a>创建对象（.NET）</h2><p>AutoCAD通常提供几种不同的方法来创建相同的图形对象。虽然AutoCAD .NET API不提供创建对象的相同组合，但它确实为每种对象类型提供了基本的对象构造函数，而且还为许多对象构造函数提供了替代。</p>
<p>例如，在AutoCAD中，有四种不同的方法可以创建圆：（1）通过指定圆心和半径，（2）通过定义直径的两个点，（3）通过定义圆周的三个点，或（4）通过两条切线和一个半径。但是，在AutoCAD .NET API中，提供了两种创建圆的方法。一种方法不接受任何参数，而第二种方法需要圆心、圆的法线方向和半径。</p>
<p><strong>注意：</strong>对象是使用New关键字创建的，然后根据您使用的是容器（符号表或字典）还是 BlockTableRecord 对象，使用 Add 或 AppendEntity 将对象附加到父对象。</p>
<p><strong>设置对象的默认属性值</strong></p>
<p>创建新的图形对象时，将为以下实体属性值分配当前文档的数据库中定义的当前实体值：</p>
<ul>
<li>颜色</li>
<li>层</li>
<li>线型</li>
<li>线型比例</li>
<li>线宽</li>
<li>打印样式名称</li>
<li>可见性</li>
<li>透明度</li>
</ul>
<p><strong>注意：</strong>如果对象的属性需要设置为当前数据库的默认值，请调用要更改的对象的 SetDatabaseDefaults 方法。</p>
<p>本节中的主题</p>
<ul>
<li>确定父对象（.NET）</li>
<li>创建线（.NET）</li>
<li>创建曲线对象（.NET）</li>
<li>创建点对象（.NET）</li>
<li>创建实体填充区域（.NET）</li>
<li>使用面域（.NET）</li>
<li>创建图案填充（.NET）</li>
</ul>
<h3 id="确定父对象（-NET）"><a href="#确定父对象（-NET）" class="headerlink" title="确定父对象（.NET）"></a>确定父对象（.NET）</h3><p>图形对象附加到 BlockTableRecord 对象，如模型或图纸空间。通过 BlockTable 对象参照表示模型和图纸空间的块。如果您想在当前空间而不是特定空间中工作，则可以使用 CurrentSpaceId 属性从当前数据库中获取当前空间的ObjectId。</p>
<p>可以使用 DatabaseServices 命名空间下的 SymbolUtilityServices 类的属性或 GetBlockModelSpaceId 和 GetBlockPaperSpaceId 方法从 BlockTable 对象检索模型和图纸空间的块表记录的ObjectId。</p>
<p><strong>访问模型空间、图纸空间或当前空间</strong></p>
<p>以下示例演示如何访问与模型空间、图纸空间或当前空间关联的块表记录。一旦引用块表记录，就会向块表记录添加一个新线。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Runtime;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.ApplicationServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.DatabaseServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Geometry;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.EditorInput;</span><br><span class="line"> </span><br><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;AccessSpace&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AccessSpace</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current document and database</span></span><br><span class="line">    Document acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line">    Database acCurDb = acDoc.Database;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start a transaction</span></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId,</span><br><span class="line">                                        OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Block table record for read</span></span><br><span class="line">        BlockTableRecord acBlkTblRec;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Request which table record to open</span></span><br><span class="line">        PromptKeywordOptions pKeyOpts = <span class="keyword">new</span> PromptKeywordOptions(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        pKeyOpts.Message = <span class="string">&quot;\nEnter which space to create the line in &quot;</span>;</span><br><span class="line">        pKeyOpts.Keywords.Add(<span class="string">&quot;Model&quot;</span>);</span><br><span class="line">        pKeyOpts.Keywords.Add(<span class="string">&quot;Paper&quot;</span>);</span><br><span class="line">        pKeyOpts.Keywords.Add(<span class="string">&quot;Current&quot;</span>);</span><br><span class="line">        pKeyOpts.AllowNone = <span class="literal">false</span>;</span><br><span class="line">        pKeyOpts.AppendKeywordsToMessage = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        PromptResult pKeyRes = acDoc.Editor.GetKeywords(pKeyOpts);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (pKeyRes.StringResult == <span class="string">&quot;Model&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Get the ObjectID for Model space from the Block table</span></span><br><span class="line">            acBlkTblRec = acTrans.GetObject(acBlkTbl[BlockTableRecord.ModelSpace],</span><br><span class="line">                                            OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pKeyRes.StringResult == <span class="string">&quot;Paper&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Get the ObjectID for Paper space from the Block table</span></span><br><span class="line">            acBlkTblRec = acTrans.GetObject(acBlkTbl[BlockTableRecord.PaperSpace],</span><br><span class="line">                                            OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Get the ObjectID for the current space from the database</span></span><br><span class="line">            acBlkTblRec = acTrans.GetObject(acCurDb.CurrentSpaceId,</span><br><span class="line">                                            OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create a line that starts at 2,5 and ends at 10,7</span></span><br><span class="line">        <span class="keyword">using</span> (Line acLine = <span class="keyword">new</span> Line(<span class="keyword">new</span> Point3d(<span class="number">2</span>, <span class="number">5</span>, <span class="number">0</span>),</span><br><span class="line">                                <span class="keyword">new</span> Point3d(<span class="number">10</span>, <span class="number">7</span>, <span class="number">0</span>)))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Add the new object to the block table record and the transaction</span></span><br><span class="line">            acBlkTblRec.AppendEntity(acLine);</span><br><span class="line">            acTrans.AddNewlyCreatedDBObject(acLine, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new line to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建线（-NET）"><a href="#创建线（-NET）" class="headerlink" title="创建线（.NET）"></a>创建线（.NET）</h3><p>直线是AutoCAD中最基本的对象。您可以创建各种线-单线，以及带有和不带有圆弧的多条线段。通常，通过指定坐标点来绘制直线。创建线时，线将继承图形数据库中的当前设置，例如图层、线型和颜色。</p>
<p>要创建直线，请创建以下对象之一的新实例：</p>
<p>Line<br>创建一条线。</p>
<p>Polyline<br>创建二维轻量化对象。</p>
<p>MLine<br>创建多行。</p>
<p>Polyline2D<br>创建二维图形。</p>
<p>Polyline3D<br>创建三维视图。</p>
<p>注意：Polyline 2D对象是AutoCAD 14版之前版本中的旧版图元对象，Polyline对象表示AutoCAD 14版中引入的新优化图元。</p>
<p> 本节中的主题</p>
<ul>
<li>创建直线对象（.NET）</li>
<li>创建多段线对象（.NET）</li>
</ul>
<h4 id="创建直线对象（-NET）"><a href="#创建直线对象（-NET）" class="headerlink" title="创建直线对象（.NET）"></a>创建直线对象（.NET）</h4><p>此示例向模型空间添加一条从（5，5，0）开始到（12，3，0）结束的线。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Runtime;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.ApplicationServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.DatabaseServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Geometry;</span><br><span class="line"> </span><br><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;AddLine&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddLine</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current document and database</span></span><br><span class="line">    Document acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line">    Database acCurDb = acDoc.Database;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start a transaction</span></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId,</span><br><span class="line">                                        OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Block table record Model space for write</span></span><br><span class="line">        BlockTableRecord acBlkTblRec;</span><br><span class="line">        acBlkTblRec = acTrans.GetObject(acBlkTbl[BlockTableRecord.ModelSpace],</span><br><span class="line">                                        OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create a line that starts at 5,5 and ends at 12,3</span></span><br><span class="line">        <span class="keyword">using</span> (Line acLine = <span class="keyword">new</span> Line(<span class="keyword">new</span> Point3d(<span class="number">5</span>, <span class="number">5</span>, <span class="number">0</span>),</span><br><span class="line">                                      <span class="keyword">new</span> Point3d(<span class="number">12</span>, <span class="number">3</span>, <span class="number">0</span>)))</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Add the new object to the block table record and the transaction</span></span><br><span class="line">            acBlkTblRec.AppendEntity(acLine);</span><br><span class="line">            acTrans.AddNewlyCreatedDBObject(acLine, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new object to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="创建多段线对象（-NET）"><a href="#创建多段线对象（-NET）" class="headerlink" title="创建多段线对象（.NET）"></a>创建多段线对象（.NET）</h4><p>此示例使用二维坐标（2，4）、（4，2）和（6，4）向模型空间添加具有两条直线段的轻量化图元。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;AddLightweightPolyline&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddLightweightPolyline</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current document and database</span></span><br><span class="line">    Document acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line">    Database acCurDb = acDoc.Database;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start a transaction</span></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId,</span><br><span class="line">                                        OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Block table record Model space for write</span></span><br><span class="line">        BlockTableRecord acBlkTblRec;</span><br><span class="line">        acBlkTblRec = acTrans.GetObject(acBlkTbl[BlockTableRecord.ModelSpace],</span><br><span class="line">                                        OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create a polyline with two segments (3 points)</span></span><br><span class="line">        <span class="keyword">using</span> (Polyline acPoly = <span class="keyword">new</span> Polyline())</span><br><span class="line">        &#123;</span><br><span class="line">            acPoly.AddVertexAt(<span class="number">0</span>, <span class="keyword">new</span> Point2d(<span class="number">2</span>, <span class="number">4</span>), <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">            acPoly.AddVertexAt(<span class="number">1</span>, <span class="keyword">new</span> Point2d(<span class="number">4</span>, <span class="number">2</span>), <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">            acPoly.AddVertexAt(<span class="number">2</span>, <span class="keyword">new</span> Point2d(<span class="number">6</span>, <span class="number">4</span>), <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Add the new object to the block table record and the transaction</span></span><br><span class="line">            acBlkTblRec.AppendEntity(acPoly);</span><br><span class="line">            acTrans.AddNewlyCreatedDBObject(acPoly, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new object to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建曲线对象（-NET）"><a href="#创建曲线对象（-NET）" class="headerlink" title="创建曲线对象（.NET）"></a>创建曲线对象（.NET）</h3><p>可以使用AutoCAD创建各种曲线对象，包括样条曲线、螺旋线、圆、圆弧和椭圆。所有曲线都在当前UCS的<em>XY</em>平面上创建。</p>
<p>若要创建曲线，请创建以下对象之一的新实例：</p>
<ul>
<li><p>Arc 弧</p>
<p>在给定圆心、半径、起始角和终止角的情况下创建圆弧。</p>
</li>
<li><p>Circle 圆</p>
<p>在给定圆心和半径的情况下创建圆。</p>
</li>
<li><p>Ellipse 椭圆</p>
<p>在给定中心点、长轴上的点和半径比的情况下创建椭圆。</p>
</li>
<li><p>Spline 样条</p>
<p>创建二次或三次NURBS（非均匀有理B样条）曲线。</p>
</li>
<li><p>Helix 螺旋</p>
<p>创建二维或三维螺旋对象。</p>
</li>
</ul>
<p>本节中的主题</p>
<ul>
<li>创建圆对象（.NET）</li>
<li>创建弧形对象（.NET）</li>
<li>创建样条线对象（.NET）</li>
</ul>
<h4 id="创建圆对象（-NET）"><a href="#创建圆对象（-NET）" class="headerlink" title="创建圆对象（.NET）"></a>创建圆对象（.NET）</h4><p>本示例在模型空间中创建一个圆心为（2，3，0）、半径为4.25的圆。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Runtime;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.ApplicationServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.DatabaseServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Geometry;</span><br><span class="line"> </span><br><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;AddCircle&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddCircle</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current document and database</span></span><br><span class="line">    Document acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line">    Database acCurDb = acDoc.Database;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start a transaction</span></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId,</span><br><span class="line">                                        OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Block table record Model space for write</span></span><br><span class="line">        BlockTableRecord acBlkTblRec;</span><br><span class="line">        acBlkTblRec = acTrans.GetObject(acBlkTbl[BlockTableRecord.ModelSpace],</span><br><span class="line">                                        OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create a circle that is at 2,3 with a radius of 4.25</span></span><br><span class="line">        <span class="keyword">using</span> (Circle acCirc = <span class="keyword">new</span> Circle())</span><br><span class="line">        &#123;</span><br><span class="line">            acCirc.Center = <span class="keyword">new</span> Point3d(<span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span>);</span><br><span class="line">            acCirc.Radius = <span class="number">4.25</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Add the new object to the block table record and the transaction</span></span><br><span class="line">            acBlkTblRec.AppendEntity(acCirc);</span><br><span class="line">            acTrans.AddNewlyCreatedDBObject(acCirc, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new object to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="创建弧形对象（-NET）"><a href="#创建弧形对象（-NET）" class="headerlink" title="创建弧形对象（.NET）"></a>创建弧形对象（.NET）</h4><p>本示例在模型空间中创建一个圆弧，其中心点为（6.25，9.125，0），半径为6，起始角度为1.117（64度），终止角度为3.5605（204度）。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Runtime;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.ApplicationServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.DatabaseServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Geometry;</span><br><span class="line"> </span><br><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;AddArc&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddArc</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current document and database</span></span><br><span class="line">    Document acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line">    Database acCurDb = acDoc.Database;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start a transaction</span></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId,</span><br><span class="line">                                        OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Block table record Model space for write</span></span><br><span class="line">        BlockTableRecord acBlkTblRec;</span><br><span class="line">        acBlkTblRec = acTrans.GetObject(acBlkTbl[BlockTableRecord.ModelSpace],</span><br><span class="line">                                        OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create an arc that is at 6.25,9.125 with a radius of 6, and</span></span><br><span class="line">        <span class="comment">// starts at 64 degrees and ends at 204 degrees</span></span><br><span class="line">        <span class="keyword">using</span> (Arc acArc = <span class="keyword">new</span> Arc(<span class="keyword">new</span> Point3d(<span class="number">6.25</span>, <span class="number">9.125</span>, <span class="number">0</span>),</span><br><span class="line">                            <span class="number">6</span>, <span class="number">1.117</span>, <span class="number">3.5605</span>))</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Add the new object to the block table record and the transaction</span></span><br><span class="line">            acBlkTblRec.AppendEntity(acArc);</span><br><span class="line">            acTrans.AddNewlyCreatedDBObject(acArc, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new line to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="创建样条线对象（-NET）"><a href="#创建样条线对象（-NET）" class="headerlink" title="创建样条线对象（.NET）"></a>创建样条线对象（.NET）</h4><p>此示例使用三个点（0，0，0）、（5，5，0）和（10，0，0）在模型空间中创建圆。样条曲线的起点切线和终点切线为（0.5，0.5，0.0）。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Runtime;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.ApplicationServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.DatabaseServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Geometry;</span><br><span class="line"> </span><br><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;AddSpline&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddSpline</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current document and database</span></span><br><span class="line">    Document acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line">    Database acCurDb = acDoc.Database;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start a transaction</span></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId,</span><br><span class="line">                                        OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Block table record Model space for write</span></span><br><span class="line">        BlockTableRecord acBlkTblRec;</span><br><span class="line">        acBlkTblRec = acTrans.GetObject(acBlkTbl[BlockTableRecord.ModelSpace],</span><br><span class="line">                                        OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Define the fit points for the spline</span></span><br><span class="line">        Point3dCollection ptColl = <span class="keyword">new</span> Point3dCollection();</span><br><span class="line">        ptColl.Add(<span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">        ptColl.Add(<span class="keyword">new</span> Point3d(<span class="number">5</span>, <span class="number">5</span>, <span class="number">0</span>));</span><br><span class="line">        ptColl.Add(<span class="keyword">new</span> Point3d(<span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get a 3D vector from the point (0.5,0.5,0)</span></span><br><span class="line">        Vector3d vecTan = <span class="keyword">new</span> Point3d(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0</span>).GetAsVector();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create a spline through (0, 0, 0), (5, 5, 0), and (10, 0, 0) with a</span></span><br><span class="line">        <span class="comment">// start and end tangency of (0.5, 0.5, 0.0)</span></span><br><span class="line">        <span class="keyword">using</span> (Spline acSpline = <span class="keyword">new</span> Spline(ptColl, vecTan, vecTan, <span class="number">4</span>, <span class="number">0.0</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Add the new object to the block table record and the transaction</span></span><br><span class="line">            acBlkTblRec.AppendEntity(acSpline);</span><br><span class="line">            acTrans.AddNewlyCreatedDBObject(acSpline, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new line to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建点对象（-NET）"><a href="#创建点对象（-NET）" class="headerlink" title="创建点对象（.NET）"></a>创建点对象（.NET）</h3><p>Point 对象可能很有用，例如，作为节点或参照点，可以捕捉到这些点或从这些点偏移对象。可以设置点的样式及其相对于屏幕的大小或以绝对单位设置。</p>
<p>Database 对象的 Pdmode 和 Pdsize 属性控制Point对象的外观。如果 Pdmode 的值为0、2、3和4，则指定要通过该点绘制的图形。值为1时，不选择要显示的内容。</p>
<p><img src="https://help.autodesk.com/cloudhelp/2024/ENU/OARX-DevGuide-Managed/images/GUID-B5AFFED6-5B41-42F8-8236-11A501E8E6B2.png" alt="img"></p>
<p>将32、64或96加到前一个值上，除了通过点绘制的图形外，还可以选择围绕点绘制的形状：</p>
<p><img src="https://help.autodesk.com/cloudhelp/2024/ENU/OARX-DevGuide-Managed/images/GUID-0202DF5B-87D8-4F66-B637-68A3B8691FDA.png" alt="img"></p>
<p>Pdsize 控制点图形的大小，但 Pdmode 为0和1时除外。设置为0时，将在图形区域高度的5%处生成点。将 Pdsize 设置为正值可指定点图形的绝对大小。负值被解释为视口大小的百分比。重新生成图形时，将重新计算所有点的大小。</p>
<p>更改 Pdmode 和 Pdsize 后，现有点的外观将在下次重新生成图形时更改。</p>
<p><strong>创建Point对象并更改其外观</strong></p>
<p>以下示例在模型空间中的坐标（5，5，0）处创建 Point 对象。然后更新 Pdmode 和 Pdsize 属性。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Runtime;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.ApplicationServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.DatabaseServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Geometry;</span><br><span class="line"> </span><br><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;AddPointAndSetPointStyle&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddPointAndSetPointStyle</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current document and database</span></span><br><span class="line">    Document acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line">    Database acCurDb = acDoc.Database;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start a transaction</span></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId,</span><br><span class="line">                                        OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Block table record Model space for write</span></span><br><span class="line">        BlockTableRecord acBlkTblRec;</span><br><span class="line">        acBlkTblRec = acTrans.GetObject(acBlkTbl[BlockTableRecord.ModelSpace],</span><br><span class="line">                                        OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create a point at (4, 3, 0) in Model space</span></span><br><span class="line">        <span class="keyword">using</span> (DBPoint acPoint = <span class="keyword">new</span> DBPoint(<span class="keyword">new</span> Point3d(<span class="number">4</span>, <span class="number">3</span>, <span class="number">0</span>)))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Add the new object to the block table record and the transaction</span></span><br><span class="line">            acBlkTblRec.AppendEntity(acPoint);</span><br><span class="line">            acTrans.AddNewlyCreatedDBObject(acPoint, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Set the style for all point objects in the drawing</span></span><br><span class="line">        acCurDb.Pdmode = <span class="number">34</span>;</span><br><span class="line">        acCurDb.Pdsize = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new object to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建实体填充区域（-NET）"><a href="#创建实体填充区域（-NET）" class="headerlink" title="创建实体填充区域（.NET）"></a>创建实体填充区域（.NET）</h3><p>您可以创建用颜色填充的三角形和四边形区域。创建填充区域时，请将FILLMODE系统变量设置为禁用以提高性能，并在创建填充后将其重新设置为启用。</p>
<p>创建四边形实体填充区域时，第三和第四个点的顺序决定其形状。比较以下插图：</p>
<p><img src="https://help.autodesk.com/cloudhelp/2024/ENU/OARX-DevGuide-Managed/images/GUID-EE1EE395-0874-4BCC-99E0-346BFA7DAF0F.png" alt="img"></p>
<p>前两个点定义多边形的一条边。第三个点定义在第二个点的对角位置。如果第四个点设置为等于第三个点，则会创建一个填充三角形。</p>
<p><strong>创建实体填充对象</strong></p>
<p>以下示例使用坐标（0，0，0）、（5，0，0）、（5，8，0）和（0，8，0）在模型空间中创建四边形实体（蝴蝶结）。它还使用坐标（10，0，0）、（15，0，0）、（10，8，0）和（15，8，0）创建矩形形状的四边形实体。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Runtime;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.ApplicationServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.DatabaseServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Geometry;</span><br><span class="line"> </span><br><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;Add2DSolid&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Add2DSolid</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current document and database</span></span><br><span class="line">    Document acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line">    Database acCurDb = acDoc.Database;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start a transaction</span></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId,</span><br><span class="line">                                        OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Block table record Model space for write</span></span><br><span class="line">        BlockTableRecord acBlkTblRec;</span><br><span class="line">        acBlkTblRec = acTrans.GetObject(acBlkTbl[BlockTableRecord.ModelSpace],</span><br><span class="line">                                        OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create a quadrilateral (bow-tie) solid in Model space</span></span><br><span class="line">        <span class="keyword">using</span> (Solid ac2DSolidBow = <span class="keyword">new</span> Solid(<span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">                                        <span class="keyword">new</span> Point3d(<span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">                                        <span class="keyword">new</span> Point3d(<span class="number">5</span>, <span class="number">8</span>, <span class="number">0</span>),</span><br><span class="line">                                        <span class="keyword">new</span> Point3d(<span class="number">0</span>, <span class="number">8</span>, <span class="number">0</span>)))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Add the new object to the block table record and the transaction</span></span><br><span class="line">            acBlkTblRec.AppendEntity(ac2DSolidBow);</span><br><span class="line">            acTrans.AddNewlyCreatedDBObject(ac2DSolidBow, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create a quadrilateral (square) solid in Model space</span></span><br><span class="line">        <span class="keyword">using</span> (Solid ac2DSolidSqr = <span class="keyword">new</span> Solid(<span class="keyword">new</span> Point3d(<span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">                                        <span class="keyword">new</span> Point3d(<span class="number">15</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">                                        <span class="keyword">new</span> Point3d(<span class="number">10</span>, <span class="number">8</span>, <span class="number">0</span>),</span><br><span class="line">                                        <span class="keyword">new</span> Point3d(<span class="number">15</span>, <span class="number">8</span>, <span class="number">0</span>)))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Add the new object to the block table record and the transaction</span></span><br><span class="line">            acBlkTblRec.AppendEntity(ac2DSolidSqr);</span><br><span class="line">            acTrans.AddNewlyCreatedDBObject(ac2DSolidSqr, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new object to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用面域（-NET）"><a href="#使用面域（-NET）" class="headerlink" title="使用面域（.NET）"></a>使用面域（.NET）</h3><p>面域是您从称为环的闭合形状创建的二维封闭面域。回路是由直线和曲线对象组成的闭合边界，这些对象本身不相交。回路可以是直线、轻型多段线、二维和三维多段线、圆、圆弧、椭圆、椭圆弧、样条曲线、三维面、轨迹和实体的组合。</p>
<p>组成环的对象必须是闭合的，或者通过与其他对象共享端点来形成闭合面域。它们也必须共面（在同一平面上）。组成面域的循环必须定义为对象数组。</p>
<p>本节中的主题</p>
<ul>
<li>创建面域（.NET）</li>
<li>创建复合面域（.NET）</li>
</ul>
<h4 id="创建面域（-NET）"><a href="#创建面域（-NET）" class="headerlink" title="创建面域（.NET）"></a>创建面域（.NET）</h4><p>通过创建 Region 对象的实例，然后将其附加到 BlockTableRecord 对象，可以将面域添加到 BlockTableRecord 对象。在将其添加到 BlockTableRecord 对象之前，需要根据形成闭合环的对象计算面域。 CreateFromCurves 函数在由输入对象数组形成的每个闭合循环中创建一个面域。 CreateFromCurves 方法返回并需要 DBObjectCollection 对象。</p>
<p>AutoCAD将闭合的二维多段线和平面三维多段线转换为单独的面域，然后转换形成闭合平面环的多段线、直线和曲线。如果两条以上的曲线共享一个端点，则生成的面域可能是任意的。因此，实际上可以使用 CreateFromCurves 方法创建多个面域。您需要将创建的每个面域附加到 BlockTableRecord 对象。</p>
<p><strong>创建简单面域</strong></p>
<p>下面的示例从单个圆创建面域。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Runtime;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.ApplicationServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.DatabaseServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Geometry;</span><br><span class="line"> </span><br><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;AddRegion&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddRegion</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current document and database</span></span><br><span class="line">    Document acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line">    Database acCurDb = acDoc.Database;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start a transaction</span></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId,</span><br><span class="line">                                        OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Block table record Model space for write</span></span><br><span class="line">        BlockTableRecord acBlkTblRec;</span><br><span class="line">        acBlkTblRec = acTrans.GetObject(acBlkTbl[BlockTableRecord.ModelSpace],</span><br><span class="line">                                        OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create an in memory circle</span></span><br><span class="line">        <span class="keyword">using</span> (Circle acCirc = <span class="keyword">new</span> Circle())</span><br><span class="line">        &#123;</span><br><span class="line">            acCirc.Center = <span class="keyword">new</span> Point3d(<span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">            acCirc.Radius = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Adds the circle to an object array</span></span><br><span class="line">            DBObjectCollection acDBObjColl = <span class="keyword">new</span> DBObjectCollection();</span><br><span class="line">            acDBObjColl.Add(acCirc);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Calculate the regions based on each closed loop</span></span><br><span class="line">            DBObjectCollection myRegionColl = <span class="keyword">new</span> DBObjectCollection();</span><br><span class="line">            myRegionColl = Region.CreateFromCurves(acDBObjColl);</span><br><span class="line">            Region acRegion = myRegionColl[<span class="number">0</span>] <span class="keyword">as</span> Region;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Add the new object to the block table record and the transaction</span></span><br><span class="line">            acBlkTblRec.AppendEntity(acRegion);</span><br><span class="line">            acTrans.AddNewlyCreatedDBObject(acRegion, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Dispose of the in memory circle not appended to the database</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new object to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="创建复合面域（-NET）"><a href="#创建复合面域（-NET）" class="headerlink" title="创建复合面域（.NET）"></a>创建复合面域（.NET）</h4><p>可以通过减去、合并面域或三维实体或查找面域或三维实体的交点来创建复合面域。然后可以拉伸或旋转复合面域以创建复杂实体。要创建复合面域，请使用 BooleanOperation 方法。</p>
<p><strong>减去面域</strong></p>
<p>当您从一个面域减去另一个面域时，您从第一个面域调用 BooleanOperation 方法。这是要从中减去的面域。例如，要计算平面图需要铺多少地毯，请从地板空间的外边界调用 BooleanOperation 方法，并使用无地毯面域（例如柱子和柜台）作为布尔参数列表中的对象。</p>
<p><strong>合并面域</strong></p>
<p>要合并面域，请调用 BooleanOperation 方法并使用常量 BooleanOperationType.BoolUnite 而不是 BooleanOperationType.BoolSubtract 进行操作。您可以按任意顺序组合联合收割机面域以将它们联合起来。</p>
<p><strong>找到两个面域的交集</strong></p>
<p>要找到两个面域的交集，请使用常量 BooleanOperationType.BoolIntersect 。可以按任意顺序组合联合收割机面域以使其相交。</p>
<p><strong>创建复合面域</strong></p>
<p>下面的示例从两个圆创建两个面域，然后从较大的面域中减去较小的面域以创建轮子。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Runtime;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.ApplicationServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.DatabaseServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Geometry;</span><br><span class="line"> </span><br><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;CreateCompositeRegions&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">CreateCompositeRegions</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current document and database</span></span><br><span class="line">    Document acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line">    Database acCurDb = acDoc.Database;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start a transaction</span></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId,</span><br><span class="line">                                        OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Block table record Model space for write</span></span><br><span class="line">        BlockTableRecord acBlkTblRec;</span><br><span class="line">        acBlkTblRec = acTrans.GetObject(acBlkTbl[BlockTableRecord.ModelSpace],</span><br><span class="line">                                        OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create two in memory circles</span></span><br><span class="line">        <span class="keyword">using</span> (Circle acCirc1 = <span class="keyword">new</span> Circle())</span><br><span class="line">        &#123;</span><br><span class="line">            acCirc1.Center = <span class="keyword">new</span> Point3d(<span class="number">4</span>, <span class="number">4</span>, <span class="number">0</span>);</span><br><span class="line">            acCirc1.Radius = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">using</span> (Circle acCirc2 = <span class="keyword">new</span> Circle())</span><br><span class="line">            &#123;</span><br><span class="line">                acCirc2.Center = <span class="keyword">new</span> Point3d(<span class="number">4</span>, <span class="number">4</span>, <span class="number">0</span>);</span><br><span class="line">                acCirc2.Radius = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Adds the circle to an object array</span></span><br><span class="line">                DBObjectCollection acDBObjColl = <span class="keyword">new</span> DBObjectCollection();</span><br><span class="line">                acDBObjColl.Add(acCirc1);</span><br><span class="line">                acDBObjColl.Add(acCirc2);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Calculate the regions based on each closed loop</span></span><br><span class="line">                DBObjectCollection myRegionColl = <span class="keyword">new</span> DBObjectCollection();</span><br><span class="line">                myRegionColl = Region.CreateFromCurves(acDBObjColl);</span><br><span class="line">                Region acRegion1 = myRegionColl[<span class="number">0</span>] <span class="keyword">as</span> Region;</span><br><span class="line">                Region acRegion2 = myRegionColl[<span class="number">1</span>] <span class="keyword">as</span> Region;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Subtract region 1 from region 2</span></span><br><span class="line">                <span class="keyword">if</span> (acRegion1.Area &gt; acRegion2.Area)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// Subtract the smaller region from the larger one</span></span><br><span class="line">                    acRegion1.BooleanOperation(BooleanOperationType.BoolSubtract, acRegion2);</span><br><span class="line">                    acRegion2.Dispose();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Add the final region to the database</span></span><br><span class="line">                    acBlkTblRec.AppendEntity(acRegion1);</span><br><span class="line">                    acTrans.AddNewlyCreatedDBObject(acRegion1, <span class="literal">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// Subtract the smaller region from the larger one</span></span><br><span class="line">                    acRegion2.BooleanOperation(BooleanOperationType.BoolSubtract, acRegion1);</span><br><span class="line">                    acRegion1.Dispose();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Add the final region to the database</span></span><br><span class="line">                    acBlkTblRec.AppendEntity(acRegion2);</span><br><span class="line">                    acTrans.AddNewlyCreatedDBObject(acRegion2, <span class="literal">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Dispose of the in memory objects not appended to the database</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new object to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建图案填充（-NET）"><a href="#创建图案填充（-NET）" class="headerlink" title="创建图案填充（.NET）"></a>创建图案填充（.NET）</h3><p>闭合边界可以用图案填充。</p>
<p>创建图案填充时，最初不指定要填充的区域。首先，您必须创建 Hatch 对象。完成此操作后，可以指定外部循环，即图案填充的最外边界。然后，可以继续指定图案填充中可能存在的任何内环。</p>
<p>本节中的主题</p>
<ul>
<li>创建图案填充对象（.NET）</li>
<li>关联图案填充（.NET）</li>
<li>指定填充图案类型和名称（.NET）</li>
<li>定义图案填充边界（.NET）</li>
</ul>
<h4 id="创建图案填充对象（-NET）"><a href="#创建图案填充对象（-NET）" class="headerlink" title="创建图案填充对象（.NET）"></a>创建图案填充对象（.NET）</h4><p>创建 Hatch 对象时，请指定填充图案类型、填充图案名称和关联性。创建图案填充对象后，将无法更改图案填充关联性。</p>
<p>若要创建Hatch对象，请创建该对象的新实例，然后使用 AppendEntity 方法将其添加到 BlockTableRecord 对象。</p>
<h4 id="关联图案填充（-NET）"><a href="#关联图案填充（-NET）" class="headerlink" title="关联图案填充（.NET）"></a>关联图案填充（.NET）</h4><p>可以创建关联或非关联图案填充。关联图案填充链接到其边界，并在修改边界时更新。非关联图案填充独立于其边界。</p>
<p>若要使图案填充具有关联性，请将创建的图案填充对象的 Associative 特性设置为 TRUE 。若要使图案填充不关联，请将 Associative 特性设置为 FALSE 。</p>
<p>在附加图案填充循环之前，必须设置图案填充的关联性。如果图案填充对象是非关联的，则可以通过将 Associative 特性设置为 TRUE 并重新附加图案填充循环来使其再次关联。</p>
<h4 id="指定填充图案类型和名称（-NET）"><a href="#指定填充图案类型和名称（-NET）" class="headerlink" title="指定填充图案类型和名称（.NET）"></a>指定填充图案类型和名称（.NET）</h4><p>AutoCAD提供了实体填充和五十多种行业标准填充图案。填充图案亮显图形的特定特征或区域。例如，图案可以帮助区分3D对象的组件或表示构成对象的材料。</p>
<p>可以使用AutoCAD提供的阵列或外部阵列库中的阵列。</p>
<p>若要指定唯一的图案，必须同时指定图案填充对象的图案类型和名称。模式类型指定在何处查找模式名称。输入图案类型时，请使用以下常量之一：</p>
<ul>
<li><p>HatchPatternType.PreDefined</p>
<p>从<em>acad.pat</em>或<em>acadiso.pat</em>文件中定义的阵列名称中删除阵列名称。</p>
</li>
<li><p>HatchPatternType.UserDefined</p>
<p>使用当前线型定义线型图案。</p>
</li>
<li><p>HatchPatternType.CustomDefined</p>
<p>从除<em>acad.pat</em>或<em>acadiso.pat</em>文件之外的PAT中删除图案名称。</p>
<p>输入图案名称时，请使用对图案类型指定的文件有效的名称。</p>
</li>
</ul>
<h4 id="定义图案填充边界（-NET）"><a href="#定义图案填充边界（-NET）" class="headerlink" title="定义图案填充边界（.NET）"></a>定义图案填充边界（.NET）</h4><p>创建图案填充对象后，可以添加图案填充边界。边界可以是直线、圆弧、圆、二维多段线、椭圆、样条曲线和面域的任意组合。</p>
<p>添加的第一个边界必须是外边界，它定义了要由图案填充的最外边界。要添加外部边界，请使用 AppendLoop 方法，并将 HatchLoopTypes.Outermost 常量用于要追加的循环类型。</p>
<p>定义外部边界后，可以继续添加其他边界。使用带有 HatchLoopTypes.Default 常量的 AppendLoop 方法添加内部边界。</p>
<p>内部边界定义图案填充内的孤岛。Hatch对象如何处理这些孤岛取决于 HatchStyle 属性的设置。 HatchStyle 属性可以设置为以下条件之一：</p>
<p>图案填充样式定义</p>
<table>
<thead>
<tr>
<th align="left">HatchStyle</th>
<th align="left">Condition</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><img src="https://help.autodesk.com/cloudhelp/2024/ENU/OARX-DevGuide-Managed/images/GUID-EDF56CD1-C251-4D41-89F8-C3D29395DBD3.png" alt="img"></td>
<td align="left">Normal  (HatchStyle.Normal)</td>
<td align="left">指定标准样式或法线。该选项从最外侧的面积边界向内填充。如果AutoCAD遇到内部边界，它将关闭图案填充，直到遇到另一个边界。这是 HatchStyle 属性的默认设置。</td>
</tr>
<tr>
<td align="left"><img src="https://help.autodesk.com/cloudhelp/2024/ENU/OARX-DevGuide-Managed/images/GUID-16DC4CEC-E2A8-4D2B-A2E1-E783EAAAFACF.png" alt="img"></td>
<td align="left">Outer (HatchStyle.Outer)</td>
<td align="left">仅填充最外面的区域。此样式也会从区域边界向内填充图案，但如果遇到内部边界，则会关闭图案填充，并且不会再次启用。</td>
</tr>
<tr>
<td align="left"><img src="https://help.autodesk.com/cloudhelp/2024/ENU/OARX-DevGuide-Managed/images/GUID-714AC326-A55B-4580-A0F8-F5E058573AEF.png" alt="img"></td>
<td align="left">Ignore (HatchStyle.Ignore)</td>
<td align="left">忽略内部结构。此选项将填充所有内部对象。</td>
</tr>
</tbody></table>
<p>完成图案填充的定义后，必须先对其进行计算，然后才能显示。使用 EvaluateHatch 方法来执行此操作。</p>
<p> <strong>创建图案填充对象</strong></p>
<p>以下示例在模型空间中创建关联的图案填充。创建图案填充后，可以更改与图案填充关联的圆的大小。图案填充将更改以匹配圆的大小。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Runtime;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.ApplicationServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.DatabaseServices;</span><br><span class="line"><span class="keyword">using</span> Autodesk.AutoCAD.Geometry;</span><br><span class="line"> </span><br><span class="line">[<span class="meta">CommandMethod(<span class="string">&quot;AddHatch&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddHatch</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get the current document and database</span></span><br><span class="line">    Document acDoc = Application.DocumentManager.MdiActiveDocument;</span><br><span class="line">    Database acCurDb = acDoc.Database;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start a transaction</span></span><br><span class="line">    <span class="keyword">using</span> (Transaction acTrans = acCurDb.TransactionManager.StartTransaction())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Open the Block table for read</span></span><br><span class="line">        BlockTable acBlkTbl;</span><br><span class="line">        acBlkTbl = acTrans.GetObject(acCurDb.BlockTableId,</span><br><span class="line">                                        OpenMode.ForRead) <span class="keyword">as</span> BlockTable;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Block table record Model space for write</span></span><br><span class="line">        BlockTableRecord acBlkTblRec;</span><br><span class="line">        acBlkTblRec = acTrans.GetObject(acBlkTbl[BlockTableRecord.ModelSpace],</span><br><span class="line">                                        OpenMode.ForWrite) <span class="keyword">as</span> BlockTableRecord;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create a circle object for the closed boundary to hatch</span></span><br><span class="line">        <span class="keyword">using</span> (Circle acCirc = <span class="keyword">new</span> Circle())</span><br><span class="line">        &#123;</span><br><span class="line">            acCirc.Center = <span class="keyword">new</span> Point3d(<span class="number">3</span>, <span class="number">3</span>, <span class="number">0</span>);</span><br><span class="line">            acCirc.Radius = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Add the new circle object to the block table record and the transaction</span></span><br><span class="line">            acBlkTblRec.AppendEntity(acCirc);</span><br><span class="line">            acTrans.AddNewlyCreatedDBObject(acCirc, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Adds the circle to an object id array</span></span><br><span class="line">            ObjectIdCollection acObjIdColl = <span class="keyword">new</span> ObjectIdCollection();</span><br><span class="line">            acObjIdColl.Add(acCirc.ObjectId);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Create the hatch object and append it to the block table record</span></span><br><span class="line">            <span class="keyword">using</span> (Hatch acHatch = <span class="keyword">new</span> Hatch())</span><br><span class="line">            &#123;</span><br><span class="line">                acBlkTblRec.AppendEntity(acHatch);</span><br><span class="line">                acTrans.AddNewlyCreatedDBObject(acHatch, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Set the properties of the hatch object</span></span><br><span class="line">                <span class="comment">// Associative must be set after the hatch object is appended to the </span></span><br><span class="line">                <span class="comment">// block table record and before AppendLoop</span></span><br><span class="line">                acHatch.SetHatchPattern(HatchPatternType.PreDefined, <span class="string">&quot;ANSI31&quot;</span>);</span><br><span class="line">                acHatch.Associative = <span class="literal">true</span>;</span><br><span class="line">                acHatch.AppendLoop(HatchLoopTypes.Outermost, acObjIdColl);</span><br><span class="line">                acHatch.EvaluateHatch(<span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the new object to the database</span></span><br><span class="line">        acTrans.Commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="注：翻译自ObjectARX-Managed-NET-Developer’s-Guide，且只保留了C-部分的代码"><a href="#注：翻译自ObjectARX-Managed-NET-Developer’s-Guide，且只保留了C-部分的代码" class="headerlink" title="注：翻译自ObjectARX: Managed .NET Developer’s Guide，且只保留了C#部分的代码"></a><em><strong>注：</strong></em>翻译自<a target="_blank" rel="noopener" href="https://help.autodesk.com/view/OARX/2024/ENU/?guid=GUID-C3F3C736-40CF-44A0-9210-55F6A939B6F2">ObjectARX: Managed .NET Developer’s Guide</a>，且只保留了C#部分的代码</h2></article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CAD/">CAD</a></div><div class="post-share"><div class="social-share" data-image="/images/4stars.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/01/16/Revit%E4%BA%8C%E5%BC%80%E7%A4%BA%E4%BE%8B/Revit%E4%B8%8EExcel%E4%BA%A4%E4%BA%92/" title="Revit与Excel交互"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Revit与Excel交互</div></div><div class="info-2"><div class="info-item-1">  Excel检测更改自动保存，Revit自动读取数据生成元素 </div></div></div></a><a class="pagination-related" href="/2025/01/13/ObjectARX%EF%BC%9AManaged.NET%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E6%8C%87%E5%8D%97/02%E6%8E%A7%E5%88%B6AutoCAD%E7%8E%AF%E5%A2%83%EF%BC%88.NET%EF%BC%89/" title="02控制AutoCAD环境（.NET）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">02控制AutoCAD环境（.NET）</div></div><div class="info-2"><div class="info-item-1">控制AutoCAD环境（.NET）本章介绍开发与AutoCAD一起运行的进程内应用程序的基础知识。它解释了许多概念，以控制和有效地使用AutoCAD环境。 本节中的主题  控制应用程序窗口（.NET） 控制绘图窗口（.NET） 创建、打开、保存和关闭图形（.NET） 锁定和删除文档（.NET） AutoCAD的首选项（.NET） 设置和返回系统变量（.NET） 精确绘图（.NET） 提示用户输入（.NET） 访问命令行（.NET） 扩展AutoCAD用户界面（.NET） 自定义对话框可用于获取用户输入并扩展AutoCAD用户界面的功能。  控制应用程序窗口（.NET）控制应用程序窗口的能力使开发人员能够灵活地创建有效和智能的应用程序。有时，您的应用程序最小化AutoCAD窗口是合适的，可能是在您的代码在另一个应用程序（如Microsoft® Excel®）中执行工作时。此外，在执行提示用户输入等任务之前，通常需要验证AutoCAD窗口的状态。 使用Application对象上的方法和属性，可以更改Application窗口的位置、大小和可见性。您还可以使用...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/01/08/CAD%E4%BA%8C%E5%BC%80/AddInManager/" title="AddInManager"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-08</div><div class="info-item-2">AddInManager</div></div><div class="info-2"><div class="info-item-1">AddInManager每次调试cad插件，老是会有占用的问题。网上找到方法就是通过反射解决，但是只找到那个要自己手动配置的，嫌麻烦。GitHub上有个CADAddInManager，用了一下，好像没什么反应，不知道是不是使用方式不对，文档也不详细。索性自己整一个。 参照Revit SDK 里的那个AddinManager及网上给出的方法。通过反射。把dll复制到临时文件夹，然后委托调用。现在只做了CommandMethod部分的。VS2022+CAD2024。  使用方式： 1、先自动加载： 在cad根目录Support文件夹下找到acad2024.lsp。 1(command&quot;netload&quot;...</div></div></div></a><a class="pagination-related" href="/2025/01/12/ObjectARX%EF%BC%9AManaged.NET%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E6%8C%87%E5%8D%97/01AutoCAD.NET%20API%EF%BC%88.NET%EF%BC%89%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="01AutoCAD .NET API（.NET）的基础知识"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-12</div><div class="info-item-2">01AutoCAD .NET API（.NET）的基础知识</div></div><div class="info-2"><div class="info-item-1">AutoCAD .NET API（.NET）的基础知识要有效地使用AutoCAD®.NET API，您应该熟悉与要自动执行的任务相关的AutoCAD图元、对象和功能。对对象的图形和非图形特性了解得越多，就越容易通过AutoCAD .NET API对其进行操作。 本节中的主题  了解AutoCAD对象层次（.NET） 访问对象层次结构（.NET） 集合对象（.NET） 了解属性和方法（.NET） 进程外与进程内（.NET） 定义命令和AutoLISP函数（.NET）  了解AutoCAD对象层次（.NET）对象是AutoCAD .NET API的主要构造块。每个暴露的对象都代表AutoCAD的一个精确部分。AutoCAD .NET API中有许多不同类型的对象。AutoCAD .NET API中表示的某些对象包括：  图形对象，如直线、圆弧、文本和尺寸 样式设置，如图层、线型和标注样式 组织结构，如层、组和块 图形显示，如视图和视口 甚至绘图和AutoCAD应用程序  这些对象以分层方式进行结构化，AutoCAD应用程序对象位于根。这种层次结构通常被称为对象模型。下图显示了...</div></div></div></a><a class="pagination-related" href="/2025/01/13/ObjectARX%EF%BC%9AManaged.NET%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E6%8C%87%E5%8D%97/02%E6%8E%A7%E5%88%B6AutoCAD%E7%8E%AF%E5%A2%83%EF%BC%88.NET%EF%BC%89/" title="02控制AutoCAD环境（.NET）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-13</div><div class="info-item-2">02控制AutoCAD环境（.NET）</div></div><div class="info-2"><div class="info-item-1">控制AutoCAD环境（.NET）本章介绍开发与AutoCAD一起运行的进程内应用程序的基础知识。它解释了许多概念，以控制和有效地使用AutoCAD环境。 本节中的主题  控制应用程序窗口（.NET） 控制绘图窗口（.NET） 创建、打开、保存和关闭图形（.NET） 锁定和删除文档（.NET） AutoCAD的首选项（.NET） 设置和返回系统变量（.NET） 精确绘图（.NET） 提示用户输入（.NET） 访问命令行（.NET） 扩展AutoCAD用户界面（.NET） 自定义对话框可用于获取用户输入并扩展AutoCAD用户界面的功能。  控制应用程序窗口（.NET）控制应用程序窗口的能力使开发人员能够灵活地创建有效和智能的应用程序。有时，您的应用程序最小化AutoCAD窗口是合适的，可能是在您的代码在另一个应用程序（如Microsoft® Excel®）中执行工作时。此外，在执行提示用户输入等任务之前，通常需要验证AutoCAD窗口的状态。 使用Application对象上的方法和属性，可以更改Application窗口的位置、大小和可见性。您还可以使用...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/4stars.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">funtim41@gmail.com</div><div class="author-info-description">实践-认识-再实践-再认识</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">58</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/FunTim41"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/FunTim41" target="_blank" title="Github"><i class="fab fa-github" style="color: #FFFFFF;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E7%BC%96%E8%BE%91AutoCAD%E5%9B%BE%E5%85%83%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">创建和编辑AutoCAD图元（.NET）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E5%92%8C%E5%85%B3%E9%97%AD%E5%AF%B9%E8%B1%A1%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.</span> <span class="toc-text">打开和关闭对象（.NET）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8ObjectIds%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.1.</span> <span class="toc-text">使用ObjectIds（.NET）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E4%BA%8B%E5%8A%A1%E4%B8%8E%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8%EF%BC%88-NET%EF%BC%89%E4%B8%80%E8%B5%B7%E4%BD%BF%E7%94%A8"><span class="toc-number">1.1.2.</span> <span class="toc-text">将事务与事务管理器（.NET）一起使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%BA%8B%E5%8A%A1%E8%AE%BF%E9%97%AE%E5%92%8C%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">使用事务访问和创建对象（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%90%E4%BA%A4%E5%92%8C%E5%9B%9E%E6%BB%9A%E6%9B%B4%E6%94%B9%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">提交和回滚更改（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Dispose-%E5%AF%B9%E8%B1%A1%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">Dispose 对象（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E4%BA%8B%E5%8A%A1%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.2.4.</span> <span class="toc-text">嵌套事务（.NET）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E4%BD%BF%E7%94%A8%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8%E6%89%93%E5%BC%80%E5%92%8C%E5%85%B3%E9%97%AD%E5%AF%B9%E8%B1%A1%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.3.</span> <span class="toc-text">不使用事务管理器打开和关闭对象（.NET）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%87%E7%BA%A7%E5%92%8C%E9%99%8D%E7%BA%A7Open-Objects%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.4.</span> <span class="toc-text">升级和降级Open Objects（.NET）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E4%BD%BF%E7%94%A8%E5%8A%A8%E6%80%81%E8%AF%AD%E8%A8%80%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.1.5.</span> <span class="toc-text">关于使用动态语言（.NET）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.</span> <span class="toc-text">创建对象（.NET）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E7%88%B6%E5%AF%B9%E8%B1%A1%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.1.</span> <span class="toc-text">确定父对象（.NET）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BA%BF%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.2.</span> <span class="toc-text">创建线（.NET）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%9B%B4%E7%BA%BF%E5%AF%B9%E8%B1%A1%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">创建直线对象（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%A4%9A%E6%AE%B5%E7%BA%BF%E5%AF%B9%E8%B1%A1%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">创建多段线对象（.NET）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%9B%B2%E7%BA%BF%E5%AF%B9%E8%B1%A1%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.3.</span> <span class="toc-text">创建曲线对象（.NET）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9C%86%E5%AF%B9%E8%B1%A1%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">创建圆对象（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%BC%A7%E5%BD%A2%E5%AF%B9%E8%B1%A1%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">创建弧形对象（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%A0%B7%E6%9D%A1%E7%BA%BF%E5%AF%B9%E8%B1%A1%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">创建样条线对象（.NET）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%82%B9%E5%AF%B9%E8%B1%A1%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.4.</span> <span class="toc-text">创建点对象（.NET）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E5%A1%AB%E5%85%85%E5%8C%BA%E5%9F%9F%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.5.</span> <span class="toc-text">创建实体填充区域（.NET）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%9D%A2%E5%9F%9F%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.6.</span> <span class="toc-text">使用面域（.NET）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%9D%A2%E5%9F%9F%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.6.1.</span> <span class="toc-text">创建面域（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%A4%8D%E5%90%88%E9%9D%A2%E5%9F%9F%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.6.2.</span> <span class="toc-text">创建复合面域（.NET）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9B%BE%E6%A1%88%E5%A1%AB%E5%85%85%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.7.</span> <span class="toc-text">创建图案填充（.NET）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9B%BE%E6%A1%88%E5%A1%AB%E5%85%85%E5%AF%B9%E8%B1%A1%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.7.1.</span> <span class="toc-text">创建图案填充对象（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E8%81%94%E5%9B%BE%E6%A1%88%E5%A1%AB%E5%85%85%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.7.2.</span> <span class="toc-text">关联图案填充（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E5%A1%AB%E5%85%85%E5%9B%BE%E6%A1%88%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%90%8D%E7%A7%B0%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.7.3.</span> <span class="toc-text">指定填充图案类型和名称（.NET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%9B%BE%E6%A1%88%E5%A1%AB%E5%85%85%E8%BE%B9%E7%95%8C%EF%BC%88-NET%EF%BC%89"><span class="toc-number">1.2.7.4.</span> <span class="toc-text">定义图案填充边界（.NET）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%EF%BC%9A%E7%BF%BB%E8%AF%91%E8%87%AAObjectARX-Managed-NET-Developer%E2%80%99s-Guide%EF%BC%8C%E4%B8%94%E5%8F%AA%E4%BF%9D%E7%95%99%E4%BA%86C-%E9%83%A8%E5%88%86%E7%9A%84%E4%BB%A3%E7%A0%81"><span class="toc-number">1.3.</span> <span class="toc-text">注：翻译自ObjectARX: Managed .NET Developer’s Guide，且只保留了C#部分的代码</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/16/Revit%E4%BA%8C%E5%BC%80%E7%A4%BA%E4%BE%8B/Revit%E4%B8%8EExcel%E4%BA%A4%E4%BA%92/" title="Revit与Excel交互">Revit与Excel交互</a><time datetime="2025-01-16T08:43:45.327Z" title="更新于 2025-01-16 16:43:45">2025-01-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/14/ObjectARX%EF%BC%9AManaged.NET%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E6%8C%87%E5%8D%97/03%E5%88%9B%E5%BB%BA%E5%92%8C%E7%BC%96%E8%BE%91AutoCAD%E5%9B%BE%E5%85%83%EF%BC%88.NET%EF%BC%89/" title="03创建和编辑AutoCAD图元（.NET）">03创建和编辑AutoCAD图元（.NET）</a><time datetime="2025-01-14T04:28:05.785Z" title="更新于 2025-01-14 12:28:05">2025-01-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/13/ObjectARX%EF%BC%9AManaged.NET%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E6%8C%87%E5%8D%97/02%E6%8E%A7%E5%88%B6AutoCAD%E7%8E%AF%E5%A2%83%EF%BC%88.NET%EF%BC%89/" title="02控制AutoCAD环境（.NET）">02控制AutoCAD环境（.NET）</a><time datetime="2025-01-14T02:31:41.869Z" title="更新于 2025-01-14 10:31:41">2025-01-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/12/ObjectARX%EF%BC%9AManaged.NET%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E6%8C%87%E5%8D%97/01AutoCAD.NET%20API%EF%BC%88.NET%EF%BC%89%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="01AutoCAD .NET API（.NET）的基础知识">01AutoCAD .NET API（.NET）的基础知识</a><time datetime="2025-01-14T02:31:29.466Z" title="更新于 2025-01-14 10:31:29">2025-01-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/19/RevitApi%E5%90%88%E9%9B%86/Autodesk.Revit.UI.Selection%20Namespace/" title="Autodesk.Revit.UI.Selection">Autodesk.Revit.UI.Selection</a><time datetime="2025-01-13T14:24:17.222Z" title="更新于 2025-01-13 22:24:17">2025-01-13</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/images/topback.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By funtim41@gmail.com</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">学而不思则罔，思而不学则殆。</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>(() => {
  const panguFn = () => {
    if (typeof pangu === 'object') pangu.autoSpacingPage()
    else {
      btf.getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
        .then(() => {
          pangu.autoSpacingPage()
        })
    }
  }

  const panguInit = () => {
    if (false){
      GLOBAL_CONFIG_SITE.isPost && panguFn()
    } else {
      panguFn()
    }
  }

  btf.addGlobalFn('pjaxComplete', panguInit, 'pangu')
  document.addEventListener('DOMContentLoaded', panguInit)
})()</script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'FunTim41/funtim41.github.io',
      'data-repo-id': 'R_kgDONjG8ww',
      'data-category-id': 'DIC_kwDONjG8w84Cllg2',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>